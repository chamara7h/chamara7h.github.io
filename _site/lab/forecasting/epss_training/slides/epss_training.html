<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>epss_training – Home</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../../../site_libs/countdown-0.4.0/countdown.css" rel="stylesheet">

<script src="../../../../site_libs/countdown-0.4.0/countdown.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Home">
<meta property="og:description" content="">
<meta property="og:site_name" content="Home">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Harsha Halgamuwe Hewage</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../phd/index.html"> 
<span class="menu-text">PhD Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../lab/index.html"> 
<span class="menu-text">Learning Lab</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:hewagehrc@gamil.com"> <i class="bi bi-envelope-at-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/chamara7h"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/harshachamara/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=XgQYqK8AAAAJ&amp;hl=en"> <i class="bi bi-bookmark-star-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="epss_training.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="demand-forecasting-models-for-contraceptive-supply-chain" class="level1" data-background-image="images/title_page.jpg" data-background-size="cover" data-background-color="#4f6952">
<h1 data-background-image="images/title_page.jpg" data-background-size="cover" data-background-color="#4f6952">Demand Forecasting Models for Contraceptive Supply Chain</h1>
<h2 class="anchored" data-anchor-id="demand-forecasting-models-for-contraceptive-supply-chain">
An introduction to time series forecasting
</h2>
<p><br></p>
<h4 class="anchored">
Harsha Halgamuwe Hewage <br> Data Lab for Social Good Research Lab <br> Cardiff University, UK
</h4>
<p>2025-03-17</p>
<section id="self-assessment" class="level2">
<h2 class="anchored" data-anchor-id="self-assessment">Self-Assessment</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/epss_pre.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="assumptions" class="level2">
<h2 class="anchored" data-anchor-id="assumptions">Assumptions</h2>
<ul>
<li>You should be comfortable with R and Python coding.</li>
<li>This is not a theory-based course—we will not derive formulas or mathematical proofs.</li>
<li>Our focus is on practical time series forecasting: understanding when and how to use different tools effectively.</li>
</ul>
</section>
<section id="what-we-will-cover" class="level2">
<h2 class="anchored" data-anchor-id="what-we-will-cover">What we will cover</h2>
<ul>
<li>Data wrangling and basic feature engineering</li>
<li>Time series visualizations</li>
<li>Traditional forecasting models</li>
<li>Advanced forecasting models</li>
<li>Performance evaluation</li>
</ul>
</section>
<section id="what-we-will-not-cover" class="level2">
<h2 class="anchored" data-anchor-id="what-we-will-not-cover">What we will <code>not cover</code></h2>
<ul>
<li>Handling missing values</li>
<li>Advanced feature engineering</li>
<li>Time series cross-validation</li>
<li>Hyperparameter tuning</li>
</ul>
</section>
<section id="materials" class="level2">
<h2 class="anchored" data-anchor-id="materials">Materials</h2>
<p>You can find the workshop materials <a href="https://chamara7h.github.io/lab/">here</a>.</p>
<p><em>Note</em>: These materials are based on <a href="https://arxiv.org/abs/2502.09685">A Novel Hybrid Approach to Contraceptive Demand Forecasting Research</a>, <a href="https://workshop.f4sg.org/africast/">F4SG: Africast training</a> and <a href="https://www.youtube.com/watch?v=VCiDhRxNxgc&amp;list=PLQMuwuCypmehClRpxqOzuiRKyPmeQTJsz">F4SG Learning Labs trainings</a>.</p>
<p><br></p>
<p>Recommended readings:</p>
<ul>
<li><a href="https://dfep.netlify.app/">Demand forecasting for executives and professionals</a> by Bahman Rostami-Tabar, Enno Siemsen, and Stephan Kolassa.</li>
<li><a href="https://otexts.com/fpp3/">Forecasting: Principles and Practice (3rd ed)</a> by Rob J Hyndman and George Athanasopoulos.</li>
<li><a href="https://openforecast.org/adam/">Forecasting and Analytics with the Augmented Dynamic Adaptive Model (ADAM)</a> by Ivan Svetunkov.</li>
</ul>
</section>
<section id="outline" class="level2">
<h2 class="anchored" data-anchor-id="outline">Outline</h2>
<ul>
<li>What is forecasting?</li>
<li>Prepare your data</li>
<li>Explore your data</li>
<li>Forecast modelling</li>
<li>Evaluating the model performances</li>
<li>Advance forecasting models</li>
<li>Other forecasting models in family planning supply chains</li>
</ul>
</section>
</section>
<section id="what-is-forecasting" class="level1">
<h1>What is forecasting?</h1>
<section id="what-is-a-forecast" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-forecast">What is a <code>FORECAST</code>?</h2>
<p>An estimation of the future based on all of the information available at the time when we generate the forecast;</p>
<ul>
<li>historical data,</li>
<li>knowledge of any future events that might impact the forecasts.</li>
</ul>
</section>
<section id="what-is-time-series-data" class="level2">
<h2 class="anchored" data-anchor-id="what-is-time-series-data">What is time series data?</h2>
<ul>
<li>Time series consist of sequences of observations collected over time.</li>
<li>Time series forecasting is estimating how the sequence of observations will continue into the future.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-to-forecast" class="level2">
<h2 class="anchored" data-anchor-id="what-to-forecast">What to <code>FORECAST</code>?</h2>
<p>Understanding needs! Identify decisions that need forecasting support!</p>
<ul>
<li>Forecast variable/s</li>
<li>Time granularity</li>
<li>Forecast horizon</li>
<li>Frequency</li>
<li>Structure/hierarchy</li>
</ul>
</section>
<section id="forecasting-workflow" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-workflow">Forecasting workflow</h2>
<ul>
<li><em>Step 1:</em> Problem definition</li>
<li><em>Step 2:</em> Gathering information</li>
<li><em>Step 3:</em> Preliminary (exploratory) analysis</li>
<li><em>Step 4:</em> Choosing and fitting models</li>
<li><em>Step 5:</em> Evaluating and using a forecasting model</li>
</ul>
</section>
<section id="tidy-forecasting-workflow" class="level2">
<h2 class="anchored" data-anchor-id="tidy-forecasting-workflow">Tidy forecasting workflow</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/tidy_workflow.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Read more at <a href="https://dfep.netlify.app/">Demand forecasting for executives and professionals</a> by Bahman Rostami-Tabar, Enno Siemsen, and Stephan Kolassa.</p>
</section>
</section>
<section id="forecasting-using-r" class="level1">
<h1>Forecasting using R</h1>
<section id="loading-libraries" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries">Loading libraries</h2>
<p>We use the <code>fpp3</code> package in this workshop, which provides all the necessary packages for data manipulation, plotting, and forecasting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"fable"</span>, <span class="st">"tsibble"</span>, <span class="st">"feasts"</span>, <span class="st">'zoo'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install missing packages</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>missing_packages <span class="ot">&lt;-</span> packages[<span class="sc">!</span>(packages <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="st">"Package"</span>])]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(missing_packages)) {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>(<span class="fu">install.packages</span>(missing_packages)))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries quietly</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>({</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse) <span class="co"># Data manipulation and plotting functions</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(fable) <span class="co"># Time series manipulation</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tsibble) <span class="co"># Forecasting functions</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(feasts) <span class="co"># Time series graphics and statistics</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read more at <a href="https://otexts.com/fpp3/">Forecasting: Principles and Practice (3rd ed)</a> by Rob J Hyndman and George Athanasopoulos.</p>
</section>
<section id="preparing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data">Preparing the data</h2>
<p>In this workshop, we are using <code>tsibble</code> objects. They provide a data infrastructure for tidy temporal data with wrangling tools, adapting the <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">tidy data principles</a>.</p>
<p>In <code>tsibble</code>:</p>
<ul>
<li><strong>Index:</strong> time information about the observation</li>
<li><strong>Measured variable(s):</strong> numbers of interest</li>
<li><strong>Key variable(s):</strong> set of variables that define observational units over time</li>
<li>It works with tidyverse functions.</li>
</ul>
</section>
<section id="read-csv-file" class="level2">
<h2 class="anchored" data-anchor-id="read-csv-file">Read <code>csv</code> file</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>med_qty <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/med_qty.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>med_qty <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       date hub_id product_id quantity_issued
1  2017 Jul  hub_4  product_1              60
2  2017 Jul  hub_4  product_6            5200
3  2017 Jul  hub_7  product_1               8
4  2017 Jul  hub_7  product_5             120
5  2017 Jul  hub_8  product_7              10
6  2017 Jul hub_10  product_1             343
7  2017 Jul hub_10  product_2              53
8  2017 Jul hub_10  product_3              26
9  2017 Jul hub_10  product_4            1710
10 2017 Jul hub_10  product_5            1340</code></pre>
</div>
</div>
<p>Do you think the <code>med_qty</code> data set is a tidy data?</p>
</section>
<section id="check-for-na-and-duplicates" class="level2">
<h2 class="anchored" data-anchor-id="check-for-na-and-duplicates">Check for <code>NA</code> and duplicates</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check NAs</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anyNA</span>(med_qty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check duplicates</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>med_qty <span class="sc">|&gt;</span>  </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">duplicated</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="create-tsibble" class="level2">
<h2 class="anchored" data-anchor-id="create-tsibble">Create tsibble</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>med_tsb <span class="ot">&lt;-</span> med_qty <span class="sc">|&gt;</span>  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span>  <span class="co"># convert chr to date format</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> date, <span class="at">key =</span> <span class="fu">c</span>(hub_id, product_id))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>med_tsb </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 6,745 x 4 [1M]
# Key:       hub_id, product_id [133]
       date hub_id product_id quantity_issued
      &lt;mth&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;
 1 2017 Aug hub_1  product_1              721
 2 2017 Sep hub_1  product_1              795
 3 2017 Oct hub_1  product_1             1720
 4 2017 Nov hub_1  product_1              911
 5 2017 Dec hub_1  product_1              314
 6 2018 Jan hub_1  product_1             6913
 7 2018 Feb hub_1  product_1             2988
 8 2018 Mar hub_1  product_1             7120
 9 2018 Apr hub_1  product_1             3122
10 2018 May hub_1  product_1            11737
# ℹ 6,735 more rows</code></pre>
</div>
</div>
<ul>
<li>What is the temporal granularity of <code>med_tsb</code>?</li>
<li>How many time series do we have in <code>med_tsb</code>?</li>
</ul>
</section>
<section id="check-temporal-gaps-implicit-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="check-temporal-gaps-implicit-missing-values">Check temporal gaps (implicit missing values)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">has_gaps</span>(med_tsb) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>) <span class="co">#check gaps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  hub_id product_id .gaps
  &lt;chr&gt;  &lt;chr&gt;      &lt;lgl&gt;
1 hub_1  product_1  TRUE 
2 hub_1  product_2  TRUE 
3 hub_1  product_3  TRUE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scan_gaps</span>(med_tsb) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>) <span class="co"># show gaps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 3 x 3 [1M]
# Key:       hub_id, product_id [1]
  hub_id product_id     date
  &lt;chr&gt;  &lt;chr&gt;         &lt;mth&gt;
1 hub_1  product_1  2018 Jul
2 hub_1  product_1  2018 Aug
3 hub_1  product_1  2018 Sep</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count_gaps</span>(med_tsb) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>) <span class="co"># count gaps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  hub_id product_id    .from      .to    .n
  &lt;chr&gt;  &lt;chr&gt;         &lt;mth&gt;    &lt;mth&gt; &lt;int&gt;
1 hub_1  product_1  2018 Jul 2021 Feb    32
2 hub_1  product_1  2021 Jul 2022 Sep    15
3 hub_1  product_2  2018 Sep 2018 Sep     1</code></pre>
</div>
</div>
</section>
<section id="check-temporal-gaps-implicit-missing-values-1" class="level2">
<h2 class="anchored" data-anchor-id="check-temporal-gaps-implicit-missing-values-1">Check temporal gaps (implicit missing values)</h2>
<p>If there is any gap, then we fill it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>med_tsb <span class="sc">|&gt;</span> <span class="fu">fill_gaps</span>(<span class="at">quantity_issued=</span><span class="dv">0</span>L) <span class="co"># we can fill it with zero</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 8,795 x 4 [1M]
# Key:       hub_id, product_id [133]
       date hub_id product_id quantity_issued
      &lt;mth&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;
 1 2017 Aug hub_1  product_1              721
 2 2017 Sep hub_1  product_1              795
 3 2017 Oct hub_1  product_1             1720
 4 2017 Nov hub_1  product_1              911
 5 2017 Dec hub_1  product_1              314
 6 2018 Jan hub_1  product_1             6913
 7 2018 Feb hub_1  product_1             2988
 8 2018 Mar hub_1  product_1             7120
 9 2018 Apr hub_1  product_1             3122
10 2018 May hub_1  product_1            11737
# ℹ 8,785 more rows</code></pre>
</div>
</div>
</section>
<section id="check-temporal-gaps-implicit-missing-values-2" class="level2">
<h2 class="anchored" data-anchor-id="check-temporal-gaps-implicit-missing-values-2">Check temporal gaps (implicit missing values)</h2>
<p><em>Note:</em> Since the main focus of this study is to provide foundational knowledge on forecasting, we will filter out time series with many missing values and then fill the remaining gaps using <code>na.interp()</code> function <a href="https://search.r-project.org/CRAN/refmans/forecast/html/na.interp.html">(Read more)</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>item_ids <span class="ot">&lt;-</span> med_tsb <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count_gaps</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hub_id, product_id) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">.n =</span> <span class="fu">max</span>(.n), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.n  <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">paste0</span>(hub_id,<span class="st">'-'</span>,product_id)) <span class="sc">|&gt;</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(id) <span class="co"># filtering the item ids</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="ot">&lt;-</span> med_tsb <span class="sc">|&gt;</span> </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">paste0</span>(hub_id,<span class="st">'-'</span>,product_id)) <span class="sc">|&gt;</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hub_id, product_id) <span class="sc">|&gt;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_observations =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>id <span class="sc">%in%</span> item_ids <span class="sc">&amp;</span> num_observations <span class="sc">&gt;</span><span class="dv">59</span>) <span class="sc">|&gt;</span>   <span class="co"># we have cold starts and discontinuations. </span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill_gaps</span>(<span class="at">quantity_issued =</span> <span class="fl">1e-6</span>, <span class="at">.full =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span>   <span class="co"># Replace NAs with a small value</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id, <span class="sc">-</span>num_observations) <span class="sc">|&gt;</span> </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quantity_issued =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(quantity_issued), </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">exp</span>(</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                                     forecast<span class="sc">::</span><span class="fu">na.interp</span>(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ts</span>(<span class="fu">log</span>(quantity_issued), <span class="at">frequency =</span> <span class="dv">12</span>))), </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                                   quantity_issued))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-wrangaling-using-tsibble" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangaling-using-tsibble">Data wrangaling using <code>tsibble</code></h2>
<p>We can use the <code>filter()</code> function to select rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>med_tsb <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_10'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 417 x 4 [1M]
# Key:       hub_id, product_id [7]
       date hub_id product_id quantity_issued
      &lt;mth&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;
 1 2017 Jul hub_10 product_1              343
 2 2017 Aug hub_10 product_1               67
 3 2017 Sep hub_10 product_1              127
 4 2017 Oct hub_10 product_1              287
 5 2017 Nov hub_10 product_1              759
 6 2017 Dec hub_10 product_1              181
 7 2018 Jan hub_10 product_1             7015
 8 2018 Feb hub_10 product_1              840
 9 2018 Mar hub_10 product_1             4111
10 2018 Apr hub_10 product_1             1910
# ℹ 407 more rows</code></pre>
</div>
</div>
</section>
<section id="data-wrangaling-using-tsibble-1" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangaling-using-tsibble-1">Data wrangaling using <code>tsibble</code></h2>
<p>We can use the <code>select()</code> function to select columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>med_tsb <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_10'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, product_id, quantity_issued)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 417 x 3 [1M]
# Key:       product_id [7]
       date product_id quantity_issued
      &lt;mth&gt; &lt;chr&gt;                &lt;dbl&gt;
 1 2017 Jul product_1              343
 2 2017 Aug product_1               67
 3 2017 Sep product_1              127
 4 2017 Oct product_1              287
 5 2017 Nov product_1              759
 6 2017 Dec product_1              181
 7 2018 Jan product_1             7015
 8 2018 Feb product_1              840
 9 2018 Mar product_1             4111
10 2018 Apr product_1             1910
# ℹ 407 more rows</code></pre>
</div>
</div>
</section>
<section id="data-wrangaling-using-tsibble-2" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangaling-using-tsibble-2">Data wrangaling using <code>tsibble</code></h2>
<p>We can use <code>group_by()</code> function to group over keys. We can use the <code>summarise()</code> function to summarise over keys.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>med_tsb <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_id) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_quantity_issued =</span> <span class="fu">sum</span>(quantity_issued), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 471 x 3 [1M]
# Key:       product_id [7]
   product_id     date total_quantity_issued
   &lt;chr&gt;         &lt;mth&gt;                 &lt;dbl&gt;
 1 product_1  2017 Jul                   691
 2 product_1  2017 Aug                 18855
 3 product_1  2017 Sep                 21654
 4 product_1  2017 Oct                 16456
 5 product_1  2017 Nov                 19694
 6 product_1  2017 Dec                 63107
 7 product_1  2018 Jan                 66703
 8 product_1  2018 Feb                 53012
 9 product_1  2018 Mar                 82566
10 product_1  2018 Apr                 56913
# ℹ 461 more rows</code></pre>
</div>
</div>
</section>
<section id="data-wrangaling-using-tsibble-3" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangaling-using-tsibble-3">Data wrangaling using <code>tsibble</code></h2>
<p>We can use the <code>mutate()</code> function to create new variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>med_tsb <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quarter =</span> <span class="fu">yearquarter</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 6,745 x 5 [1M]
# Key:       hub_id, product_id [133]
       date hub_id product_id quantity_issued quarter
      &lt;mth&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;   &lt;qtr&gt;
 1 2017 Aug hub_1  product_1              721 2017 Q3
 2 2017 Sep hub_1  product_1              795 2017 Q3
 3 2017 Oct hub_1  product_1             1720 2017 Q4
 4 2017 Nov hub_1  product_1              911 2017 Q4
 5 2017 Dec hub_1  product_1              314 2017 Q4
 6 2018 Jan hub_1  product_1             6913 2018 Q1
 7 2018 Feb hub_1  product_1             2988 2018 Q1
 8 2018 Mar hub_1  product_1             7120 2018 Q1
 9 2018 Apr hub_1  product_1             3122 2018 Q2
10 2018 May hub_1  product_1            11737 2018 Q2
# ℹ 6,735 more rows</code></pre>
</div>
</div>
</section>
<section id="data-wrangaling-using-tsibble-4" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangaling-using-tsibble-4">Data wrangaling using <code>tsibble</code></h2>
<p>We can use <code>index_by()</code> function to group over index We can use the <code>summarise()</code> function to summarise over index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>med_tsb <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quarter =</span> <span class="fu">yearquarter</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">index_by</span>(quarter) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_quantity_issues =</span> <span class="fu">sum</span>(quantity_issued))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 24 x 2 [1Q]
   quarter total_quantity_issues
     &lt;qtr&gt;                 &lt;dbl&gt;
 1 2017 Q3               2103843
 2 2017 Q4               2811202
 3 2018 Q1               2511488
 4 2018 Q2               3433726
 5 2018 Q3               1738860
 6 2018 Q4               2934886
 7 2019 Q1               2452192
 8 2019 Q2               1640048
 9 2019 Q3               2170015
10 2019 Q4               3045525
# ℹ 14 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="now-it-is-your-turn." class="level1">
<h1>Now it is your <code>turn</code>.</h1>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_af34ed6c" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="explore-your-data" class="level1">
<h1>Explore your data</h1>
<section id="time-series-patterns" class="level2">
<h2 class="anchored" data-anchor-id="time-series-patterns">Time series patterns</h2>
<ul>
<li><code>Level</code>: The level of a time series describes the center of the series.</li>
<li><code>Trend</code>: A trend describes predictable increases or decreases in the level of a series.</li>
<li><code>Seasonal</code>: Seasonality is a consistent pattern that repeats over a fixed cycle. pattern exists when a series is influenced by seasonal factors (e.g., the quarter of the year, the month, or day of the week).</li>
<li><code>Cyclic</code>: A pattern exists when data exhibit rises and falls that are not of fixed period (duration usually of at least 2 years).</li>
</ul>
</section>
<section id="time-series-patterns-1" class="level2">
<h2 class="anchored" data-anchor-id="time-series-patterns-1">Time series patterns</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Read more at <a href="https://dfep.netlify.app/">Demand forecasting for executives and professionals</a> by Bahman Rostami-Tabar, Enno Siemsen, and Stephan Kolassa.</p>
</section>
<section id="additive-vs.-multiplicative-seasonality" class="level2">
<h2 class="anchored" data-anchor-id="additive-vs.-multiplicative-seasonality">Additive vs.&nbsp;multiplicative seasonality</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>When we have multiplicative seasonality, we can use transformations to convert multiplicative seasonality into additive seasonality.</li>
<li>In this training, we are not discussing time series transformations. You can read more about it at <a href="https://otexts.com/fpp3/transformations.html">Transformations and adjustments</a>.</li>
</ul>
</section>
<section id="time-plots" class="level2">
<h2 class="anchored" data-anchor-id="time-plots">Time plots</h2>
<p>You can create time plot using <code>autoplot()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_2'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(quantity_issued) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Quantity Issued"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="are-time-plots-best" class="level2">
<h2 class="anchored" data-anchor-id="are-time-plots-best">Are time plots best?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">paste0</span>(hub_id, product_id)) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> quantity_issued, <span class="at">group =</span> id)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Quantity Issued"</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonal-plots" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-plots">Seasonal plots</h2>
<ul>
<li>Data plotted against the individual <code>seasons</code> in which the data were observed (In this case a “season” is a month).</li>
<li>Enables the underlying seasonal pattern to be seen more clearly, and also allows any substantial departures from the seasonal pattern to be easily identified.</li>
<li>You can create seasonal plots using <code>gg_season()</code> function.</li>
</ul>
</section>
<section id="seasonal-plots-1" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-plots-1">Seasonal plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_14'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(quantity_issued, <span class="at">labels =</span> <span class="st">"both"</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Quantity issued"</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Seasonal plot"</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonal-sub-series-plots" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-sub-series-plots">Seasonal sub series plots</h2>
<ul>
<li>Data for each season collected together in time plot as separate time series.</li>
<li>Enables the underlying seasonal pattern to be seen clearly, and changes in seasonality over time to be visualized.</li>
<li>You can create seasonal sub series plots using <code>gg_subseries()</code> function.</li>
</ul>
</section>
<section id="seasonal-sub-series-plots-1" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-sub-series-plots-1">Seasonal sub series plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_14'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(quantity_issued) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Quantity issued"</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Seasonal sub series plot"</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="strength-of-seasonality-and-trend" class="level2">
<h2 class="anchored" data-anchor-id="strength-of-seasonality-and-trend">Strength of seasonality and trend</h2>
<ul>
<li>We used STL decomposition for additive decompositions.</li>
<li>A multiplicative decomposition can be obtained by first taking logs of the data, then back-transforming the components.</li>
<li>Decompositions that are between additive and multiplicative can be obtained using a Box-Cox transformation of the data.</li>
<li>Read more at <a href="https://otexts.com/fpp3/stl.html">STL decomposition</a>.</li>
</ul>
</section>
<section id="strength-of-seasonality-and-trend-1" class="level2">
<h2 class="anchored" data-anchor-id="strength-of-seasonality-and-trend-1">Strength of seasonality and trend</h2>
<p><strong>STL Decomposition</strong></p>
<p><span class="math display">\[
y_t = T_t + S_t + R_t
\]</span></p>
<p><strong>Seasonal Strength</strong></p>
<p><span class="math display">\[
\max \left( 0, 1 - \frac{\text{Var}(R_t)}{\text{Var}(S_t + R_t)} \right)
\]</span></p>
<p><strong>Trend Strength</strong></p>
<p><span class="math display">\[
\max \left( 0, 1 - \frac{\text{Var}(R_t)}{\text{Var}(T_t + R_t)} \right)
\]</span></p>
</section>
<section id="feature-extraction-and-statistics" class="level2">
<h2 class="anchored" data-anchor-id="feature-extraction-and-statistics">Feature extraction and statistics</h2>
<p>We can use <code>features()</code> function to extract the strength of trend and seasonality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(quantity_issued, feat_stl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 11
   hub_id product_id trend_strength seasonal_strength_year seasonal_peak_year
   &lt;chr&gt;  &lt;chr&gt;               &lt;dbl&gt;                  &lt;dbl&gt;              &lt;dbl&gt;
 1 hub_1  product_2           0.261                 0.503                   6
 2 hub_1  product_5           0.250                 0.438                   0
 3 hub_10 product_5           0.366                 0.0911                  0
 4 hub_11 product_2           0.624                 0.407                  11
 5 hub_11 product_5           0.352                 0.244                   4
 6 hub_11 product_7           0.181                 0.196                   7
 7 hub_13 product_5           0.196                 0.402                   0
 8 hub_14 product_5           0.595                 0.229                   9
 9 hub_16 product_2           0.233                 0.238                   7
10 hub_16 product_5           0.416                 0.272                   0
# ℹ 11 more rows
# ℹ 6 more variables: seasonal_trough_year &lt;dbl&gt;, spikiness &lt;dbl&gt;,
#   linearity &lt;dbl&gt;, curvature &lt;dbl&gt;, stl_e_acf1 &lt;dbl&gt;, stl_e_acf10 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="feature-extraction-and-statistics-1" class="level2">
<h2 class="anchored" data-anchor-id="feature-extraction-and-statistics-1">Feature extraction and statistics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(quantity_issued, feat_stl) <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> trend_strength, <span class="at">y =</span> seasonal_strength_year, <span class="at">shape =</span> product_id)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Seasonal strength"</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Trend strength"</span>) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lag-plots-and-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="lag-plots-and-autocorrelation">Lag plots and autocorrelation</h2>
<ul>
<li>Each graph shows <span class="math inline">\(y_t\)</span> plotted against <span class="math inline">\(y_{t-k}\)</span> for different values of <span class="math inline">\(k\)</span>.<br>
</li>
<li>The <code>autocorrelations</code> are the correlations associated with these scatterplots: <span class="math inline">\(\text{Corr}(y_t, y_{t-k})\)</span></li>
<li>You can create lag plots using <code>gglag()</code> function.</li>
<li>These values indicate the relationship between current and past observations in a time series.</li>
</ul>
</section>
<section id="lag-plots-and-autocorrelation-1" class="level2">
<h2 class="anchored" data-anchor-id="lag-plots-and-autocorrelation-1">Lag plots and autocorrelation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_14'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_lag</span>(quantity_issued, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">geom=</span><span class="st">'point'</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Quantity issued"</span>) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Lag (Quantity issued, n)"</span>) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation">Autocorrelation</h2>
<ul>
<li><code>Autocovariance</code> and <code>autocorrelation</code>: measure linear relationship between <code>lagged values</code> of a time series y.</li>
<li>We denote the <code>sample autocovariance</code> at lag <span class="math inline">\(k\)</span> by <span class="math inline">\(c_k\)</span> and the <code>sample autocorrelation</code> at lag <span class="math inline">\(k\)</span> by <span class="math inline">\(r_k\)</span>. Then, we define:</li>
</ul>
<p><span class="math inline">\(c_k = \frac{1}{T} \sum_{t=k+1}^{T} (y_t - \bar{y})(y_{t-k} - \bar{y})\)</span></p>
<p><span class="math inline">\(r_k = \frac{c_k}{c_0}\)</span></p>
<p>where <span class="math inline">\(c_0\)</span> is the variance of the time series.</p>
<ul>
<li><span class="math inline">\(r_1\)</span> indicates how successive values of <span class="math inline">\(y\)</span> relate to each other.</li>
<li><span class="math inline">\(r_2\)</span> indicates how <span class="math inline">\(y\)</span> values two periods apart relate to each other.</li>
<li><span class="math inline">\(r_k\)</span> is almost the same as the <code>sample correlation</code> between <span class="math inline">\(y_t\)</span> and <span class="math inline">\(y_{t-k}\)</span>.</li>
</ul>
</section>
<section id="autocorrelation-1" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation-1">Autocorrelation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_14'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(quantity_issued, <span class="at">lag_max =</span> <span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 24 x 4 [1M]
# Key:       hub_id, product_id [1]
   hub_id product_id      lag      acf
   &lt;chr&gt;  &lt;chr&gt;      &lt;cf_lag&gt;    &lt;dbl&gt;
 1 hub_14 product_5        1M  0.681  
 2 hub_14 product_5        2M  0.485  
 3 hub_14 product_5        3M  0.320  
 4 hub_14 product_5        4M  0.160  
 5 hub_14 product_5        5M  0.195  
 6 hub_14 product_5        6M  0.162  
 7 hub_14 product_5        7M  0.0956 
 8 hub_14 product_5        8M  0.0540 
 9 hub_14 product_5        9M  0.00739
10 hub_14 product_5       10M -0.0665 
# ℹ 14 more rows</code></pre>
</div>
</div>
</section>
<section id="autocorrelation-2" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation-2">Autocorrelation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_14'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(quantity_issued, <span class="at">lag_max =</span> <span class="dv">36</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What autocorrelation will tell us? Which key features could be highlighted by ACF?</p>
</section>
<section id="autocorrelation-3" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation-3">Autocorrelation</h2>
<ul>
<li>When data have a trend, the autocorrelations for small lags tend to be large and positive.</li>
<li>When data are seasonal, the autocorrelations will be larger at the seasonal lags (i.e., at multiples of the seasonal frequency)</li>
<li>When data are trended and seasonal, you see a combination of these effects.</li>
</ul>
</section>
</section>
<section id="now-it-is-your-turn.-1" class="level1">
<h1>Now it is your <code>turn</code>.</h1>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_eacbf1e3" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="forecast-modelling" class="level1">
<h1>Forecast modelling</h1>
<section id="naive" class="level2">
<h2 class="anchored" data-anchor-id="naive">Naive</h2>
<p>Simplest forecasting method using last observation as forecast.</p>
<p><span class="math inline">\(\hat{y}_{t+h|t} = y_t\)</span></p>
<p><strong>Assumptions</strong></p>
<ul>
<li>No systematic pattern in data</li>
<li>Recent observations are most relevant</li>
</ul>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ Simple benchmark model</span><br>
<span style="color:green;">✓ Requires no computation</span><br>
<span style="color:red;">✗ Ignores all patterns</span><br>
<span style="color:red;">✗ Poor for trending/seasonal data</span></p>
</section>
<section id="naive-1" class="level2">
<h2 class="anchored" data-anchor-id="naive-1">Naive</h2>
<p>We use <code>NAIVE()</code> function and <code>model()</code> function to build the Naive model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">naive =</span> <span class="fu">NAIVE</span>(quantity_issued)) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>), <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Quantity issued"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonal-naive-snaive" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-naive-snaive">Seasonal NAIVE (sNAIVE)</h2>
<p><span class="math inline">\(y_{t+h \mid t} = y_{t+h - m(k+1)}\)</span></p>
<p>Where: <span class="math inline">\(m\)</span> = seasonal period and <span class="math inline">\(k = \lfloor \frac{h-1}{m} \rfloor\)</span></p>
<p><strong>Assumptions</strong></p>
<ul>
<li>Seasonal pattern is stable</li>
<li>No trend present</li>
</ul>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ Handles strong seasonality</span><br>
<span style="color:green;">✓ Simple interpretation</span><br>
<span style="color:red;">✗ Fails with changing seasonality</span><br>
<span style="color:red;">✗ Ignores non-seasonal patterns</span></p>
</section>
<section id="snaive" class="level2">
<h2 class="anchored" data-anchor-id="snaive">sNaive</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">snaive =</span> <span class="fu">SNAIVE</span>(quantity_issued <span class="sc">~</span> <span class="fu">lag</span>(<span class="st">"year"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>) <span class="sc">|&gt;</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>), <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Quantity issued"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mean" class="level2">
<h2 class="anchored" data-anchor-id="mean">Mean</h2>
<p>Uses the historical average of all observations as forecast.</p>
<p><span class="math inline">\(y_{t+h \mid t} = \bar{y} = \frac{1}{t} \sum_{i=1}^{t} y_i\)</span></p>
<p>Where: <span class="math inline">\(t\)</span> is the number of past observations used for the forecast.</p>
<p><strong>Assumptions</strong></p>
<ul>
<li>Series is stationary</li>
<li>Short-term fluctuations are noise</li>
</ul>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ Effective noise reduction</span><br>
<span style="color:green;">✓ Simple to implement</span><br>
<span style="color:red;">✗ Ignores all patterns</span><br>
<span style="color:red;">✗ Lags behind trends</span></p>
</section>
<section id="mean-1" class="level2">
<h2 class="anchored" data-anchor-id="mean-1">Mean</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(quantity_issued <span class="sc">~</span> <span class="fu">window</span>(<span class="at">size =</span> <span class="dv">3</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>), <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Quantity issued"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="arima" class="level2">
<h2 class="anchored" data-anchor-id="arima">ARIMA</h2>
<p>Combines Autoregressive (AR) and Moving Average (MA) components with differencing.</p>
<ul>
<li><code>AR</code>: autoregressive (lagged observations as inputs)</li>
<li><code>I</code>: integrated (differencing to make series stationary)</li>
<li><code>MA</code>: moving average (lagged errors as inputs)</li>
</ul>
<p><br></p>
<p>The ARIMA model is given by:</p>
<p><span class="math inline">\((1 - \phi_1 B - \dots - \phi_p B^p)(1 - B)^d y_t = c + (1 + \theta_1 B + \dots + \theta_q B^q) \epsilon_t\)</span></p>
<p>Where: <span class="math inline">\(B\)</span>: Backshift operator, <span class="math inline">\(\phi\)</span>: AR coefficients, <span class="math inline">\(\theta\)</span>: MA coefficients, <span class="math inline">\(d\)</span>: Differencing order, <span class="math inline">\(p\)</span>: AR order, <span class="math inline">\(q\)</span>: MA order and <span class="math inline">\(\epsilon_t\)</span>: White noise</p>
</section>
<section id="arima-1" class="level2">
<h2 class="anchored" data-anchor-id="arima-1">ARIMA</h2>
<p><strong>Assumptions</strong></p>
<ul>
<li>Series is stationary</li>
<li>Linear relationship between past values and errors</li>
<li>White noise errors</li>
<li>No missing values in series</li>
</ul>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ Flexible for various time series patterns</span><br>
<span style="color:green;">✓ Perform well for short term horizons</span><br>
<span style="color:red;">✗ Requires stationarity for optimal performance</span><br>
<span style="color:red;">✗ The parameters are often not easily interpretable in terms of trend or seasonality</span></p>
</section>
<section id="arima-2" class="level2">
<h2 class="anchored" data-anchor-id="arima-2">ARIMA</h2>
<p>A <code>stationary series</code> is:</p>
<ul>
<li>roughly horizontal<br>
</li>
<li>constant variance<br>
</li>
<li>no patterns predictable in the long-term</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonal-arima-models" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-arima-models">Seasonal ARIMA models</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;">ARIMA</th>
<th style="text-align: center;"><span class="math inline">\(~\underbrace{(p, d, q)}\)</span></th>
<th style="text-align: center;"><span class="math inline">\(\underbrace{(P, D, Q)_{m}}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;"><span class="math inline">\({\uparrow}\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\uparrow}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"></td>
<td style="text-align: center;">Non-seasonal part</td>
<td style="text-align: center;">Seasonal part of</td>
</tr>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;">of the model</td>
<td style="text-align: center;">of the model</td>
</tr>
</tbody>
</table>
<ul>
<li><span class="math inline">\(m\)</span>: number of observations per year.</li>
<li><span class="math inline">\(d\)</span>: first differences, <span class="math inline">\(D\)</span>: seasonal differences</li>
<li><span class="math inline">\(p\)</span>: AR lags, <span class="math inline">\(q\)</span>: MA lags</li>
<li><span class="math inline">\(P\)</span>: seasonal AR lags, <span class="math inline">\(Q\)</span>: seasonal MA lags</li>
</ul>
<p>Seasonal and non-seasonal terms combine multiplicatively.</p>
</section>
<section id="arima-automatic-modelling" class="level2">
<h2 class="anchored" data-anchor-id="arima-automatic-modelling">ARIMA automatic modelling</h2>
<ul>
<li>Plot the data. Identify any unusual observations.</li>
<li>If necessary, transform the data (e.g., Box-Cox transformation) to stabilize the variance.</li>
<li>Use <code>ARIMA()</code> to automatically select a model.</li>
<li>Check the residuals from your chosen model and if they do not look like white noise, try a modified model.</li>
<li>Once the residuals look like white noise, calculate forecasts.</li>
</ul>
</section>
<section id="arima-automatic-modelling-1" class="level2">
<h2 class="anchored" data-anchor-id="arima-automatic-modelling-1">ARIMA automatic modelling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(quantity_issued)) <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>), <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Quantity issued"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ets" class="level2">
<h2 class="anchored" data-anchor-id="ets">ETS</h2>
<p>ETS stands for Exponential Smoothing and is based on a state space framework that decomposes a time series into three components:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 3%">
<col style="width: 11%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th>General Notation</th>
<th></th>
<th>E T S</th>
<th><strong><code>E</code></strong>xponen<strong><code>T</code></strong>ial <strong><code>S</code></strong>moothing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>↗</td>
<td>↑</td>
<td>↖</td>
</tr>
<tr class="even">
<td></td>
<td><strong><code>E</code></strong>rror</td>
<td><strong><code>T</code></strong>rend</td>
<td><strong><code>S</code></strong>eason</td>
</tr>
</tbody>
</table>
<ul>
<li><code>E</code>rror: Additive (<code>"A"</code>) or multiplicative (<code>"M"</code>)</li>
<li><code>T</code>rend: None (<code>"N"</code>), additive (<code>"A"</code>), multiplicative (<code>"M"</code>), or damped (<code>"Ad"</code> or <code>"Md"</code>).</li>
<li><code>S</code>easonality: None (<code>"N"</code>), additive (<code>"A"</code>) or multiplicative (<code>"M"</code>)</li>
</ul>
<p><br> For example, <code>ETS(A,N,N)</code> is the simple exponential smoothing model (no trend or seasonality) with additive errors.</p>
</section>
<section id="ets-1" class="level2">
<h2 class="anchored" data-anchor-id="ets-1">ETS</h2>
<p>How do we combine these elements?</p>
<p><code>Additively</code>?</p>
<p><span class="math inline">\(y_t = \ell_{t-1} + b_{t-1} + s_{t-m} + \varepsilon_t\)</span></p>
<p><br></p>
<p><code>Multiplicatively</code>?</p>
<p><span class="math inline">\(y_t = \ell_{t-1}b_{t-1}s_{t-m}(1 + \varepsilon_t)\)</span></p>
<p><br></p>
<p>Perhaps <code>a mix of both</code>?</p>
<p><span class="math inline">\(y_t = (\ell_{t-1} + b_{t-1}) s_{t-m} + \varepsilon_t\)</span></p>
</section>
<section id="ets-2" class="level2">
<h2 class="anchored" data-anchor-id="ets-2">ETS</h2>
<p>How do the level, trend and seasonal components evolve over time?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/pegel1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="ets-3" class="level2">
<h2 class="anchored" data-anchor-id="ets-3">ETS</h2>
<p><strong>Assumptions</strong></p>
<ul>
<li>Decomposable patterns</li>
<li>Recent observations more important</li>
<li>Consistent error structure (additive/multiplicative)</li>
</ul>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ They can be adapted to various data characteristics with different error, trend, and seasonal formulations</span><br>
<span style="color:green;">✓ Often very effective when the underlying components are stable</span><br>
<span style="color:red;">✗ Parameter estimates (including smoothing parameters and initial states) can affect the forecasts</span><br>
<span style="color:red;">✗ May struggle to capture sudden shifts or non-standard patterns if the smoothing parameters are constant</span></p>
</section>
<section id="ets-automatic-modelling" class="level2">
<h2 class="anchored" data-anchor-id="ets-automatic-modelling">ETS automatic modelling</h2>
<ul>
<li>Apply each model that is appropriate to the data.</li>
<li>Optimize parameters and initial values using MLE (or some other criterion).</li>
<li>Select best method using AICc.</li>
<li>Use <code>ETS()</code> to automatically select a model.</li>
<li>Produce forecasts using best method.</li>
</ul>
</section>
<section id="ets-automatic-modelling-1" class="level2">
<h2 class="anchored" data-anchor-id="ets-automatic-modelling-1">ETS automatic modelling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ETS</span>(quantity_issued)) <span class="sc">|&gt;</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>), <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Quantity issued"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-fitting-in-fable" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting-in-fable">Model fitting in <code>Fable</code></h2>
<ul>
<li>The <code>model()</code> function trains models on data.</li>
<li>It returns a <code>mable</code> object.</li>
<li>A <code>mable</code> is a model table, each cell corresponds to a fitted model.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the models</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>fit_all <span class="ot">&lt;-</span> med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">naive =</span> <span class="fu">NAIVE</span>(quantity_issued),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">snaive =</span> <span class="fu">SNAIVE</span>(quantity_issued <span class="sc">~</span> <span class="fu">lag</span>(<span class="st">'year'</span>)),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">MEAN</span>(quantity_issued <span class="sc">~</span> <span class="fu">window</span>(<span class="at">size =</span> <span class="dv">3</span>)),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">arima =</span> <span class="fu">ARIMA</span>(quantity_issued),</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ets =</span> <span class="fu">ETS</span>(quantity_issued)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>fit_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 7
# Key:     hub_id, product_id [1]
  hub_id product_id   naive   snaive    mean                     arima
  &lt;chr&gt;  &lt;chr&gt;      &lt;model&gt;  &lt;model&gt; &lt;model&gt;                   &lt;model&gt;
1 hub_1  product_5  &lt;NAIVE&gt; &lt;SNAIVE&gt;  &lt;MEAN&gt; &lt;ARIMA(0,1,1)(0,0,2)[12]&gt;
# ℹ 1 more variable: ets &lt;model&gt;</code></pre>
</div>
</div>
</section>
<section id="extract-information-from-mable" class="level2">
<h2 class="anchored" data-anchor-id="extract-information-from-mable">Extract information from <code>mable</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fit_all  <span class="sc">|&gt;</span>  <span class="fu">select</span>(snaive) <span class="sc">|&gt;</span>  <span class="fu">report</span>()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fit_all <span class="sc">|&gt;</span>  <span class="fu">tidy</span>()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>fit_all  <span class="sc">|&gt;</span>  <span class="fu">glance</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The <code>report()</code> function gives a formatted model-specific display.</li>
<li>The <code>tidy()</code> function is used to extract the coefficients from the models.</li>
<li>We can extract information about some specific model using the <code>filter()</code> and <code>select()</code>functions.</li>
</ul>
</section>
<section id="producing-forecasts" class="level2">
<h2 class="anchored" data-anchor-id="producing-forecasts">Producing forecasts</h2>
<ul>
<li>The <code>forecast()</code> function is used to produce forecasts from estimated models.</li>
<li><code>h</code> can be specified with:
<ul>
<li>a number (the number of future observations)</li>
<li>natural language (the length of time to predict)</li>
<li>provide a dataset of future time periods</li>
</ul></li>
</ul>
</section>
<section id="producing-forecasts-1" class="level2">
<h2 class="anchored" data-anchor-id="producing-forecasts-1">Producing forecasts</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fit_all_fc <span class="ot">&lt;-</span> fit_all <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">'year'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#h = "year" is equivalent to setting h = 12.</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>fit_all_fc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 60 x 6 [1M]
# Key:     hub_id, product_id, .model [5]
   hub_id product_id .model     date
   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;mth&gt;
 1 hub_1  product_5  naive  2023 Jul
 2 hub_1  product_5  naive  2023 Aug
 3 hub_1  product_5  naive  2023 Sep
 4 hub_1  product_5  naive  2023 Oct
 5 hub_1  product_5  naive  2023 Nov
 6 hub_1  product_5  naive  2023 Dec
 7 hub_1  product_5  naive  2024 Jan
 8 hub_1  product_5  naive  2024 Feb
 9 hub_1  product_5  naive  2024 Mar
10 hub_1  product_5  naive  2024 Apr
# ℹ 50 more rows
# ℹ 2 more variables: quantity_issued &lt;dist&gt;, .mean &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="visualising-forecasts" class="level2">
<h2 class="anchored" data-anchor-id="visualising-forecasts">Visualising forecasts</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fit_all_fc <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter_index</span>(<span class="st">"2022 JAn"</span> <span class="sc">~</span> .) <span class="sc">|&gt;</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>), <span class="at">color =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecasts for monthly quantity issued"</span>, <span class="at">y =</span> <span class="st">"Quantity issued"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"Forecast"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="now-it-is-your-turn.-2" class="level1">
<h1>Now it is your <code>turn</code>.</h1>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_d702b834" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<section id="what-is-wrong-with-point-forecasts" class="level2">
<h2 class="anchored" data-anchor-id="what-is-wrong-with-point-forecasts">What is wrong with point forecasts?</h2>
<p>A point forecast is a single-value prediction representing the most likely future outcome, based on current data and models.</p>
<p>The disadvantage of point forecast;</p>
<p><span style="color:red;">✗ It ignores additional information in future.</span><br>
<span style="color:red;">✗ It does not explain uncertainties around future.</span><br>
<span style="color:red;">✗ It can not deal with assymmetric.</span></p>
</section>
<section id="types-of-probabilistic-forecasts" class="level2">
<h2 class="anchored" data-anchor-id="types-of-probabilistic-forecasts">Types of probabilistic forecasts</h2>
<p><code>Interval forecasts</code>: A prediction interval is an interval within which power generation may lie, with a certain probability.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/interval_fc.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="types-of-probabilistic-forecasts-1" class="level2">
<h2 class="anchored" data-anchor-id="types-of-probabilistic-forecasts-1">Types of probabilistic forecasts</h2>
<p><code>Quantile forecasts</code>: A quantile forecast provides a value that the future observation is expected to be below with a specified probability.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/quantile_fc.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="types-of-probabilistic-forecasts-2" class="level2">
<h2 class="anchored" data-anchor-id="types-of-probabilistic-forecasts-2">Types of probabilistic forecasts</h2>
<p><code>Distribution forecasts</code>: A comprehensive probabilistic forecast capturing the full range of potential outcomes across all time horizons.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/density_fc.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="types-of-probabilistic-forecasts-3" class="level2">
<h2 class="anchored" data-anchor-id="types-of-probabilistic-forecasts-3">Types of probabilistic forecasts</h2>
<p><code>Scenario forecasts</code>: A spectrum of potential futures derived from probabilistic modeling to inform decision- making under uncertainty.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/scenario_fc.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="forecast-distributions-from-bootstrapping" class="level2">
<h2 class="anchored" data-anchor-id="forecast-distributions-from-bootstrapping">Forecast distributions from <code>bootstrapping</code></h2>
<p>When a normal distribution for the residuals is an unreasonable assumption, one alternative is to use <code>bootstrapping</code>, which only assumes that the residuals are uncorrelated with constant variance.</p>
<ul>
<li>A one-step forecast error is defined as</li>
</ul>
<p><span class="math inline">\(e_t = y_t - \hat{y}_{t|t-1}\)</span>, <span class="math inline">\(y_t = \hat{y}_{t|t-1} + e_t\)</span></p>
<ul>
<li>So we can simulate the next observation of a time series using</li>
</ul>
<p><span class="math inline">\(y_{T+1} = \hat{y}_{T+1|T} + e_{T+1}\)</span></p>
<ul>
<li>Adding the new simulated observation to our data set, we can repeat the process to obtain</li>
</ul>
<p><span class="math inline">\(y_{T+2} = \hat{y}_{T+2|T+1} + e_{T+2}\)</span></p>
</section>
<section id="generate-different-futures-forecast" class="level2">
<h2 class="anchored" data-anchor-id="generate-different-futures-forecast">Generate different futures forecast</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">snaive =</span> <span class="fu">SNAIVE</span>(quantity_issued <span class="sc">~</span> <span class="fu">lag</span>(<span class="st">"year"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">h =</span> <span class="dv">12</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>, <span class="at">times =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="generate-probabilistic-forecast" class="level2">
<h2 class="anchored" data-anchor-id="generate-probabilistic-forecast">Generate probabilistic forecast</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">snaive =</span> <span class="fu">SNAIVE</span>(quantity_issued <span class="sc">~</span> <span class="fu">lag</span>(<span class="st">"year"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>, <span class="at">times =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 12 x 6 [1M]
# Key:     hub_id, product_id, .model [1]
   hub_id product_id .model     date quantity_issued  .mean
   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;mth&gt;          &lt;dist&gt;  &lt;dbl&gt;
 1 hub_1  product_5  snaive 2023 Jul    sample[1000]  3790.
 2 hub_1  product_5  snaive 2023 Aug    sample[1000] 32090.
 3 hub_1  product_5  snaive 2023 Sep    sample[1000] 13039.
 4 hub_1  product_5  snaive 2023 Oct    sample[1000] 13203.
 5 hub_1  product_5  snaive 2023 Nov    sample[1000] 28567.
 6 hub_1  product_5  snaive 2023 Dec    sample[1000] 26470.
 7 hub_1  product_5  snaive 2024 Jan    sample[1000] 11766.
 8 hub_1  product_5  snaive 2024 Feb    sample[1000] 25393.
 9 hub_1  product_5  snaive 2024 Mar    sample[1000] 11540.
10 hub_1  product_5  snaive 2024 Apr    sample[1000] 11942.
11 hub_1  product_5  snaive 2024 May    sample[1000] 16975.
12 hub_1  product_5  snaive 2024 Jun    sample[1000]  5496.</code></pre>
</div>
</div>
</section>
<section id="prediction-intervals" class="level2">
<h2 class="anchored" data-anchor-id="prediction-intervals">Prediction intervals</h2>
<p>Forecast intervals can be extracted using the <code>hilo()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>med_tsb_filter <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">snaive =</span> <span class="fu">SNAIVE</span>(quantity_issued <span class="sc">~</span> <span class="fu">lag</span>(<span class="st">"year"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>, <span class="at">times =</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hilo</span>(<span class="at">level =</span> <span class="dv">75</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unpack_hilo</span>(<span class="st">"75%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 12 x 8 [1M]
# Key:       hub_id, product_id, .model [1]
   hub_id product_id .model     date quantity_issued  .mean `75%_lower`
   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;mth&gt;          &lt;dist&gt;  &lt;dbl&gt;       &lt;dbl&gt;
 1 hub_1  product_5  snaive 2023 Jul    sample[1000]  3509.     -8015. 
 2 hub_1  product_5  snaive 2023 Aug    sample[1000] 32690.     20230. 
 3 hub_1  product_5  snaive 2023 Sep    sample[1000] 12713.       850. 
 4 hub_1  product_5  snaive 2023 Oct    sample[1000] 13433.      1624. 
 5 hub_1  product_5  snaive 2023 Nov    sample[1000] 29074.     16981. 
 6 hub_1  product_5  snaive 2023 Dec    sample[1000] 25767.     14190. 
 7 hub_1  product_5  snaive 2024 Jan    sample[1000] 11377.       -48.1
 8 hub_1  product_5  snaive 2024 Feb    sample[1000] 25310.     13406. 
 9 hub_1  product_5  snaive 2024 Mar    sample[1000] 11876.      -410. 
10 hub_1  product_5  snaive 2024 Apr    sample[1000] 12137.       -44.1
11 hub_1  product_5  snaive 2024 May    sample[1000] 16901.      4829. 
12 hub_1  product_5  snaive 2024 Jun    sample[1000]  5407.     -6448. 
# ℹ 1 more variable: `75%_upper` &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="now-it-is-your-turn.-3" class="level1">
<h1>Now it is your <code>turn</code>.</h1>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_67fe71ff" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="evaluating-the-model-performances" class="level1">
<h1>Evaluating the model performances</h1>
<section id="forecast-accuracy-evaluation-using-test-sets" class="level2">
<h2 class="anchored" data-anchor-id="forecast-accuracy-evaluation-using-test-sets">Forecast accuracy evaluation using test sets</h2>
<ul>
<li>We mimic the real life situation</li>
<li>We pretend we don’t know some part of data (new data)</li>
<li>It must not be used for <code>any</code> aspect of model training</li>
<li>Forecast accuracy is computed only based on the test set</li>
</ul>
<p><code>Training and test sets</code></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/traintest-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluating-point-forecast-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-point-forecast-accuracy">Evaluating <code>point forecast</code> accuracy</h2>
<ul>
<li>In order to evaluate the performance of a forecasting model, we compute its forecast accuracy.</li>
<li>Forecast accuracy is compared by measuring errors based on the test set.</li>
<li>Ideally it should allow comparing benefits from improved accuracy with the cost of obtaining the improvement.</li>
</ul>
</section>
<section id="evaluating-point-forecast-accuracy-1" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-point-forecast-accuracy-1">Evaluating <code>point forecast</code> accuracy</h2>
<p><strong>Forecast Error</strong></p>
<p><span class="math inline">\(e_{T+h} = y_{T+h} - \hat{y}_{T+h\mid T}\)</span></p>
<p>where<br>
- <span class="math inline">\(y_{T+h}\)</span> is the <span class="math inline">\((T+h)^\text{th}\)</span> observation <span class="math inline">\((h=1,\dots,H)\)</span>, and<br>
- <span class="math inline">\(\hat{y}_{T+h\mid T}\)</span> is the forecast based on data up to time <span class="math inline">\(T\)</span>.</p>
<p><br></p>
<p>Read more on <a href="https://openforecast.org/adam/errorMeasuresSelection.html">How to choose appropriate error measure</a> by Ivan Svetunkov.</p>
</section>
<section id="evaluating-point-forecast-accuracy-2" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-point-forecast-accuracy-2">Evaluating <code>point forecast</code> accuracy</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 35%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Measure</strong></th>
<th><strong>Formula</strong></th>
<th><strong>Notes</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>MAE</strong> <br> (Mean Absolute Error)</td>
<td><span class="math inline">\(\text{MAE} = \text{mean}(|e_{T+h}|)\)</span></td>
<td>Scale dependent</td>
</tr>
<tr class="even">
<td><strong>MSE</strong> <br> (Mean Squared Error)</td>
<td><span class="math inline">\(\text{MSE} = \text{mean}(e_{T+h}^2)\)</span></td>
<td>Scale dependent</td>
</tr>
<tr class="odd">
<td><strong>MAPE</strong> <br> (Mean Absolute Percentage Error)</td>
<td><span class="math inline">\(\text{MAPE} = 100\,\text{mean}(|e_{T+h}|/|y_{T+h}|)\)</span></td>
<td>Scale independent; use if <span class="math inline">\(y_t \gg 0\)</span> and <span class="math inline">\(y\)</span> has a natural zero</td>
</tr>
<tr class="even">
<td><strong>RMSE</strong> <br> (Root Mean Squared Error)</td>
<td><span class="math inline">\(\text{RMSE} = \sqrt{\text{mean}(e_{T+h}^2)}\)</span></td>
<td>Scale dependent</td>
</tr>
</tbody>
</table>
</section>
<section id="evaluating-point-forecast-accuracy-3" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-point-forecast-accuracy-3">Evaluating <code>point forecast</code> accuracy</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 35%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Measure</strong></th>
<th><strong>Formula</strong></th>
<th><strong>Notes</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>MASE</strong> <br> (Mean Absolute Scaled Error)</td>
<td><span class="math inline">\(\text{MASE} = \text{mean}(|e_{T+h}|/Q)\)</span></td>
<td><strong>Non-seasonal:</strong> <span class="math inline">\(Q = \frac{1}{T-1}\sum_{t=2}^T |y_t-y_{t-1}|\)</span> <br> <strong>Seasonal:</strong> <span class="math inline">\(Q = \frac{1}{T-m}\sum_{t=m+1}^T |y_t-y_{t-m}|\)</span>, where <span class="math inline">\(m\)</span> is the seasonal frequency</td>
</tr>
<tr class="even">
<td><strong>RMSSE</strong> <br> (Root Mean Squared Scaled Error)</td>
<td><span class="math inline">\(\text{RMSSE} = \sqrt{\text{mean}(e_{T+h}^2/Q)}\)</span></td>
<td><strong>Non-seasonal:</strong> <span class="math inline">\(Q = \frac{1}{T-1}\sum_{t=2}^T (y_t-y_{t-1})^2\)</span> <br> <strong>Seasonal:</strong> <span class="math inline">\(Q = \frac{1}{T-m}\sum_{t=m+1}^T (y_t-y_{t-m})^2\)</span>, where <span class="math inline">\(m\)</span> is the seasonal frequency</td>
</tr>
</tbody>
</table>
</section>
<section id="evaluating-point-forecast-accuracy-4" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-point-forecast-accuracy-4">Evaluating <code>point forecast</code> accuracy</h2>
<p>Create train and test sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>f_horizon <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="co"># forecast horizon</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> med_tsb_filter <span class="sc">|&gt;</span> <span class="co"># create train set</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(. <span class="sc">~</span> <span class="st">'2022 June'</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>fit_all <span class="ot">&lt;-</span> train <span class="sc">|&gt;</span> <span class="co"># model fitting</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">naive =</span> <span class="fu">NAIVE</span>(quantity_issued),</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">snaive =</span> <span class="fu">SNAIVE</span>(quantity_issued <span class="sc">~</span> <span class="fu">lag</span>(<span class="st">'year'</span>)),</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">MEAN</span>(quantity_issued <span class="sc">~</span> <span class="fu">window</span>(<span class="at">size =</span> <span class="dv">3</span>)),</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">arima =</span> <span class="fu">ARIMA</span>(quantity_issued),</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ets =</span> <span class="fu">ETS</span>(quantity_issued)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>fit_all_fc <span class="ot">&lt;-</span> fit_all <span class="sc">|&gt;</span> <span class="co"># forecasting</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> f_horizon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluating-point-forecast-accuracy-5" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-point-forecast-accuracy-5">Evaluating <code>point forecast</code> accuracy</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fit_all_fc <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(med_tsb_filter <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">measures =</span> <span class="fu">list</span>(point_accuracy_measures))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 12
  .model hub_id product_id .type     ME   RMSE    MAE    MPE  MAPE  MASE RMSSE
  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima  hub_1  product_5  Test   5787. 10679.  8732.   5.08  59.3  1.23  1.21
2 ets    hub_1  product_5  Test   5400. 11163.  8681.   5.33  57.0  1.23  1.27
3 mean   hub_1  product_5  Test   8568. 12274.  9664.  29.9   54.3  1.37  1.39
4 naive  hub_1  product_5  Test  -3627.  9508.  8803. -76.1   94.1  1.24  1.08
5 snaive hub_1  product_5  Test   5237. 12571. 11346.  -1.06  85.6  1.60  1.43
# ℹ 1 more variable: ACF1 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="evaluating-probabilistic-forecast-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-probabilistic-forecast-accuracy">Evaluating <code>probabilistic forecast</code> accuracy</h2>
<p><code>Coverage</code></p>
<ul>
<li>Measures how often the true value falls within a prediction interval</li>
<li>Typically assessed for specific confidence levels (e.g., 95% interval)</li>
</ul>
<p>Example: A 95% prediction interval should contain the true value 95% of the time.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluating-probabilistic-forecast-accuracy-1" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-probabilistic-forecast-accuracy-1">Evaluating <code>probabilistic forecast</code> accuracy</h2>
<p><code>Sharpness</code></p>
<ul>
<li>Refers to the width of prediction intervals</li>
<li>Measures how precise or focused the forecast is</li>
</ul>
<p><em>Example</em>: A forecast predicting monthly sales qty between 2500-5000 is sharper than 500-10000.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluating-probabilistic-forecast-accuracy-2" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-probabilistic-forecast-accuracy-2">Evaluating <code>probabilistic forecast</code> accuracy</h2>
<p><code>Quantile score/ Pin ball loss</code></p>
<ul>
<li>Assesses entire prediction interval, not just point forecast</li>
<li>Penalizes too narrow and too wide intervals</li>
<li>Interpretation: Lower values indicate better calibrated intervals</li>
</ul>
<p><span class="math display">\[
Q_{p,t} =
\begin{cases}
2(1 - p)(f_{p,t} - y_t), &amp; \text{if } y_t &lt; f_{p,t}, \\[1mm]
2p(y_t - f_{p,t}),       &amp; \text{if } y_t \geq f_{p,t}.
\end{cases}
\]</span></p>
</section>
<section id="evaluating-probabilistic-forecast-accuracy-3" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-probabilistic-forecast-accuracy-3">Evaluating <code>probabilistic forecast</code> accuracy</h2>
<p><code>CRPS (Continuous Ranked Probability Score)</code></p>
<ul>
<li>Proper scoring rule</li>
<li>Measures accuracy of full predictive distribution</li>
<li>Generalizes absolute error to probabilistic forecasts</li>
<li>Interpretation: Lower CRPS = better forecast</li>
<li>Advantage: Sensitive to distance, rewards sharp and calibrated forecasts</li>
</ul>
<p><span class="math inline">\(\large \text{CRPS} = \text{mean}(p_j),\)</span></p>
<p>where</p>
<p><span class="math inline">\(p_j = \int_{-\infty}^{\infty} \left(G_j(x) - F_j(x)\right)^2dx,\)</span></p>
</section>
<section id="evaluating-probabilistic-forecast-accuracy-4" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-probabilistic-forecast-accuracy-4">Evaluating <code>probabilistic forecast</code> accuracy</h2>
<p><code>CRPS (Continuous Ranked Probability Score)</code></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="epss_training_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluating-probabilistic-forecast-accuracy-5" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-probabilistic-forecast-accuracy-5">Evaluating <code>probabilistic forecast</code> accuracy</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fit_all_fc <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(med_tsb_filter <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(hub_id <span class="sc">==</span> <span class="st">'hub_1'</span> <span class="sc">&amp;</span> product_id <span class="sc">==</span> <span class="st">'product_5'</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">measures =</span> <span class="fu">list</span>(distribution_accuracy_measures)) <span class="sc">|&gt;</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>percentile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  .model hub_id product_id .type  CRPS
  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;
1 arima  hub_1  product_5  Test  6311.
2 ets    hub_1  product_5  Test  6648.
3 mean   hub_1  product_5  Test  7081.
4 naive  hub_1  product_5  Test  8034.
5 snaive hub_1  product_5  Test  7823.</code></pre>
</div>
</div>
</section>
</section>
<section id="now-it-is-your-turn.-4" class="level1">
<h1>Now it is your <code>turn</code>.</h1>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_be4ff442" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="advance-forecasting-models" class="level1">
<h1>Advance forecasting models</h1>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature engineering</h2>
<p>In this training, we only do a basic feature engineering.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> files</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>uploaded <span class="op">=</span> files.upload()</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'med_tsb_filter.csv'</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the yearmonth as date format</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'date'</span>]) <span class="op">+</span> pd.offsets.MonthEnd(<span class="dv">0</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature Engineering</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.month  <span class="co"># create month feature</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># categorical encoding</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>enc <span class="op">=</span> OrdinalEncoder()</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'hub_id_cat'</span>, <span class="st">'product_id_cat'</span>]] <span class="op">=</span> enc.fit_transform(df[[<span class="st">'hub_id'</span>, <span class="st">'product_id'</span>]])</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create unique identifier for series</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'unique_id'</span>] <span class="op">=</span> df[<span class="st">'hub_id'</span>] <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> df[<span class="st">'product_id'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-engineering-1" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering-1">Feature engineering</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create series and exogenous data</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> df[[<span class="st">'date'</span>, <span class="st">'unique_id'</span>, <span class="st">'quantity_issued'</span>]]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>exog <span class="op">=</span> df[[<span class="st">'date'</span>, <span class="st">'unique_id'</span>, <span class="st">'month'</span>, <span class="st">'hub_id_cat'</span>, <span class="st">'product_id_cat'</span>]]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform series and exog to dictionaries</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>series_dict <span class="op">=</span> series_long_to_dict(</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    data      <span class="op">=</span> series,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    series_id <span class="op">=</span> <span class="st">'unique_id'</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    index     <span class="op">=</span> <span class="st">'date'</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    values    <span class="op">=</span> <span class="st">'quantity_issued'</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    freq      <span class="op">=</span> <span class="st">'M'</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>exog_dict <span class="op">=</span> exog_long_to_dict(</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    data      <span class="op">=</span> exog,</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    series_id <span class="op">=</span> <span class="st">'unique_id'</span>,</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    index     <span class="op">=</span> <span class="st">'date'</span>,</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    freq      <span class="op">=</span> <span class="st">'M'</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-engineering-2" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering-2">Feature engineering</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Partition data in train and test</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>end_train <span class="op">=</span> <span class="st">'2022-06-30'</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>start_test <span class="op">=</span> pd.to_datetime(end_train) <span class="op">+</span> pd.DateOffset(months<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Add 1 month</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>series_dict_train <span class="op">=</span> {k: v.loc[:end_train] <span class="cf">for</span> k, v <span class="kw">in</span> series_dict.items()}</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>exog_dict_train <span class="op">=</span> {k: v.loc[:end_train] <span class="cf">for</span> k, v <span class="kw">in</span> exog_dict.items()}</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>series_dict_test <span class="op">=</span> {k: v.loc[start_test:] <span class="cf">for</span> k, v <span class="kw">in</span> series_dict.items()}</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>exog_dict_test <span class="op">=</span> {k: v.loc[start_test:] <span class="cf">for</span> k, v <span class="kw">in</span> exog_dict.items()}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost" class="level2">
<h2 class="anchored" data-anchor-id="xgboost">XGBoost</h2>
<p><a href="https://www.nvidia.com/en-gb/glossary/xgboost/">Extreme Gradient Boosting (XGBoost)</a> is a scalable tree-based gradient boosting machine learning algorithm.</p>
<p><span class="math inline">\(\hat{y}_{t+h|t} = \sum_{k=1}^K f_k(\mathbf{x}_t), \quad f_k \in \mathcal{F}\)</span></p>
<p>Where: <span class="math inline">\(K\)</span> = number of trees, <span class="math inline">\(f_k\)</span> = tree function, <span class="math inline">\(\mathbf{x}_t\)</span> = feature vector (lags, calendar features, etc.)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/xgboost.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://www.researchgate.net/publication/345327934_Degradation_state_recognition_of_piston_pump_based_on_ICEEMDAN_and_XGBoost/figures?lo=1">source: Rui Guo et al.</a></figcaption>
</figure>
</div>
</section>
<section id="xgboost-1" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-1">XGBoost</h2>
<p><strong>Assumptions</strong></p>
<ul>
<li>Predictive patterns can be captured through feature engineering</li>
<li>Relationships between features and target are stable</li>
<li>No strong temporal dependencies beyond engineered features</li>
</ul>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ Handles non-linear relationships well</span><br>
<span style="color:green;">✓ Provides feature importance metrics</span><br>
<span style="color:red;">✗ Requires careful parameter tuning</span><br>
<span style="color:red;">✗ Less interpretable than linear models</span></p>
</section>
<section id="xgboost-2" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-2">XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit xgboost forecaster</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>regressor_xgb <span class="op">=</span> XGBRegressor(tree_method <span class="op">=</span> <span class="st">'hist'</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                             enable_categorical <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>forecaster_xgb <span class="op">=</span> ForecasterRecursiveMultiSeries(</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                 regressor          <span class="op">=</span> regressor_xgb,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                 transformer_series <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>                 lags               <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>                 dropna_from_series <span class="op">=</span> <span class="va">False</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>forecaster_xgb.fit(series<span class="op">=</span>series_dict_train, exog<span class="op">=</span>exog_dict_train, suppress_warnings<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>forecaster_xgb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost-3" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-3">XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature importance plot for XGB</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>feat_xgb <span class="op">=</span> forecaster_xgb.get_feature_importances()</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'importance'</span>, y<span class="op">=</span><span class="st">'feature'</span>, data<span class="op">=</span>feat_xgb.sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'XGBoost Feature Importance'</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/xgb_feat.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="xgboost-4" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-4">XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XGB predictions and plot</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>boot <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>predictions_xgb <span class="op">=</span> forecaster_xgb.predict_bootstrapping(steps<span class="op">=</span><span class="dv">12</span>, exog<span class="op">=</span>exog_dict_test, n_boot<span class="op">=</span>boot)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction DF and plot example series</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>example_series <span class="op">=</span> <span class="bu">list</span>(series_dict_test.keys())[<span class="dv">2</span>]</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>xgb_pred_test <span class="op">=</span> predictions_xgb[example_series].copy()</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate statistics</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>mean_pred <span class="op">=</span> xgb_pred_test.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>lower_pred <span class="op">=</span> xgb_pred_test.quantile(<span class="fl">0.025</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>upper_pred <span class="op">=</span> xgb_pred_test.quantile(<span class="fl">0.975</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost-5" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-5">XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>plt.plot(series_dict_test[example_series], label<span class="op">=</span><span class="st">'Actual'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>plt.plot(mean_pred, label<span class="op">=</span><span class="st">'XGB Prediction'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>plt.fill_between(mean_pred.index, </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                 lower_pred, </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                 upper_pred,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'XGBoost Forecast with 95% Prediction Intervals'</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/xgb_pred.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="xgboost-6" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-6">XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediciton df</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>pred_id <span class="op">=</span> <span class="bu">list</span>(predictions_xgb.keys())</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty DataFrame</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>xgb_pred <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'date'</span>, <span class="st">'unique_id'</span>, <span class="st">'model'</span>] <span class="op">+</span> [<span class="ss">f'X_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(boot)])</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> pred_id:</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    xgb_pred_test <span class="op">=</span> predictions_xgb[i]</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    xgb_pred_test <span class="op">=</span> xgb_pred_test.reset_index()</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    xgb_pred_test.columns <span class="op">=</span> [<span class="st">'date'</span>] <span class="op">+</span> [<span class="ss">f'X_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(boot)]</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    xgb_pred_test[<span class="st">'unique_id'</span>] <span class="op">=</span> i</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    xgb_pred_test[<span class="st">'model'</span>] <span class="op">=</span> <span class="st">'xgb'</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    xgb_pred <span class="op">=</span> pd.concat([xgb_pred, xgb_pred_test])</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>xgb_pred.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lightgbm" class="level2">
<h2 class="anchored" data-anchor-id="lightgbm">LightGBM</h2>
<p>Light Gradient Boosting Machine (LightGBM) uses leaf-wise tree growth for efficiency whereas other boosting methods divide the tree level‐wise.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lgbm.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://www.researchgate.net/publication/358974017_Predicting_and_Analyzing_Road_Traffic_Injury_Severity_Using_Boosting-Based_Ensemble_Learning_Models_with_SHAPley_Additive_exPlanations">source: Sheng Dong et al.</a></figcaption>
</figure>
</div>
</section>
<section id="lightgbm-1" class="level2">
<h2 class="anchored" data-anchor-id="lightgbm-1">LightGBM</h2>
<p><strong>Assumptions</strong></p>
<ul>
<li>Similar to XGBoost but more efficient with large datasets</li>
<li>Handles categorical features natively</li>
</ul>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ Faster training speed</span><br>
<span style="color:green;">✓ Lower memory usage</span><br>
<span style="color:red;">✗ Sensitive to small datasets</span><br>
<span style="color:red;">✗ May overfit with noisy data</span></p>
</section>
<section id="lightgbm-2" class="level2">
<h2 class="anchored" data-anchor-id="lightgbm-2">LightGBM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit lightgbm forecaster</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>regressor_lgbm <span class="op">=</span> LGBMRegressor(</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                boosting_type <span class="op">=</span> <span class="st">'gbdt'</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                metric <span class="op">=</span> <span class="st">'mae'</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                learning_rate <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                num_iterations <span class="op">=</span> <span class="dv">200</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>                n_estimators <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>                objective <span class="op">=</span> <span class="st">'poisson'</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>forecaster_lgbm <span class="op">=</span> ForecasterRecursiveMultiSeries(</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>                 regressor          <span class="op">=</span> regressor_lgbm, </span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>                 transformer_series <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>                 lags               <span class="op">=</span> <span class="dv">4</span>,  </span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>                 dropna_from_series <span class="op">=</span> <span class="va">False</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>forecaster_lgbm.fit(series<span class="op">=</span>series_dict_train, exog<span class="op">=</span>exog_dict_train, suppress_warnings<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>forecaster_lgbm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lightgbm-3" class="level2">
<h2 class="anchored" data-anchor-id="lightgbm-3">LightGBM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature importance plot for LGBM</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>feat_lgbm <span class="op">=</span> forecaster_lgbm.get_feature_importances()</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'importance'</span>, y<span class="op">=</span><span class="st">'feature'</span>, data<span class="op">=</span>feat_lgbm.sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>))</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'LightGBM Feature Importance'</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lgbm_feat.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="lightgbm-4" class="level2">
<h2 class="anchored" data-anchor-id="lightgbm-4">LightGBM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LGBM predictions and plot</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>boot <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>predictions_lgbm <span class="op">=</span> forecaster_lgbm.predict_bootstrapping(steps<span class="op">=</span><span class="dv">12</span>, exog<span class="op">=</span>exog_dict_test, n_boot<span class="op">=</span>boot)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction DF and plot example series</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>example_series <span class="op">=</span> <span class="bu">list</span>(series_dict_test.keys())[<span class="dv">2</span>]</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>lgbm_pred_test <span class="op">=</span> predictions_lgbm[example_series].copy()</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate statistics</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>mean_pred <span class="op">=</span> lgbm_pred_test.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>lower_pred <span class="op">=</span> lgbm_pred_test.quantile(<span class="fl">0.025</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>upper_pred <span class="op">=</span> lgbm_pred_test.quantile(<span class="fl">0.975</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lightgbm-5" class="level2">
<h2 class="anchored" data-anchor-id="lightgbm-5">LightGBM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>plt.plot(series_dict_test[example_series], label<span class="op">=</span><span class="st">'Actual'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>plt.plot(mean_pred, label<span class="op">=</span><span class="st">'LGBM Prediction'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>plt.fill_between(mean_pred.index, </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                 lower_pred, </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>                 upper_pred,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'LGBM Forecast with 95% Prediction Intervals'</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lgbm_pred.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="lightgbm-6" class="level2">
<h2 class="anchored" data-anchor-id="lightgbm-6">LightGBM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediciton df</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>pred_id <span class="op">=</span> <span class="bu">list</span>(predictions_lgbm.keys())</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty DataFrame</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>lgbm_pred <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'date'</span>, <span class="st">'unique_id'</span>, <span class="st">'model'</span>] <span class="op">+</span> [<span class="ss">f'X_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(boot)])</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> pred_id:</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    lgbm_pred_test <span class="op">=</span> predictions_lgbm[i]</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    lgbm_pred_test <span class="op">=</span> lgbm_pred_test.reset_index()</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    lgbm_pred_test.columns <span class="op">=</span> [<span class="st">'date'</span>] <span class="op">+</span> [<span class="ss">f'X_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(boot)]</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    lgbm_pred_test[<span class="st">'unique_id'</span>] <span class="op">=</span> i</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    lgbm_pred_test[<span class="st">'model'</span>] <span class="op">=</span> <span class="st">'lgbm'</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>    lgbm_pred <span class="op">=</span> pd.concat([lgbm_pred, lgbm_pred_test])</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>lgbm_pred.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model evaluation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics for both models</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>xgb_mase, xgb_rmse, xgb_qs, xgb_crps <span class="op">=</span> calculate_metrics(predictions_xgb, series_dict_test, series_dict_train)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>lgbm_mase, lgbm_rmse, lgbm_qs, lgbm_crps <span class="op">=</span> calculate_metrics(predictions_lgbm, series_dict_test, series_dict_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 26%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Average MASE</th>
<th>Average RMSE</th>
<th>Average Quantile Score</th>
<th>Average CRPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>XGBoost</td>
<td>1.218</td>
<td>4878.992</td>
<td>1151.738</td>
<td>3548.056</td>
</tr>
<tr class="even">
<td>LightGBM</td>
<td>1.061</td>
<td>4953.944</td>
<td>310.234</td>
<td>3498.346</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><em>Note</em>: We can improve the performance of XGBoost and LightGBM through better feature engineering and hyperparameter tuning.</p>
</section>
<section id="timegpt" class="level2">
<h2 class="anchored" data-anchor-id="timegpt">TimeGPT</h2>
<p>Foundational time series model for time series forecasting by Nixtla <a href="https://docs.nixtla.io/docs/getting-started-timegpt_quickstart">(Read more)</a>.</p>
<p><strong>Assumptions</strong></p>
<ul>
<li>No strict stationarity requirements</li>
<li>Automatically handles multiple series</li>
</ul>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ Zero configuration needed</span><br>
<span style="color:green;">✓ Handles complex patterns</span><br>
<span style="color:red;">✗ Requires API access</span><br>
<span style="color:red;">✗ Black-box model</span></p>
</section>
<section id="timegpt-1" class="level2">
<h2 class="anchored" data-anchor-id="timegpt-1">TimeGPT</h2>
<p>Get API key from Nixtla</p>
<ol type="1">
<li>Visit https://nixtla.io/</li>
<li>Sign up for free account</li>
<li>Navigate to API Keys section</li>
<li>Create new key and copy it</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install nixtla</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nixtla <span class="im">import</span> NixtlaClient</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Nixtla client</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>nixtla_client <span class="op">=</span> NixtlaClient(api_key<span class="op">=</span><span class="st">'your_api_key_here'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="timegpt-2" class="level2">
<h2 class="anchored" data-anchor-id="timegpt-2">TimeGPT</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Since we already have done the feature engineering, we dont need to do it again</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create unique identifier and rename columns for TimeGPT</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>df_timegpt <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">'date'</span>: <span class="st">'ds'</span>, <span class="st">'quantity_issued'</span>: <span class="st">'y'</span>}).drop(columns<span class="op">=</span>[<span class="st">'hub_id'</span>, <span class="st">'product_id'</span>])</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into train-test</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>end_train <span class="op">=</span> <span class="st">'2022-06-30'</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> df_timegpt[df_timegpt[<span class="st">'ds'</span>] <span class="op">&lt;=</span> end_train]</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> df_timegpt[df_timegpt[<span class="st">'ds'</span>] <span class="op">&gt;</span> end_train]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="timegpt-3" class="level2">
<h2 class="anchored" data-anchor-id="timegpt-3">TimeGPT</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TimeGPT Base Model</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>timegpt_fcst <span class="op">=</span>  nixtla_client.forecast(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>train_df,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    h<span class="op">=</span><span class="bu">len</span>(test_df[<span class="st">'ds'</span>].unique()),</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">'M'</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>[<span class="dv">90</span>, <span class="dv">95</span>]  <span class="co"># 90% and 95% prediction intervals</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>nixtla_client.plot(train_df, timegpt_fcst, time_col<span class="op">=</span><span class="st">'ds'</span>, target_col<span class="op">=</span><span class="st">'y'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/timegpt.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="timegpt-4" class="level2">
<h2 class="anchored" data-anchor-id="timegpt-4">TimeGPT</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TimeGPT with Exogenous Variables</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare exogenous data</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>exog_features <span class="op">=</span> [<span class="st">'month'</span>, <span class="st">'hub_id_cat'</span>, <span class="st">'product_id_cat'</span>]</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Future exogenous variables (from your test set)</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>future_exog <span class="op">=</span> test_df[[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>] <span class="op">+</span> exog_features]</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>timegpt_reg_fcst <span class="op">=</span> nixtla_client.forecast(</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>train_df,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    X_df<span class="op">=</span>future_exog,</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    h<span class="op">=</span><span class="bu">len</span>(test_df[<span class="st">'ds'</span>].unique()),</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">'M'</span>,</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>[<span class="dv">90</span>, <span class="dv">95</span>]</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>nixtla_client.plot(train_df, timegpt_reg_fcst, time_col<span class="op">=</span><span class="st">'ds'</span>, target_col<span class="op">=</span><span class="st">'y'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/timegpt.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="model-evaluation-1" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation-1">Model evaluation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics for both models</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>xgb_mase, xgb_rmse, xgb_qs, xgb_crps <span class="op">=</span> calculate_metrics(predictions_xgb, series_dict_test, series_dict_train)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>lgbm_mase, lgbm_rmse, lgbm_qs, lgbm_crps <span class="op">=</span> calculate_metrics(predictions_lgbm, series_dict_test, series_dict_train)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics for base model</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>base_metrics <span class="op">=</span> calculate_metrics(timegpt_fcst, test_df, train_df)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics for regressor model</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>reg_metrics <span class="op">=</span> calculate_metrics(timegpt_reg_fcst, test_df, train_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Average MASE</th>
<th>Average RMSE</th>
<th>Average Quantile Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TimeGPT Base Model</td>
<td>1.019</td>
<td>4261.135</td>
<td>41.892</td>
</tr>
<tr class="even">
<td>TimeGPT Regressor Model</td>
<td>1.125</td>
<td>5016.053</td>
<td>57.571</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="other-models" class="level1">
<h1>Other Models</h1>
<section id="demographic-forecasting-method-fpsc-context" class="level2">
<h2 class="anchored" data-anchor-id="demographic-forecasting-method-fpsc-context">Demographic forecasting method (FPSC Context)</h2>
<p>A population-based contraceptive needs estimation model combining:</p>
<ul>
<li>Population dynamics</li>
<li>Family planning indicators</li>
<li>Method/brand distribution factors</li>
</ul>
</section>
<section id="demographic-forecasting-method-fpsc-context-1" class="level2">
<h2 class="anchored" data-anchor-id="demographic-forecasting-method-fpsc-context-1">Demographic forecasting method (FPSC Context)</h2>
<p><span class="math display">\[\begin{equation}
\begin{split}
y_{i,t} = &amp; \left(\sum_{j=15}^{50} \text{mCPR}_{t,j} \times \text{WomenPopulation}_{t,j}\right) \\
           &amp; \times \text{MethodMix}_{t,i} \times \text{CYP}_{t,i} \times \text{BrandMix}_{t,i} \times \text{SourceShare}_t
\end{split}
\end{equation}\]</span></p>
<ul>
<li><span class="math inline">\(i\)</span>: Contraceptive product</li>
<li><span class="math inline">\(t\)</span>: Time period (year)</li>
<li><span class="math inline">\(\text{mCPR}\)</span>: Modern Contraceptive Prevalence Rate (%)</li>
<li><span class="math inline">\(\text{WomenPopulation}\)</span>: Women aged 15-49</li>
<li><span class="math inline">\(\text{MethodMix}\)</span>: Contraceptive method distribution</li>
<li><span class="math inline">\(\text{CYP}\)</span>: Couple-Years of Protection factor</li>
<li><span class="math inline">\(\text{BrandMix}\)</span>: Brand preference distribution</li>
<li><span class="math inline">\(\text{SourceShare}\)</span>: Provider type distribution</li>
</ul>
</section>
<section id="demographic-forecasting-method-fpsc-context-2" class="level2">
<h2 class="anchored" data-anchor-id="demographic-forecasting-method-fpsc-context-2">Demographic forecasting method (FPSC Context)</h2>
<p><strong>Assumptions</strong></p>
<ol type="1">
<li>Stable demographic patterns during forecast period</li>
<li>Consistent reporting of family planning indicators</li>
<li>Accurate CYP values for different methods</li>
<li>Historical brand/source mixes remain valid</li>
<li>Linear relationship between population and needs</li>
<li>Proper spatial distribution via site coordinates</li>
<li>Valid monthly weight distribution</li>
</ol>
</section>
<section id="demographic-forecasting-method-fpsc-context-3" class="level2">
<h2 class="anchored" data-anchor-id="demographic-forecasting-method-fpsc-context-3">Demographic forecasting method (FPSC Context)</h2>
<p><strong>Strengths &amp; Weaknesses</strong></p>
<p><span style="color:green;">✓ Directly ties to population dynamics</span><br>
<span style="color:green;">✓ Incorporates multiple programmatic factors</span><br>
<span style="color:green;">✓ Enables spatial allocation to health sites</span><br>
<span style="color:green;">✓ Aligns with public health planning frameworks</span><br>
<span style="color:red;">✗ Sensitive to input data quality</span><br>
<span style="color:red;">✗ Static assumptions about behavior patterns</span><br>
<span style="color:red;">✗ Limited responsiveness to sudden changes</span><br>
<span style="color:red;">✗ Provides national level need</span></p>
</section>
<section id="demographic-forecasting-method-fpsc-context-4" class="level2">
<h2 class="anchored" data-anchor-id="demographic-forecasting-method-fpsc-context-4">Demographic forecasting method (FPSC Context)</h2>
<p><em>Female condom needs (age 20-15) for 2020 (example)</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 54%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
<th>Unit</th>
<th>Sources</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>A. Women population 20 – 25</strong></td>
<td>345,000</td>
<td># of people</td>
<td>WorldPop</td>
</tr>
<tr class="even">
<td><strong>B. Percentage of women who will use a contraceptive product (mCPR)</strong></td>
<td>68%</td>
<td>%</td>
<td>PMA DataLab</td>
</tr>
<tr class="odd">
<td><strong>C. Percentage of the method mix</strong></td>
<td>26%</td>
<td>%</td>
<td>PMA DataLab</td>
</tr>
<tr class="even">
<td><strong>D. CYP</strong></td>
<td>120</td>
<td>-</td>
<td>USAID</td>
</tr>
<tr class="odd">
<td><strong>E. Percentage of brand A mix</strong></td>
<td>45%</td>
<td>%</td>
<td>Author calculation</td>
</tr>
<tr class="even">
<td><strong>F. Percentage of source mix</strong></td>
<td>13%</td>
<td>%</td>
<td>USAID</td>
</tr>
<tr class="odd">
<td><strong>Total requirement (A × B × C × D × E × F)</strong></td>
<td><strong>629,694</strong></td>
<td># of products</td>
<td>-</td>
</tr>
</tbody>
</table>
</section>
<section id="next-steps-and-further-learning" class="level2">
<h2 class="anchored" data-anchor-id="next-steps-and-further-learning">Next steps and further learning</h2>
<ul>
<li>Forecasting for social good <a href="https://github.com/chamara7h/F4SG">learning labs</a></li>
<li><a href="https://otexts.com/fpp3/">Forecasting: Principles and Practice</a></li>
<li><a href="https://openforecast.org/adam/index.html">Forecasting and Analytics with the Augmented Dynamic Adaptive Model (ADAM)</a></li>
<li><a href="https://nixtlaverse.nixtla.io/">Nixtla</a></li>
<li><a href="https://www.sktime.net/en/v0.20.1/index.html">SKTIME</a></li>
<li><a href="https://skforecast.org/0.14.0/index.html">skforecast</a></li>
</ul>
</section>
</section>
<section id="any-qas" class="level1">
<h1>Any <code>Q/As</code>?</h1>
<section id="post-training-feedback" class="level2">
<h2 class="anchored" data-anchor-id="post-training-feedback">Post-Training Feedback</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/epss_post.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="thank-you" class="level2">
<h2 class="anchored" data-anchor-id="thank-you"><code>Thank you!</code></h2>
<p><br></p>
<div class="center">
<p>Scan the QR Code and follow us on <code>LinkedIn</code>…</p>
</div>
<p><br></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/qr.png" class="quarto-figure quarto-figure-center figure-img" width="400" height="400"></p>
</figure>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Made with ❤️ and Quarto</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>