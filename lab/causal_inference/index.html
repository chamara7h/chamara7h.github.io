<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Harsha Chamara Hewage">
<meta name="dcterms.date" content="2026-02-13">
<meta name="description" content="Tutorial">

<title>Causal inference using Machine Learning – Home</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1e97fe9ca5198b8bd5f6c795842923de.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Causal inference using Machine Learning – Home">
<meta property="og:description" content="Tutorial">
<meta property="og:image" content="cover.png">
<meta property="og:site_name" content="Home">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../phd/index.html"> 
<span class="menu-text">PhD Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../lab/index.html"> 
<span class="menu-text">Learning Lab</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:hewagehrc@gamil.com"> <i class="bi bi-envelope-at-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/chamara7h"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/harshachamara/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=XgQYqK8AAAAJ&amp;hl=en"> <i class="bi bi-bookmark-star-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#part-1-double-lasso-for-testing-the-convergence-hypothesis" id="toc-part-1-double-lasso-for-testing-the-convergence-hypothesis" class="nav-link active" data-scroll-target="#part-1-double-lasso-for-testing-the-convergence-hypothesis">PART 1: Double Lasso for Testing the Convergence Hypothesis</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data analysis</a></li>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model">Fit the model</a></li>
  <li><a href="#extract-the-coefficient-of-interest-gdpsh465" id="toc-extract-the-coefficient-of-interest-gdpsh465" class="nav-link" data-scroll-target="#extract-the-coefficient-of-interest-gdpsh465">Extract the coefficient of interest (<code>gdpsh465</code>)</a></li>
  <li><a href="#interpreting-the-results" id="toc-interpreting-the-results" class="nav-link" data-scroll-target="#interpreting-the-results">Interpreting the results</a></li>
  </ul></li>
  <li><a href="#part-2-impact-of-401k-on-financial-wealth-using-double-machine-learning" id="toc-part-2-impact-of-401k-on-financial-wealth-using-double-machine-learning" class="nav-link" data-scroll-target="#part-2-impact-of-401k-on-financial-wealth-using-double-machine-learning">PART 2: Impact of 401(k) on Financial Wealth using Double Machine Learning</a>
  <ul class="collapse">
  <li><a href="#setup-1" id="toc-setup-1" class="nav-link" data-scroll-target="#setup-1">Setup</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#quick-eda" id="toc-quick-eda" class="nav-link" data-scroll-target="#quick-eda">Quick EDA</a></li>
  <li><a href="#a-simple-baseline-unconditional-mean-differences" id="toc-a-simple-baseline-unconditional-mean-differences" class="nav-link" data-scroll-target="#a-simple-baseline-unconditional-mean-differences">A simple baseline: unconditional mean differences</a></li>
  <li><a href="#the-doubleml-package-estimating-the-average-treatment-effect-of-401k-eligibility-on-net-financial-assets" id="toc-the-doubleml-package-estimating-the-average-treatment-effect-of-401k-eligibility-on-net-financial-assets" class="nav-link" data-scroll-target="#the-doubleml-package-estimating-the-average-treatment-effect-of-401k-eligibility-on-net-financial-assets">The <code>DoubleML</code> package: Estimating the Average Treatment Effect of 401(k) Eligibility on Net Financial Assets</a></li>
  <li><a href="#the-data-backend-doublemldata" id="toc-the-data-backend-doublemldata" class="nav-link" data-scroll-target="#the-data-backend-doublemldata">The Data Backend: <code>DoubleMLData</code></a></li>
  <li><a href="#base-controls" id="toc-base-controls" class="nav-link" data-scroll-target="#base-controls">Base controls</a></li>
  <li><a href="#flexible-controls" id="toc-flexible-controls" class="nav-link" data-scroll-target="#flexible-controls">Flexible controls</a></li>
  <li><a href="#partially-linear-regression-model-plr" id="toc-partially-linear-regression-model-plr" class="nav-link" data-scroll-target="#partially-linear-regression-model-plr">Partially Linear Regression Model (PLR)</a></li>
  <li><a href="#learners" id="toc-learners" class="nav-link" data-scroll-target="#learners">Learners</a></li>
  <li><a href="#plr-results-summary" id="toc-plr-results-summary" class="nav-link" data-scroll-target="#plr-results-summary">PLR results summary</a></li>
  <li><a href="#interactive-regression-model-irm" id="toc-interactive-regression-model-irm" class="nav-link" data-scroll-target="#interactive-regression-model-irm">Interactive Regression Model (IRM)</a></li>
  <li><a href="#irm-with-trees" id="toc-irm-with-trees" class="nav-link" data-scroll-target="#irm-with-trees">IRM with Trees</a></li>
  <li><a href="#irm-with-boosted-trees" id="toc-irm-with-boosted-trees" class="nav-link" data-scroll-target="#irm-with-boosted-trees">IRM with Boosted Trees</a></li>
  <li><a href="#irm-results-summary" id="toc-irm-results-summary" class="nav-link" data-scroll-target="#irm-results-summary">IRM results summary</a></li>
  <li><a href="#iivm-interactive-iv-model" id="toc-iivm-interactive-iv-model" class="nav-link" data-scroll-target="#iivm-interactive-iv-model">IIVM: Interactive IV Model</a></li>
  <li><a href="#iivm-results-summary" id="toc-iivm-results-summary" class="nav-link" data-scroll-target="#iivm-results-summary">IIVM results summary</a></li>
  <li><a href="#all-results-together" id="toc-all-results-together" class="nav-link" data-scroll-target="#all-results-together">All results together</a></li>
  <li><a href="#read-more" id="toc-read-more" class="nav-link" data-scroll-target="#read-more">Read more</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Causal inference using Machine Learning</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">Causal Inference</div>
    <div class="quarto-category">Machine Learning</div>
    <div class="quarto-category">Double Machine Learning</div>
    <div class="quarto-category">R</div>
  </div>
  </div>

<div>
  <div class="description">
    Tutorial
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Harsha Chamara Hewage </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 13, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style>
/* FONT IMPORT */
@import url('[https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap](https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap)');

/* GENERAL STYLING */
body {
  font-family: 'Assistant', sans-serif;
  background-color: #f9f9f9;
}

/* HERO SECTION */
.hero-section {
  background-color: #1a2b48; /* Dark Navy Blue */
  color: #ffffff;
  padding: 60px 20px;
  text-align: center;
  border-radius: 10px;
  margin-top: 20px;
  margin-bottom: 40px;
}
.hero-section h1 {
  font-size: 2.8em;
  font-weight: 700;
  margin-bottom: 10px;
}
.hero-section .description {
  font-size: 1.2em;
  max-width: 700px;
  margin: 0 auto 30px auto;
  opacity: 0.9;
}
.hero-section .author-date {
  font-size: 1em;
  color: #ccc;
}

/* CALL-TO-ACTION BUTTONS */
.cta-buttons {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  margin-top: 30px;
}
.btn-custom {
  padding: 12px 25px;
  font-size: 1em;
  font-weight: 600;
  text-decoration: none;
  border-radius: 8px;
  transition: all 0.3s ease;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.btn-primary {
  background-color: #0A4C6A; /* Professional Teal/Blue */
  color: #fff;
  border: 2px solid #0A4C6A;
}
.btn-primary:hover {
  background-color: #083c54;
  border-color: #083c54;
  transform: translateY(-2px);
}
.btn-secondary {
  background-color: transparent;
  color: #fff;
  border: 2px solid #fff;
}
.btn-secondary:hover {
  background-color: #fff;
  color: #1a2b48;
  transform: translateY(-2px);
}


/* CONTENT SECTION STYLING */
.content-section {
  background-color: #ffffff;
  padding: 40px;
  border-radius: 10px;
  margin-bottom: 40px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}
/* We remove the h2 styling from the generic content section
   to let Quarto's markdown headings take precedence */

</style>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css)">


<div class="hero-section">
  <h1 class="title">Causal inference using Machine Learning</h1>
  <p class="description">Tutorial.</p>
  <p class="author-date">Harsha Chamara Hewage | 2026-02-13</p>
</div>

<div class="content-section">

<section id="part-1-double-lasso-for-testing-the-convergence-hypothesis" class="level1">
<h1>PART 1: Double Lasso for Testing the Convergence Hypothesis</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>We provide an empirical example of <strong>partialling-out with Lasso</strong> (often called <strong>Double Lasso</strong>) to estimate the regression coefficient <span class="math inline">\(\beta_1\)</span> in the high-dimensional linear regression model:</p>
<p><span class="math display">\[
Y = \beta_1 D + \beta_2'W + \epsilon.
\]</span></p>
<p>Specifically, we are interested in how the rates at which economies of different countries grow (<span class="math inline">\(Y\)</span>) are related to the initial wealth levels in each country (<span class="math inline">\(D\)</span>), while controlling for institutional, educational, and other country characteristics (<span class="math inline">\(W\)</span>).</p>
<p>The relationship is captured by <span class="math inline">\(\beta_1\)</span>, the <strong>speed of convergence/divergence</strong>:</p>
<ul>
<li><span class="math inline">\(\beta_1 &lt; 0\)</span>: poorer countries catch up (<strong>convergence</strong>)</li>
<li><span class="math inline">\(\beta_1 &gt; 0\)</span>: poorer countries fall behind (<strong>divergence</strong>)</li>
</ul>
<p>Our inference question is:</p>
<p>Our inference question here is: <em>do poor countries grow faster than rich countries, controlling for educational and other characteristics?</em> In other words, is the speed of convergence negative: <span class="math inline">\(\beta_1 &lt;0?\)</span></p>
<p>This idea is closely related to the <strong>Convergence Hypothesis</strong> predicted by the Solow Growth Model. This is a structural economic model. Under some strong assumptions (not discussed here), this predictive exercise can be given a causal interpretation.</p>
<p><strong>In this dataset:</strong> - <span class="math inline">\(Y\)</span> is the realised annual growth rate of a country’s wealth (GDP per capita growth), - <span class="math inline">\(D\)</span> is the initial level of wealth (GDP per capita at baseline), - <span class="math inline">\(W\)</span> includes education, institutions, openness, political stability, and similar controls.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Install packages (run once)
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are running this notebook for the first time, install these packages.<br>
This chunk is set to <code>eval: false</code> so it will not run automatically when you render.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"hdm"</span>, <span class="st">"broom"</span>, <span class="st">"modelsummary"</span>, <span class="st">"gt"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hdm)          <span class="co"># high-dimensional methods including rlasso and rlassoEffect</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)        <span class="co"># tidy model summaries</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary) <span class="co"># clean regression tables</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="data-analysis">Data analysis</h2>
<p>We consider the dataset GrowthData, which is included in the package hdm.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(GrowthData) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>intercept)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>growth <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 62
  Outcome gdpsh465 bmp1l freeop freetar   h65  hm65  hf65   p65  pm65  pf65
    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 -0.0243     6.59 0.284  0.153 0.0439  0.007 0.013 0.001  0.29  0.37  0.21
2  0.100      6.83 0.614  0.314 0.0618  0.019 0.032 0.007  0.91  1     0.65
3  0.0671     8.90 0      0.204 0.00919 0.26  0.325 0.201  1     1     1   
4  0.0641     7.57 0.200  0.249 0.0363  0.061 0.07  0.051  1     1     1   
5  0.0279     7.16 0.174  0.299 0.0374  0.017 0.027 0.007  0.82  0.85  0.81
# ℹ 51 more variables: s65 &lt;dbl&gt;, sm65 &lt;dbl&gt;, sf65 &lt;dbl&gt;, fert65 &lt;dbl&gt;,
#   mort65 &lt;dbl&gt;, lifee065 &lt;dbl&gt;, gpop1 &lt;dbl&gt;, fert1 &lt;dbl&gt;, mort1 &lt;dbl&gt;,
#   invsh41 &lt;dbl&gt;, geetot1 &lt;dbl&gt;, geerec1 &lt;dbl&gt;, gde1 &lt;dbl&gt;, govwb1 &lt;dbl&gt;,
#   govsh41 &lt;dbl&gt;, gvxdxe41 &lt;dbl&gt;, high65 &lt;dbl&gt;, highm65 &lt;dbl&gt;, highf65 &lt;dbl&gt;,
#   highc65 &lt;dbl&gt;, highcm65 &lt;dbl&gt;, highcf65 &lt;dbl&gt;, human65 &lt;dbl&gt;,
#   humanm65 &lt;dbl&gt;, humanf65 &lt;dbl&gt;, hyr65 &lt;dbl&gt;, hyrm65 &lt;dbl&gt;, hyrf65 &lt;dbl&gt;,
#   no65 &lt;dbl&gt;, nom65 &lt;dbl&gt;, nof65 &lt;dbl&gt;, pinstab1 &lt;dbl&gt;, pop65 &lt;int&gt;, …</code></pre>
</div>
</div>
<p><strong>Exercise 1:</strong> First, get familiar with the data. Determine the dimensions of our data set and calculate the <span class="math inline">\(p/n\)</span> ratio. Do we have a high-dimensional setting?</p>
<p>First, check the number of observations and variables.</p>
<p>A simple way to judge whether we are in a “high-dimensional” regime is to compare:</p>
<ul>
<li><p><span class="math inline">\(n\)</span> = number of observations (countries)</p></li>
<li><p><span class="math inline">\(p\)</span> = number of variables (columns)</p></li>
</ul>
<p>If <span class="math inline">\(p/n\)</span> is not small, OLS can become unstable (high variance, noisy estimates), especially when many controls are weakly related to the outcome.</p>
<p>Compute <span class="math inline">\(n\)</span>, <span class="math inline">\(p\)</span>, and <span class="math inline">\(p/n\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>growth <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">ncol</span>(growth),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_over_n =</span> p <span class="sc">/</span> n</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
      n     p p_over_n
  &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;
1    90    62    0.689</code></pre>
</div>
</div>
<p>We can also print the dimensions directly.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(growth)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 90 62</code></pre>
</div>
</div>
<p>The sample contains about 90 countries and about 63 variables, so <span class="math inline">\(p/n\)</span> is not small. In this setting, the least squares method may provide a noisy estimate of <span class="math inline">\(\beta_1\)</span>, especially when many controls are weakly informative.</p>
<p>This is one reason methods based on regularisation (such as Lasso) become useful: they help us focus on the most relevant controls, rather than estimating everything with equal weight.</p>
<p><strong>Exercise 2:</strong> To check the convergence hypothesis, analyze the relationship between the country’s growth rate <span class="math inline">\(Y\)</span> and the country’s other characteristics by running a linear regression (ols) in the first step. Determine the regression coefficient <span class="math inline">\(\beta_1\)</span> of the target regressor <em>gdpsh465</em> (initial wealth level, <span class="math inline">\(D\)</span>), its 95% confidence interval and the standard error.</p>
<p>We begin by estimating a standard regression model using all available controls:</p>
<p><span class="math display">\[
Outcome = \alpha + \beta_1 \, gdpsh465 + \text{(other controls)} + \epsilon.
\]</span></p>
<p>Our focus is the coefficient on <strong><code>gdpsh465</code></strong> (initial GDP per capita), because it corresponds to the target regressor <span class="math inline">\(D\)</span> and the parameter <span class="math inline">\(\beta_1\)</span>.</p>
</section>
<section id="fit-the-model" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-model">Fit the model</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ols_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Outcome <span class="sc">~</span> ., <span class="at">data =</span> growth)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="extract-the-coefficient-of-interest-gdpsh465" class="level2">
<h2 class="anchored" data-anchor-id="extract-the-coefficient-of-interest-gdpsh465">Extract the coefficient of interest (<code>gdpsh465</code>)</h2>
<p>Instead of printing the full table (which is long), we extract only the one coefficient we care about.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ols_key <span class="ot">&lt;-</span> <span class="fu">tidy</span>(ols_fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"gdpsh465"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>ols_key</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  term     estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 gdpsh465 -0.00938    0.0299    -0.314   0.756  -0.0706    0.0518</code></pre>
</div>
</div>
<p>How to read this row:</p>
<ul>
<li><p><code>estimate</code>: our estimate of <span class="math inline">\(\beta_1\)</span></p></li>
<li><p><code>std.error</code>: the standard error of the estimate</p></li>
<li><p><code>conf.low</code> and <code>conf.high</code>: the 95% confidence interval</p></li>
</ul>
<p>If the confidence interval includes 0, the evidence for convergence/divergence is weaker (based on this model). So, least squares provides a rather noisy estimate of the speed of convergence, and does not allow us to answer the question about the convergence hypothesis as the confidence interval includes zero.</p>
<p>If you want a more “report-style” table:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"OLS (all controls)"</span> <span class="ot">=</span> ols_fit),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> <span class="fu">c</span>(<span class="st">"gdpsh465"</span> <span class="ot">=</span> <span class="st">"Initial GDP per capita (gdpsh465)"</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="fu">c</span>(<span class="st">"std.error"</span>, <span class="st">"conf.int"</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"gt"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="mwbyhpjywb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mwbyhpjywb table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mwbyhpjywb thead, #mwbyhpjywb tbody, #mwbyhpjywb tfoot, #mwbyhpjywb tr, #mwbyhpjywb td, #mwbyhpjywb th {
  border-style: none;
}

#mwbyhpjywb p {
  margin: 0;
  padding: 0;
}

#mwbyhpjywb .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mwbyhpjywb .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mwbyhpjywb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mwbyhpjywb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mwbyhpjywb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwbyhpjywb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwbyhpjywb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwbyhpjywb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mwbyhpjywb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mwbyhpjywb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mwbyhpjywb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mwbyhpjywb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mwbyhpjywb .gt_spanner_row {
  border-bottom-style: hidden;
}

#mwbyhpjywb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mwbyhpjywb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mwbyhpjywb .gt_from_md > :first-child {
  margin-top: 0;
}

#mwbyhpjywb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mwbyhpjywb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mwbyhpjywb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mwbyhpjywb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mwbyhpjywb .gt_row_group_first td {
  border-top-width: 2px;
}

#mwbyhpjywb .gt_row_group_first th {
  border-top-width: 2px;
}

#mwbyhpjywb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwbyhpjywb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mwbyhpjywb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mwbyhpjywb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwbyhpjywb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwbyhpjywb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mwbyhpjywb .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mwbyhpjywb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mwbyhpjywb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwbyhpjywb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwbyhpjywb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwbyhpjywb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwbyhpjywb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwbyhpjywb .gt_left {
  text-align: left;
}

#mwbyhpjywb .gt_center {
  text-align: center;
}

#mwbyhpjywb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mwbyhpjywb .gt_font_normal {
  font-weight: normal;
}

#mwbyhpjywb .gt_font_bold {
  font-weight: bold;
}

#mwbyhpjywb .gt_font_italic {
  font-style: italic;
}

#mwbyhpjywb .gt_super {
  font-size: 65%;
}

#mwbyhpjywb .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mwbyhpjywb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mwbyhpjywb .gt_indent_1 {
  text-indent: 5px;
}

#mwbyhpjywb .gt_indent_2 {
  text-indent: 10px;
}

#mwbyhpjywb .gt_indent_3 {
  text-indent: 15px;
}

#mwbyhpjywb .gt_indent_4 {
  text-indent: 20px;
}

#mwbyhpjywb .gt_indent_5 {
  text-indent: 25px;
}

#mwbyhpjywb .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mwbyhpjywb div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="OLS-(all-controls)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">OLS (all controls)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Initial GDP per capita (gdpsh465)</td>
<td class="gt_row gt_center" headers="OLS (all controls)">-0.009</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="OLS (all controls)">(0.030)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="OLS (all controls)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">[-0.071, 0.052]</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="OLS (all controls)">90</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="OLS (all controls)">0.887</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2 Adj.</td>
<td class="gt_row gt_center" headers="OLS (all controls)">0.641</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">AIC</td>
<td class="gt_row gt_center" headers="OLS (all controls)">-350.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">BIC</td>
<td class="gt_row gt_center" headers="OLS (all controls)">-193.0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Log.Lik.</td>
<td class="gt_row gt_center" headers="OLS (all controls)">238.237</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">RMSE</td>
<td class="gt_row gt_center" headers="OLS (all controls)">0.02</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Exercise 3:</strong> In contrast, use the partialling-out approach based on lasso regression (“Double Lasso”). Again, determine the regression coefficient <span class="math inline">\(\beta_1\)</span> of the target regressor <em>gdpsh465</em> (initial wealth level, <span class="math inline">\(D\)</span>), its 95% confidence interval and the standard error.</p>
<p>When we have many controls (and especially when <span class="math inline">\(p/n\)</span> is not small), a full OLS regression can become noisy and unstable. Double Lasso (also called partialling-out with Lasso) is designed to estimate <span class="math inline">\(\beta_1\)</span> while handling high-dimensional controls.</p>
<p>The key idea is:</p>
<ul>
<li><p>Use Lasso to partial out controls <span class="math inline">\(W\)</span> from the outcome <span class="math inline">\(Y\)</span></p></li>
<li><p>Use Lasso to partial out controls <span class="math inline">\(W\)</span> from the regressor <span class="math inline">\(D\)</span></p></li>
<li><p>Regress the residualised outcome on the residualised regressor</p></li>
</ul>
<p>This helps ensure the controls we include are the ones that matter for predicting either <span class="math inline">\(Y\)</span> or <span class="math inline">\(D\)</span>.</p>
<p><strong>Step 1:</strong> Define <span class="math inline">\(Y\)</span>, <span class="math inline">\(D\)</span>, and <span class="math inline">\(W\)</span></p>
<p>We define:</p>
<ul>
<li><p><span class="math inline">\(Y\)</span>: <code>Outcome</code></p></li>
<li><p><span class="math inline">\(D\)</span>: <code>gdpsh465</code></p></li>
<li><p><span class="math inline">\(W\)</span>: everything else (all other columns)</p></li>
</ul>
<p>We use name-based selection (more readable and safer than column positions).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> growth <span class="sc">|&gt;</span> <span class="fu">pull</span>(Outcome)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> growth <span class="sc">|&gt;</span> <span class="fu">pull</span>(gdpsh465)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> growth <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Outcome, <span class="sc">-</span>gdpsh465) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Step 2:</strong> Partial out <span class="math inline">\(W\)</span> from <span class="math inline">\(Y\)</span> using Lasso</p>
<p>Here we regress <span class="math inline">\(Y\)</span> on <span class="math inline">\(W\)</span> using Lasso, and keep the residuals:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rY <span class="ot">&lt;-</span> <span class="fu">rlasso</span>(<span class="at">x =</span> W, <span class="at">y =</span> Y)<span class="sc">$</span>res</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>rY</code> is the part of the outcome not explained by controls.</p>
<p><strong>Step 3:</strong> Partial out <span class="math inline">\(W\)</span> from <span class="math inline">\(D\)</span> using Lasso</p>
<p>Now we regress <span class="math inline">\(D\)</span> on <span class="math inline">\(W\)</span> using Lasso, and keep the residuals:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rD <span class="ot">&lt;-</span> <span class="fu">rlasso</span>(<span class="at">x =</span> W, <span class="at">y =</span> D)<span class="sc">$</span>res</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>rD</code> is the part of the regressor not explained by controls.</p>
<p><strong>Step 4:</strong> Regress residualised <span class="math inline">\(Y\)</span> on residualised <span class="math inline">\(D\)</span></p>
<p>Finally, regress <code>rY</code> on <code>rD</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dl_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(rY <span class="sc">~</span> rD)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This last step estimates <span class="math inline">\(\beta_1\)</span> using the variation that remains after removing what controls explain.</p>
<p><strong>Step 5:</strong> Extract the Double Lasso estimate</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dl_key <span class="ot">&lt;-</span> <span class="fu">tidy</span>(dl_fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"rD"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>dl_key</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  term  estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 rD     -0.0498    0.0139     -3.57 0.000573  -0.0775   -0.0221</code></pre>
</div>
</div>
<p>Lasso provides a more precise estimate (lower standard error). The Lasso based point estimate is about <span class="math inline">\(-5\%\)</span> and the <span class="math inline">\(95\%\)</span> confidence interval for the (annual) rate of convergence is <span class="math inline">\(7.8\%\)</span> to <span class="math inline">\(2.2\%\)</span>. This empirical evidence does support the convergence hypothesis.</p>
<p>Note: Alternatively, one could also use the <em>rlassoEffect</em> funtion from the <em>hdm</em> package that directly applies the partialling-out approach.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dl_effect <span class="ot">&lt;-</span> <span class="fu">rlassoEffect</span>(<span class="at">x =</span> W, <span class="at">y =</span> Y, <span class="at">d =</span> D, <span class="at">method =</span> <span class="st">"partialling out"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dl_effect</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
rlassoEffect(x = W, y = Y, d = D, method = "partialling out")

Coefficients:
[1]  -0.04981</code></pre>
</div>
</div>
<p><strong>Exercise 4:</strong> Finally, let us have a look at the results. Compare the results of Exercise 2 and Exercise 3 and interpret your findings.</p>
<p>Now we compare the two estimates (OLS and Double Lasso) side-by-side.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>compare_tbl <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  ols_key <span class="sc">|&gt;</span> <span class="fu">transmute</span>(<span class="at">model =</span> <span class="st">"OLS"</span>, estimate, std.error, conf.low, conf.high),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  dl_key  <span class="sc">|&gt;</span> <span class="fu">transmute</span>(<span class="at">model =</span> <span class="st">"Double Lasso"</span>, estimate, std.error, conf.low, conf.high)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">4</span>)))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>compare_tbl</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  model        estimate std.error conf.low conf.high
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 OLS           -0.0094    0.0299  -0.0706    0.0518
2 Double Lasso  -0.0498    0.0139  -0.0775   -0.0221</code></pre>
</div>
</div>
<p>The least square method provides a rather noisy estimate of the speed of convergence. We cannot answer the question of whether poor countries grow faster than rich countries. The least square method does not work when the ratio <span class="math inline">\(p/n\)</span> is large.</p>
<p>In sharp contrast, partialling-out via Lasso provides a more precise estimate. The Lasso-based point estimate is <span class="math inline">\(-5\%\)</span> and the <span class="math inline">\(95\%\)</span> confidence interval for the (annual) rate of convergence <span class="math inline">\([-7.8\%,-2.2\%]\)</span> only includes negative numbers. This empirical evidence does support the convergence hypothesis.</p>
</section>
<section id="interpreting-the-results" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-the-results">Interpreting the results</h2>
<p>For the OLS regression, the estimated coefficient on <strong><code>gdpsh465</code></strong> is:</p>
<ul>
<li>estimate = -0.0094<br>
</li>
<li>95% CI = [-0.0706, 0.0518]</li>
</ul>
<p>This interval includes zero, so <strong>OLS does not provide strong evidence</strong> for convergence or divergence in this specification. This does not mean OLS is “wrong”, but in settings with many controls relative to sample size, OLS estimates can be <strong>imprecise</strong> (large standard errors), making inference difficult.</p>
<p>For Double Lasso (partialling-out), the estimated coefficient is:</p>
<ul>
<li>estimate = -0.0498<br>
</li>
<li>95% CI = [-0.0775, -0.0221]</li>
</ul>
<p>This interval is fully below zero. Since <strong><span class="math inline">\(\beta_1 &lt; 0\)</span> corresponds to convergence</strong>, the Double Lasso results provide evidence consistent with the convergence hypothesis: <strong>poorer countries tend to grow faster than richer countries, conditional on the selected controls</strong>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Causal interpretation (important):</strong><br>
A causal interpretation requires additional assumptions (e.g., after controlling for <span class="math inline">\((W)\)</span>, there are no unobserved confounders affecting both initial wealth and subsequent growth). Double Lasso helps with <strong>high-dimensional controls</strong>, but it does not automatically guarantee causality.</p>
</div>
</div>
</section>
</section>
<section id="part-2-impact-of-401k-on-financial-wealth-using-double-machine-learning" class="level1">
<h1>PART 2: Impact of 401(k) on Financial Wealth using Double Machine Learning</h1>
<p>In this real-data example, we illustrate how the <a href="https://docs.doubleml.org/stable/index.html">DoubleML</a> package can be used to estimate the effect of 401(k) eligibility and participation on accumulated assets. The 401(k) data set has been analyzed in several studies, among others <a href="https://arxiv.org/abs/1608.00060">Chernozhukov et al.&nbsp;(2018)</a>.</p>
<p>401(k) plans are pension accounts sponsored by employers. The key problem in determining the effect of participation in 401(k) plans on accumulated assets is saver heterogeneity coupled with the fact that the decision to enroll in a 401(k) is non-random. It is generally recognized that some people have a higher preference for saving than others. It also seems likely that those individuals with high unobserved preference for saving would be most likely to choose to participate in tax-advantaged retirement savings plans and would tend to have otherwise high amounts of accumulated assets. The presence of unobserved savings preferences with these properties then implies that conventional estimates that do not account for saver heterogeneity and endogeneity of participation will be biased upward, tending to overstate the savings effects of 401(k) participation.</p>
<p>One can argue that eligibility for enrolling in a 401(k) plan in this data can be taken as exogenous after conditioning on a few observables of which the most important for their argument is income. The basic idea is that, at least around the time 401(k)’s initially became available, people were unlikely to be basing their employment decisions on whether an employer offered a 401(k) but would instead focus on income and other aspects of the job.</p>
<section id="setup-1" class="level2">
<h2 class="anchored" data-anchor-id="setup-1">Setup</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Install packages (run once)
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are running this notebook for the first time, install these packages.<br>
This chunk is set to <code>eval: false</code> so it will not run automatically when you render.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"remotes"</span>, <span class="st">"mlr3"</span>, <span class="st">"mlr3learners"</span>, <span class="st">"DoubleML"</span>, <span class="st">"glmnet"</span>, <span class="st">"ranger"</span>, <span class="st">"xgboost"</span>, <span class="st">"data.table"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(remotes)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoubleML)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># suppress messages during fitting</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">"mlr3"</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">"warn"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The preprocessed data can be fetched by calling <a href="https://docs.doubleml.org/r/stable/reference/fetch_401k.html">fetch_401k()</a>. The arguments <code>polynomial_features</code> and <code>instrument</code> can be used to replicate the models used in <a href="https://arxiv.org/abs/1608.00060">Chernozhukov et al.&nbsp;(2018)</a>. Note that an internet connection is required for loading the data. We start with a baseline specification of the regression model and reload the data later in case we want to use another specification.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data (instrument = TRUE is important for IIVM later)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">fetch_401k</span>(<span class="at">return_type =</span> <span class="st">"data.table"</span>, <span class="at">instrument =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  9915 obs. of  12 variables:
 $ net_tfa: num  0 1015 -2000 15000 0 ...
 $ age    : num  47 36 37 58 32 34 28 54 43 32 ...
 $ inc    : num  6765 28452 3300 52590 21804 ...
 $ educ   : num  8 16 12 16 11 16 12 11 14 18 ...
 $ fsize  : num  2 1 6 2 1 1 3 3 2 3 ...
 $ marr   : num  0 0 0 1 0 0 1 0 1 1 ...
 $ twoearn: num  0 0 0 1 0 0 1 0 1 0 ...
 $ db     : num  0 0 1 0 0 0 0 0 1 0 ...
 $ pira   : num  0 0 0 0 0 1 1 0 1 0 ...
 $ hown   : num  1 1 0 1 1 1 1 1 1 1 ...
 $ p401   : int  0 0 0 0 0 0 0 0 0 0 ...
 $ e401   : int  0 0 0 0 0 0 0 0 0 0 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>See the “Details” section on the description of the data set, which can be accessed by typing <a href="https://docs.doubleml.org/r/stable/reference/fetch_401k.html">help(fetch_401k)</a>.</p>
<p>We load the 401(k) dataset. We keep <code>instrument = TRUE</code> because we will use <strong>eligibility (<code>e401</code>)</strong> as an instrument later in the IV model.</p>
<p>The data consist of 9,915 observations at the household level drawn from the 1991 Survey of Income and Program Participation (SIPP). All the variables are referred to 1990. We use net financial assets (<em>net_tfa</em>) as the outcome variable, <span class="math inline">\(Y\)</span>, in our analysis. The net financial assets are computed as the sum of IRA balances, 401(k) balances, checking accounts, saving bonds, other interest-earning accounts, other interest-earning assets, stocks, and mutual funds less non mortgage debts.</p>
<p>Among the <span class="math inline">\(9915\)</span> individuals, <span class="math inline">\(3682\)</span> are eligible to participate in the program. The variable <em>e401</em> indicates eligibility and <em>p401</em> indicates participation, respectively.</p>
</section>
<section id="quick-eda" class="level2">
<h2 class="anchored" data-anchor-id="quick-eda">Quick EDA</h2>
<p>Eligibility and participation are binary variables.</p>
<ul>
<li><code>e401</code>: eligible for 401(k)</li>
<li><code>p401</code>: participates in 401(k)</li>
<li><code>net_tfa</code>: net total financial assets (outcome)</li>
</ul>
<section id="eligibility" class="level3">
<h3 class="anchored" data-anchor-id="eligibility">Eligibility</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> e401, <span class="at">fill =</span> <span class="fu">factor</span>(e401))) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Eligibility, 401(k)"</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="participation" class="level3">
<h3 class="anchored" data-anchor-id="participation">Participation</h3>
<p>Participation is a choice, so this plot often reflects selection. People who participate may differ systematically (income, job type, financial literacy etc.). So, the raw difference between participants and non-participants is not causal.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> p401, <span class="at">fill =</span> <span class="fu">factor</span>(p401))) <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Participation, 401(k)"</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="outcome-distribution-by-eligibility" class="level3">
<h3 class="anchored" data-anchor-id="outcome-distribution-by-eligibility">Outcome distribution by eligibility</h3>
<p>Eligibility is highly associated with financial wealth: but eligibility is not randomly assigned in real life (it’s tied to employer/plan rules), so we still need to adjust for covariates. The density plot motivates the causal question, but doesn’t answer it.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> net_tfa, <span class="at">color =</span> <span class="fu">factor</span>(e401), <span class="at">fill =</span> <span class="fu">factor</span>(e401))) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">20000</span>, <span class="dv">150000</span>)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> e401) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 340 rows containing non-finite outside the scale range
(`stat_density()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="a-simple-baseline-unconditional-mean-differences" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-baseline-unconditional-mean-differences">A simple baseline: unconditional mean differences</h2>
<p>Before using DML, it is helpful to see the <em>raw difference</em> in average outcomes.</p>
<p>As a first estimate, we calculate the unconditional average predictive effect (APE) of 401(k) eligibility on accumulated assets. This effect corresponds to the average treatment effect if 401(k) eligibility would be assigned to individuals in an entirely randomized way.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>APE_e401_uncond <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(e401) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_net_tfa =</span> <span class="fu">mean</span>(net_tfa), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(e401) <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff =</span> mean_net_tfa[e401 <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> mean_net_tfa[e401 <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">|&gt;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(diff)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(APE_e401_uncond, <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19559.34</code></pre>
</div>
</div>
<p>The unconditional APE of e401 is about <span class="math inline">\(19559\)</span>.</p>
<p>Among the <span class="math inline">\(3682\)</span> individuals that are eligible, <span class="math inline">\(2594\)</span> decided to participate in the program. The unconditional APE of p401 is about <span class="math inline">\(27372\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>APE_p401_uncond <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(p401) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_net_tfa =</span> <span class="fu">mean</span>(net_tfa), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(p401) <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff =</span> mean_net_tfa[p401 <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> mean_net_tfa[p401 <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">|&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(diff)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(APE_p401_uncond, <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27371.58</code></pre>
</div>
</div>
<p>These raw differences are not causal. They ignore differences in age, income, education, and other confounders. It mixes treatment effects with differences in who ends up eligible/participating</p>
</section>
<section id="the-doubleml-package-estimating-the-average-treatment-effect-of-401k-eligibility-on-net-financial-assets" class="level2">
<h2 class="anchored" data-anchor-id="the-doubleml-package-estimating-the-average-treatment-effect-of-401k-eligibility-on-net-financial-assets">The <code>DoubleML</code> package: Estimating the Average Treatment Effect of 401(k) Eligibility on Net Financial Assets</h2>
<p>Let’s use the package <a href="https://docs.doubleml.org/stable/index.html">DoubleML</a> to estimate the average treatment effect of 401(k) eligibility, i.e.&nbsp;<code>e401</code>, and participation, i.e.&nbsp;<code>p401</code>, on net financial assets <code>net_tfa</code>.</p>
<p>We first look at the treatment effect of <code>e401</code> on net total financial assets. We give estimates of the ATE in the linear model</p>
<p><span class="math display">\[
\begin{equation*}
Y = D \alpha + f(X)'\beta+ \epsilon,
\end{equation*}
\]</span></p>
<p>where <span class="math inline">\(f(X)\)</span> is a dictonary applied to the raw regressors. <span class="math inline">\(X\)</span> contains variables on marital status, two-earner status, defined benefit pension status, IRA participation, home ownership, family size, education, age, and income.</p>
<p>In the following, we will consider two different models,</p>
<ul>
<li><p>a basic model specification that includes the raw regressors, i.e., <span class="math inline">\(f(X) = X\)</span>, and</p></li>
<li><p>a flexible model specification, where <span class="math inline">\(f(X)\)</span> includes the raw regressors <span class="math inline">\(X\)</span> and the orthogonal polynomials of degree 2 for the variables family size education, age, and income.</p></li>
</ul>
<p>We will use the basic model specification whenever we use nonlinear methods, for example regression trees or random forests, and use the flexible model for linear methods such as the lasso. There are, of course, multiple ways how the model can be specified even more flexibly, for example including interactions of variable and higher order interaction. However, for the sake of simplicity we stick to the specification above. Users who are interested in varying the model can manipulate the model formula below (<code>formula_flex</code>), for example implementing the orignal specification in <a href="https://arxiv.org/abs/1608.00060">Chernozhukov et al.&nbsp;(2018)</a>.</p>
<p>In the first step, we report estimates of the average treatment effect (ATE) of 401(k) eligibility on net financial assets both in the partially linear regression (PLR) model and in the interactive regression model (IRM) allowing for heterogeneous treatment effects.</p>
</section>
<section id="the-data-backend-doublemldata" class="level2">
<h2 class="anchored" data-anchor-id="the-data-backend-doublemldata">The Data Backend: <code>DoubleMLData</code></h2>
<p>To start our analysis, we initialize the data backend, i.e., a new instance of a <a href="https://docs.doubleml.org/r/stable/reference/DoubleMLData.html">DoubleMLData</a> object. Here, we manually implement the regression model by using R’s formula interface. A shortcut would be to directly specify the options <code>polynomial_features</code> and <code>instrument</code> when calling <a href="https://docs.doubleml.org/r/stable/reference/fetch_401k.html">fetch_401k()</a>.<span class="math inline">\(^{**}\)</span></p>
<p>To implement both models (basic and flexible), we generate two data backends: <code>data_dml_base</code> and <code>data_dml_flex</code>.</p>
<ul>
<li><strong>Base controls</strong> (simple)</li>
<li><strong>Flexible controls</strong> (polynomials + richer feature space)</li>
</ul>
<p>DoubleML uses a <code>DoubleMLData</code> object to store:</p>
<ul>
<li>outcome column (<code>y_col</code>)</li>
<li>treatment column (<code>d_cols</code>)</li>
<li>control columns (<code>x_cols</code>)</li>
<li>(optionally) instrument column (<code>z_cols</code>)</li>
</ul>
</section>
<section id="base-controls" class="level2">
<h2 class="anchored" data-anchor-id="base-controls">Base controls</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up basic model: Specify variables for data-backend</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>features_base <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"inc"</span>, <span class="st">"educ"</span>, <span class="st">"fsize"</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"marr"</span>, <span class="st">"twoearn"</span>, <span class="st">"db"</span>, <span class="st">"pira"</span>, <span class="st">"hown"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLData (data-backend of DoubleML)</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>data_dml_base <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(data,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y_col =</span> <span class="st">"net_tfa"</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">d_cols =</span> <span class="st">"e401"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x_cols =</span> features_base)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>data_dml_base</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>================= DoubleMLData Object ==================


------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): e401
Covariates: age, inc, educ, fsize, marr, twoearn, db, pira, hown
Instrument(s): 
Selection variable: 
No. Observations: 9915</code></pre>
</div>
</div>
</section>
<section id="flexible-controls" class="level2">
<h2 class="anchored" data-anchor-id="flexible-controls">Flexible controls</h2>
<p>We build polynomial terms using <code>model.matrix()</code> and convert them to a tibble.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a model according to regression formula with polynomials</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>formula_flex <span class="ot">=</span> <span class="fu">formula</span>(<span class="st">" ~ -1 + poly(age, 2, raw=TRUE) +</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="st">                        poly(inc, 2, raw=TRUE) + poly(educ, 2, raw=TRUE) +</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="st">                        poly(fsize, 2, raw=TRUE) + marr + twoearn +</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="st">                        db + pira + hown"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>features_flex <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">model.matrix</span>(formula_flex, data))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">=</span> <span class="fu">data.table</span>(<span class="st">"net_tfa"</span> <span class="ot">=</span> data[, net_tfa],</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"e401"</span> <span class="ot">=</span> data[, e401],</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                        features_flex)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLData (data-backend of DoubleML)</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>data_dml_flex <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(model_data,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y_col =</span> <span class="st">"net_tfa"</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">d_cols =</span> <span class="st">"e401"</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>data_dml_flex</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>================= DoubleMLData Object ==================


------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): e401
Covariates: poly.age..2..raw...TRUE.1, poly.age..2..raw...TRUE.2, poly.inc..2..raw...TRUE.1, poly.inc..2..raw...TRUE.2, poly.educ..2..raw...TRUE.1, poly.educ..2..raw...TRUE.2, poly.fsize..2..raw...TRUE.1, poly.fsize..2..raw...TRUE.2, marr, twoearn, db, pira, hown
Instrument(s): 
Selection variable: 
No. Observations: 9915</code></pre>
</div>
</div>
</section>
<section id="partially-linear-regression-model-plr" class="level2">
<h2 class="anchored" data-anchor-id="partially-linear-regression-model-plr">Partially Linear Regression Model (PLR)</h2>
<p><strong>Goal:</strong> estimate the effect of <strong>eligibility (<code>e401</code>)</strong> on <strong>net financial assets (<code>net_tfa</code>)</strong>.</p>
<p>We start using lasso to estimate the function <span class="math inline">\(g_0\)</span> and <span class="math inline">\(m_0\)</span> in the following PLR model:</p>
<p><span class="math display">\[
\begin{eqnarray}
&amp; Y = D\theta_0 + g_0(X) + \zeta, &amp;\quad E[\zeta \mid D,X]= 0,\\
&amp; D = m_0(X) +  V, &amp;\quad E[V \mid X] = 0.
\end{eqnarray}
\]</span></p>
<p>To estimate the causal parameter <span class="math inline">\(\theta_0\)</span> here, we use double machine learning with 3-fold cross-fitting.</p>
<p>Estimation of the nuisance components <span class="math inline">\(g_0\)</span> and <span class="math inline">\(m_0\)</span>, is based on the lasso with cross-validated choice of the penalty term , <span class="math inline">\(\lambda\)</span>, as provided by the <a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">glmnet package</a>. We load the learner by using the <a href="https://mlr3.mlr-org.com/">mlr3</a> function <a href="https://mlr3.mlr-org.com/reference/Learner.html">lrn()</a>. Hyperparameters and options can be set during instantiation of the learner. Here we specify that the lasso should use that value of <span class="math inline">\(\lambda\)</span> that minimizes the cross-validated mean squared error which is based on 5-fold cross validation.</p>
<p>In order to use a learner, the underlying R packages have to be installed. In this case, the package <a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">glmnet package</a> needs to be installed. Moreover, installation of the package <a href="https://mlr3learners.mlr-org.com/">mlr3learners</a> is required.</p>
<p>We start by estimation the ATE in the basic model and then repeat the estimation in the flexible model.</p>
</section>
<section id="learners" class="level2">
<h2 class="anchored" data-anchor-id="learners">Learners</h2>
<p>We define the ML learners used for nuisance functions.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.cv_glmnet"</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>lasso_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.cv_glmnet"</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="plr-with-lasso-base" class="level3">
<h3 class="anchored" data-anchor-id="plr-with-lasso-base">PLR with Lasso (base)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso_base <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  data_dml_base,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> lasso,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> lasso_class,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso_base<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso_base<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      6133       1465   4.185 2.85e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="plr-with-lasso-flex" class="level3">
<h3 class="anchored" data-anchor-id="plr-with-lasso-flex">PLR with Lasso (flex)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.cv_glmnet"</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>lasso_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.cv_glmnet"</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  data_dml_flex,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> lasso,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> lasso_class,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      9580       1325   7.229 4.87e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Alternatively, we can repeat this procedure with other machine learning methods, for example a random forest learner as provided by the <a href="https://github.com/imbs-hl/ranger">ranger</a> package for R. The website of the <a href="https://mlr3extralearners.mlr-org.com/articles/learners/list_learners.html">mlr3extralearners</a> package has a searchable list of all learners that are available in the <a href="https://mlr3verse.mlr-org.com/">mlr3verse</a>.</p>
</section>
<section id="plr-with-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="plr-with-random-forest">PLR with Random Forest</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>randomForest <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">max.depth =</span> <span class="dv">7</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">3</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">max.depth =</span> <span class="dv">5</span>, <span class="at">mtry =</span> <span class="dv">4</span>, <span class="at">min.node.size =</span> <span class="dv">7</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>dml_plr_forest <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  data_dml_base,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> randomForest,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> randomForest_class,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>dml_plr_forest<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>dml_plr_forest<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      9127       1313   6.952 3.61e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="plr-with-trees" class="level3">
<h3 class="anchored" data-anchor-id="plr-with-trees">PLR with Trees</h3>
<p>Now, let’s use a regression tree as provided by the R package <a href="https://github.com/bethatkinson/rpart">rpart</a>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">cp =</span> <span class="fl">0.0047</span>, <span class="at">minsplit =</span> <span class="dv">203</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>trees_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">cp =</span> <span class="fl">0.0042</span>, <span class="at">minsplit =</span> <span class="dv">104</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>dml_plr_tree <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  data_dml_base,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> trees,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> trees_class,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>dml_plr_tree<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>dml_plr_tree<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      8210       1324   6.203 5.55e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="plr-with-boosted-trees" class="level3">
<h3 class="anchored" data-anchor-id="plr-with-boosted-trees">PLR with Boosted Trees</h3>
<p>We can also experiment with extreme gradient boosting as provided by <a href="https://xgboost.readthedocs.io/en/latest/">xgboost</a>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>boost <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.xgboost"</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">nrounds =</span> <span class="dv">35</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>boost_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"logloss"</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">nrounds =</span> <span class="dv">34</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>dml_plr_boost <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  data_dml_base,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> boost,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> boost_class,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>dml_plr_boost<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>dml_plr_boost<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      9334       1415   6.598 4.17e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="plr-results-summary" class="level2">
<h2 class="anchored" data-anchor-id="plr-results-summary">PLR results summary</h2>
<p>Let’s sum up the results:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>confints_plr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  dml_plr_lasso<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  dml_plr_forest<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  dml_plr_tree<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  dml_plr_boost<span class="sc">$</span><span class="fu">confint</span>()</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>estimates_plr <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  dml_plr_lasso<span class="sc">$</span>coef,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  dml_plr_forest<span class="sc">$</span>coef,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  dml_plr_tree<span class="sc">$</span>coef,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  dml_plr_boost<span class="sc">$</span>coef</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>result_plr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"PLR"</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">ML =</span> <span class="fu">c</span>(<span class="st">"lasso"</span>, <span class="st">"random forest"</span>, <span class="st">"decision tree"</span>, <span class="st">"xgboost"</span>),</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> estimates_plr,</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> confints_plr[, <span class="dv">1</span>],</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> confints_plr[, <span class="dv">2</span>]</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>result_plr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  model ML            Estimate lower  upper
  &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 PLR   lasso            9580. 6982. 12177.
2 PLR   random forest    9127. 6554. 11700.
3 PLR   decision tree    8210. 5616. 10804.
4 PLR   xgboost          9334. 6562. 12107.</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(result_plr, <span class="fu">aes</span>(<span class="at">x =</span> ML, <span class="at">y =</span> Estimate, <span class="at">color =</span> ML)) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> ML))  <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Coefficients and 0.95- confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>Note: Why use flex for Lasso but often base for trees/boosting?</em></p>
<p>Lasso / linear models</p>
<ul>
<li><p>Lasso is still a linear model in the features.</p></li>
<li><p>If the real relationship is nonlinear, you need to create nonlinear features (like squared terms) so the linear model can represent curvature.</p></li>
</ul>
<p>Random forests / trees / boosting</p>
<ul>
<li><p>These learners are already nonlinear and naturally capture interactions.</p></li>
<li><p>Feeding them lots of hand-made polynomial terms often:</p>
<ul>
<li><p>adds redundancy</p></li>
<li><p>increases noise/complexity</p></li>
<li><p>doesn’t help much (and can hurt)</p></li>
</ul></li>
</ul>
</section>
<section id="interactive-regression-model-irm" class="level2">
<h2 class="anchored" data-anchor-id="interactive-regression-model-irm">Interactive Regression Model (IRM)</h2>
<p><strong>Goal:</strong> estimate the effect of eligibility (<code>e401</code>) allowing for more flexible outcome models across treated/untreated groups.</p>
<p>Next, we consider estimation of average treatment effects when treatment effects are fully heterogeneous:</p>
<p><span class="math display">\[
\begin{eqnarray}
&amp; Y = g_0(D,X) + U, &amp;\quad E[U\mid X,D] = 0,\\
&amp; D = m_0(X) + V, &amp;\quad E[V\mid X] = 0.
\end{eqnarray}
\]</span> To reduce the disproportionate impact of extreme propensity score weights in the interactive model, we trim the propensity scores which are close to the bounds.</p>
<section id="irm-with-lasso-flex" class="level3">
<h3 class="anchored" data-anchor-id="irm-with-lasso-flex">IRM with Lasso (flex)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dml_irm_lasso <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  data_dml_flex,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_g =</span> lasso,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> lasso_class,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>dml_irm_lasso<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>dml_irm_lasso<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      8850       1341   6.601 4.08e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="irm-with-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="irm-with-random-forest">IRM with Random Forest</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>randomForest <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>dml_irm_forest <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_dml_base,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_g =</span> randomForest,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_m =</span> randomForest_class,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">n_folds =</span> <span class="dv">3</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g0"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">4</span>, <span class="at">min.node.size =</span> <span class="dv">7</span>))</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g1"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">5</span>))</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_m"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">6</span>))</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      8202       1118   7.334 2.23e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="irm-with-trees" class="level2">
<h2 class="anchored" data-anchor-id="irm-with-trees">IRM with Trees</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>trees_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Trees</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>dml_irm_tree <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_dml_base,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_g =</span> trees,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_m =</span> trees_class,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_folds =</span> <span class="dv">3</span>)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g0"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0016</span>, <span class="at">minsplit =</span> <span class="dv">74</span>))</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g1"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0018</span>, <span class="at">minsplit =</span> <span class="dv">70</span>))</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_m"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0028</span>, <span class="at">minsplit =</span> <span class="dv">167</span>))</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      8415       1186   7.098 1.26e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="irm-with-boosted-trees" class="level2">
<h2 class="anchored" data-anchor-id="irm-with-boosted-trees">IRM with Boosted Trees</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learners</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>boost <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.xgboost"</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>boost_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Boosted Trees</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>dml_irm_boost <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_dml_base,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ml_g =</span> boost,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ml_m =</span> boost_class,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">n_folds =</span> <span class="dv">3</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">compareVersion</span>(<span class="fu">as.character</span>(<span class="fu">packageVersion</span>(<span class="st">"DoubleML"</span>)), <span class="st">"0.2.1"</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g0"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">8</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g1"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">29</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_m"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">23</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># behavior of set_ml_nuisance_params() changed in https://github.com/DoubleML/doubleml-for-r/pull/89</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g0"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">8</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g1"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">29</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_m"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">23</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>dml_irm_boost<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>dml_irm_boost<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      8356       1170   7.139 9.37e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="irm-results-summary" class="level2">
<h2 class="anchored" data-anchor-id="irm-results-summary">IRM results summary</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>confints_irm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  dml_irm_lasso<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  dml_irm_forest<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  dml_irm_tree<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  dml_irm_boost<span class="sc">$</span><span class="fu">confint</span>()</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>estimates_irm <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  dml_irm_lasso<span class="sc">$</span>coef,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  dml_irm_forest<span class="sc">$</span>coef,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  dml_irm_tree<span class="sc">$</span>coef,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  dml_irm_boost<span class="sc">$</span>coef</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>result_irm <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"IRM"</span>,</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">ML =</span> <span class="fu">c</span>(<span class="st">"lasso"</span>, <span class="st">"random forest"</span>, <span class="st">"decision tree"</span>, <span class="st">"xgboost"</span>),</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> estimates_irm,</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> confints_irm[, <span class="dv">1</span>],</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> confints_irm[, <span class="dv">2</span>]</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>result_irm</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  model ML            Estimate lower  upper
  &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 IRM   lasso            8850. 6222. 11478.
2 IRM   random forest    8202. 6010. 10394.
3 IRM   decision tree    8415. 6092. 10739.
4 IRM   xgboost          8356. 6062. 10650.</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(result_irm, <span class="fu">aes</span>(<span class="at">x =</span> ML, <span class="at">y =</span> Estimate, <span class="at">color =</span> ML)) <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> ML))  <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Coefficients and 0.95- confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These estimates that flexibly account for confounding are substantially reduced relative to the baseline estimate (<em>19559</em>) that does not account for confounding. They suggest much smaller causal effects of 401(k) eligiblity on financial asset holdings.</p>
</section>
<section id="iivm-interactive-iv-model" class="level2">
<h2 class="anchored" data-anchor-id="iivm-interactive-iv-model">IIVM: Interactive IV Model</h2>
<p><strong>Goal:</strong> estimate the effect of <strong>participation (<code>p401</code>)</strong> on <strong>net financial assets (<code>net_tfa</code>)</strong>, using <strong>eligibility (<code>e401</code>)</strong> as an instrument.</p>
<p>In the examples above, we estimated the average treatment effect of <em>eligibility</em> on financial asset holdings. Now, we consider estimation of local average treatment effects (LATE) of <em>participation</em> using eligibility as an instrument for the participation decision. Under appropriate assumptions, the LATE identifies the treatment effect for so-called compliers, i.e., individuals who would only participate if eligible and otherwise not participate in the program.</p>
<p>As before, <span class="math inline">\(Y\)</span> denotes the outcome <code>net_tfa</code>, and <span class="math inline">\(X\)</span> is the vector of covariates. We use <code>e401</code> as a binary instrument for the treatment variable <code>p401</code>. Here the structural equation model is:</p>
<p><span class="math display">\[
\begin{eqnarray}
&amp; Y = g_0(D,X) + U, &amp;\quad E[U\mid D,X] = 0,\\
&amp; D = r_0(Z,X) + V, &amp;\quad E[V\mid Z, X] = 0,\\
&amp; Z = m_0(X) + \zeta, &amp;\quad E[\zeta \mid X] = 0.
\end{eqnarray}
\]</span></p>
<section id="iivm-data-base" class="level3">
<h3 class="anchored" data-anchor-id="iivm-data-base">IIVM data (base)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLData with an instrument</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic model</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>data_dml_base_iv <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(data,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y_col =</span> <span class="st">"net_tfa"</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">d_cols =</span> <span class="st">"p401"</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">x_cols =</span> features_base,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">z_cols =</span> <span class="st">"e401"</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>data_dml_base_iv</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>================= DoubleMLData Object ==================


------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): p401
Covariates: age, inc, educ, fsize, marr, twoearn, db, pira, hown
Instrument(s): e401
Selection variable: 
No. Observations: 9915</code></pre>
</div>
</div>
</section>
<section id="iivm-data-flex" class="level3">
<h3 class="anchored" data-anchor-id="iivm-data-flex">IIVM data (flex)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Flexible model</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">=</span> <span class="fu">data.table</span>(<span class="st">"net_tfa"</span> <span class="ot">=</span> data[, net_tfa],</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"e401"</span> <span class="ot">=</span> data[, e401],</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"p401"</span> <span class="ot">=</span> data[, p401],</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                        features_flex)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>data_dml_flex_iv <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(model_data,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y_col =</span> <span class="st">"net_tfa"</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">d_cols =</span> <span class="st">"p401"</span>,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">z_cols =</span> <span class="st">"e401"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="iivm-with-lasso-flex" class="level3">
<h3 class="anchored" data-anchor-id="iivm-with-lasso-flex">IIVM with Lasso (flex)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>dml_iivm_lasso <span class="ot">&lt;-</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  data_dml_flex_iv,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_g =</span> lasso,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> lasso_class,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_r =</span> lasso_class,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>, <span class="at">never_takers =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>dml_iivm_lasso<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>dml_iivm_lasso<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
p401     12802       1941   6.597  4.2e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Again, we repeat the procedure for the other machine learning methods:</p>
</section>
<section id="iivm-with-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="iivm-with-random-forest">IIVM with Random Forest</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>randomForest <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_dml_base_iv,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> randomForest,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> randomForest_class,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> randomForest_class,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g0"</span>, <span class="st">"p401"</span>,</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">4</span>, <span class="at">min.node.size =</span> <span class="dv">7</span>))</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">5</span>))</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_m"</span>, <span class="st">"p401"</span>,</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">6</span>))</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_r1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">4</span>, <span class="at">mtry =</span> <span class="dv">7</span>, <span class="at">min.node.size =</span> <span class="dv">6</span>))</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
p401     11792       1604   7.352 1.95e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="iivm-with-trees" class="level3">
<h3 class="anchored" data-anchor-id="iivm-with-trees">IIVM with Trees</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>trees_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Trees</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_dml_base_iv,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_g =</span> trees,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_m =</span> trees_class,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_r =</span> trees_class,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g0"</span>, <span class="st">"p401"</span>,</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0016</span>, <span class="at">minsplit =</span> <span class="dv">74</span>))</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0018</span>, <span class="at">minsplit =</span> <span class="dv">70</span>))</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_m"</span>, <span class="st">"p401"</span>,</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0028</span>, <span class="at">minsplit =</span> <span class="dv">167</span>))</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_r1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0576</span>, <span class="at">minsplit =</span> <span class="dv">55</span>))</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
p401     12214       1714   7.128 1.02e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="iivm-with-boosted-trees" class="level3">
<h3 class="anchored" data-anchor-id="iivm-with-boosted-trees">IIVM with Boosted Trees</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>boost <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.xgboost"</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>boost_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Boosted Trees</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>dml_iivm_boost <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_dml_base_iv,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> boost,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> boost_class,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> boost_class,</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">compareVersion</span>(<span class="fu">as.character</span>(<span class="fu">packageVersion</span>(<span class="st">"DoubleML"</span>)), <span class="st">"0.2.1"</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g0"</span>, <span class="st">"p401"</span>,</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">9</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">33</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_m"</span>, <span class="st">"p401"</span>,</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">12</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_r1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">25</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># behavior of set_ml_nuisance_params() changed in https://github.com/DoubleML/doubleml-for-r/pull/89</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g0"</span>, <span class="st">"p401"</span>,</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">9</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">33</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_m"</span>, <span class="st">"p401"</span>,</span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">12</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_r1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">25</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>dml_iivm_boost<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a>dml_iivm_boost<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)    
p401     12624       1624   7.775 7.53e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="iivm-results-summary" class="level2">
<h2 class="anchored" data-anchor-id="iivm-results-summary">IIVM results summary</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>confints_iivm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  dml_iivm_lasso<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  dml_iivm_forest<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  dml_iivm_tree<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  dml_iivm_boost<span class="sc">$</span><span class="fu">confint</span>()</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>estimates_iivm <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  dml_iivm_lasso<span class="sc">$</span>coef,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  dml_iivm_forest<span class="sc">$</span>coef,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  dml_iivm_tree<span class="sc">$</span>coef,</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  dml_iivm_boost<span class="sc">$</span>coef</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>result_iivm <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"IIVM"</span>,</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">ML =</span> <span class="fu">c</span>(<span class="st">"lasso"</span>, <span class="st">"random forest"</span>, <span class="st">"decision tree"</span>, <span class="st">"xgboost"</span>),</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> estimates_iivm,</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> confints_iivm[, <span class="dv">1</span>],</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> confints_iivm[, <span class="dv">2</span>]</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>result_iivm</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  model ML            Estimate lower  upper
  &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 IIVM  lasso           12802. 8999. 16606.
2 IIVM  random forest   11792. 8649. 14936.
3 IIVM  decision tree   12214. 8856. 15573.
4 IIVM  xgboost         12624. 9442. 15806.</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(result_iivm, <span class="fu">aes</span>(<span class="at">x =</span> ML, <span class="at">y =</span> Estimate, <span class="at">color =</span> ML)) <span class="sc">+</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> ML))  <span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Coefficients and 0.95- confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="all-results-together" class="level2">
<h2 class="anchored" data-anchor-id="all-results-together">All results together</h2>
<p>Finally, we combine results across PLR, IRM, and IIVM into one table and plot.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>summary_result <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_plr, result_irm, result_iivm) <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PLR"</span>, <span class="st">"IRM"</span>, <span class="st">"IIVM"</span>)))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>summary_result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 5
   model ML            Estimate lower  upper
   &lt;fct&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 PLR   lasso            9580. 6982. 12177.
 2 PLR   random forest    9127. 6554. 11700.
 3 PLR   decision tree    8210. 5616. 10804.
 4 PLR   xgboost          9334. 6562. 12107.
 5 IRM   lasso            8850. 6222. 11478.
 6 IRM   random forest    8202. 6010. 10394.
 7 IRM   decision tree    8415. 6092. 10739.
 8 IRM   xgboost          8356. 6062. 10650.
 9 IIVM  lasso           12802. 8999. 16606.
10 IIVM  random forest   11792. 8649. 14936.
11 IIVM  decision tree   12214. 8856. 15573.
12 IIVM  xgboost         12624. 9442. 15806.</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summary_result, <span class="fu">aes</span>(<span class="at">x =</span> ML, <span class="at">y =</span> Estimate, <span class="at">color =</span> ML)) <span class="sc">+</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> ML))  <span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Coefficients and 0.95- confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(model <span class="sc">~</span>., <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We report results based on four ML methods for estimating the nuisance functions used in forming the orthogonal estimating equations. We find again that the estimates of the treatment effect are stable across ML methods. The estimates are highly significant, hence we would reject the hypothesis that 401(k) participation has no effect on financial wealth.</p>
<p>Across PLR and IRM, the estimated effect of eligibility (e401) on net financial assets (net_tfa) is consistently positive across all learners. The estimates fall roughly in the range of $8k–$9.6k, and the 95% confidence intervals remain above zero, suggesting a robust positive association after adjusting for observed covariates.</p>
<p>In the IIVM results, the target changes: we estimate the effect of participation (p401) using eligibility (e401) as an instrument. These estimates are larger (around $11.8k–$12.8k), which is common in IV settings because the effect is identified for compliers and depends on how strongly the instrument shifts participation. Therefore, IIVM should be read as a LATE (complier effect), not directly comparable to PLR/IRM as a population average.</p>
</section>
<section id="read-more" class="level2">
<h2 class="anchored" data-anchor-id="read-more">Read more</h2>
<p>Double Machine Learning Approach</p>
<ul>
<li><p>Chernozhukov, V., Chetverikov, D., Demirer, M., Duflo, E., Hansen, C., Newey, W. and Robins, J. (2018), Double/debiased machine learning for treatment and structural parameters. The Econometrics Journal, 21: C1-C68, doi:10.1111/ectj.12097.</p></li>
<li><p>Chernozhukov, V., Hansen, C., Kallus, N., Spindler, M., and Syrgkanis, V. (forthcoming), Applied Causal Inference Powered by ML and AI.</p></li>
</ul>
<p>DoubleML Package for Python and R</p>
<ul>
<li><p>Bach, P., Chernozhukov, V., Kurz, M. S., and Spindler, M. (2021), DoubleML - An Object-Oriented Implementation of Double Machine Learning in R, arXiv:2103.09603.</p></li>
<li><p>Bach, P., Chernozhukov, V., Kurz, M. S., and Spindler, M. (2022), DoubleML - An Object-Oriented Implementation of Double Machine Learning in Python, Journal of Machine Learning Research, 23(53): 1-6, https://www.jmlr.org/papers/v23/21-0862.html.</p></li>
</ul>


<!-- -->

</section>
</section>

</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb82" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Causal inference using Machine Learning"</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Tutorial"</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Harsha Chamara Hewage"</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2026-02-13"</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "cover.png"</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - Causal Inference</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - Machine Learning</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - Double Machine Learning</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="an">link-external-newwindow:</span><span class="co"> true</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="in">/* FONT IMPORT */</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="in">@import url('[https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&amp;display=swap](https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&amp;display=swap)');</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a><span class="in">/* GENERAL STYLING */</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a><span class="in">body {</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a><span class="in">  font-family: 'Assistant', sans-serif;</span></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: #f9f9f9;</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a><span class="in">/* HERO SECTION */</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a><span class="in">.hero-section {</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: #1a2b48; /* Dark Navy Blue */</span></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a><span class="in">  color: #ffffff;</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 60px 20px;</span></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a><span class="in">  text-align: center;</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a><span class="in">  border-radius: 10px;</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: 20px;</span></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-bottom: 40px;</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a><span class="in">.hero-section h1 {</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 2.8em;</span></span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a><span class="in">  font-weight: 700;</span></span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-bottom: 10px;</span></span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a><span class="in">.hero-section .description {</span></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 1.2em;</span></span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a><span class="in">  max-width: 700px;</span></span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a><span class="in">  margin: 0 auto 30px auto;</span></span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a><span class="in">  opacity: 0.9;</span></span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a><span class="in">.hero-section .author-date {</span></span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 1em;</span></span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a><span class="in">  color: #ccc;</span></span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a><span class="in">/* CALL-TO-ACTION BUTTONS */</span></span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a><span class="in">.cta-buttons {</span></span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a><span class="in">  display: flex;</span></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a><span class="in">  justify-content: center;</span></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a><span class="in">  flex-wrap: wrap;</span></span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a><span class="in">  gap: 15px;</span></span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: 30px;</span></span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a><span class="in">.btn-custom {</span></span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 12px 25px;</span></span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 1em;</span></span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a><span class="in">  font-weight: 600;</span></span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a><span class="in">  text-decoration: none;</span></span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a><span class="in">  border-radius: 8px;</span></span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a><span class="in">  transition: all 0.3s ease;</span></span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a><span class="in">  cursor: pointer;</span></span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a><span class="in">  display: inline-flex;</span></span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true" tabindex="-1"></a><span class="in">  align-items: center;</span></span>
<span id="cb82-77"><a href="#cb82-77" aria-hidden="true" tabindex="-1"></a><span class="in">  gap: 8px;</span></span>
<span id="cb82-78"><a href="#cb82-78" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-79"><a href="#cb82-79" aria-hidden="true" tabindex="-1"></a><span class="in">.btn-primary {</span></span>
<span id="cb82-80"><a href="#cb82-80" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: #0A4C6A; /* Professional Teal/Blue */</span></span>
<span id="cb82-81"><a href="#cb82-81" aria-hidden="true" tabindex="-1"></a><span class="in">  color: #fff;</span></span>
<span id="cb82-82"><a href="#cb82-82" aria-hidden="true" tabindex="-1"></a><span class="in">  border: 2px solid #0A4C6A;</span></span>
<span id="cb82-83"><a href="#cb82-83" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-84"><a href="#cb82-84" aria-hidden="true" tabindex="-1"></a><span class="in">.btn-primary:hover {</span></span>
<span id="cb82-85"><a href="#cb82-85" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: #083c54;</span></span>
<span id="cb82-86"><a href="#cb82-86" aria-hidden="true" tabindex="-1"></a><span class="in">  border-color: #083c54;</span></span>
<span id="cb82-87"><a href="#cb82-87" aria-hidden="true" tabindex="-1"></a><span class="in">  transform: translateY(-2px);</span></span>
<span id="cb82-88"><a href="#cb82-88" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-89"><a href="#cb82-89" aria-hidden="true" tabindex="-1"></a><span class="in">.btn-secondary {</span></span>
<span id="cb82-90"><a href="#cb82-90" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: transparent;</span></span>
<span id="cb82-91"><a href="#cb82-91" aria-hidden="true" tabindex="-1"></a><span class="in">  color: #fff;</span></span>
<span id="cb82-92"><a href="#cb82-92" aria-hidden="true" tabindex="-1"></a><span class="in">  border: 2px solid #fff;</span></span>
<span id="cb82-93"><a href="#cb82-93" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-94"><a href="#cb82-94" aria-hidden="true" tabindex="-1"></a><span class="in">.btn-secondary:hover {</span></span>
<span id="cb82-95"><a href="#cb82-95" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: #fff;</span></span>
<span id="cb82-96"><a href="#cb82-96" aria-hidden="true" tabindex="-1"></a><span class="in">  color: #1a2b48;</span></span>
<span id="cb82-97"><a href="#cb82-97" aria-hidden="true" tabindex="-1"></a><span class="in">  transform: translateY(-2px);</span></span>
<span id="cb82-98"><a href="#cb82-98" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-99"><a href="#cb82-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-100"><a href="#cb82-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-101"><a href="#cb82-101" aria-hidden="true" tabindex="-1"></a><span class="in">/* CONTENT SECTION STYLING */</span></span>
<span id="cb82-102"><a href="#cb82-102" aria-hidden="true" tabindex="-1"></a><span class="in">.content-section {</span></span>
<span id="cb82-103"><a href="#cb82-103" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: #ffffff;</span></span>
<span id="cb82-104"><a href="#cb82-104" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 40px;</span></span>
<span id="cb82-105"><a href="#cb82-105" aria-hidden="true" tabindex="-1"></a><span class="in">  border-radius: 10px;</span></span>
<span id="cb82-106"><a href="#cb82-106" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-bottom: 40px;</span></span>
<span id="cb82-107"><a href="#cb82-107" aria-hidden="true" tabindex="-1"></a><span class="in">  box-shadow: 0 4px 15px rgba(0,0,0,0.05);</span></span>
<span id="cb82-108"><a href="#cb82-108" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb82-109"><a href="#cb82-109" aria-hidden="true" tabindex="-1"></a><span class="in">/* We remove the h2 styling from the generic content section</span></span>
<span id="cb82-110"><a href="#cb82-110" aria-hidden="true" tabindex="-1"></a><span class="in">   to let Quarto's markdown headings take precedence */</span></span>
<span id="cb82-111"><a href="#cb82-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-112"><a href="#cb82-112" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb82-113"><a href="#cb82-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-114"><a href="#cb82-114" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;!-- Add Font Awesome for icons --&gt;</span></span>
<span id="cb82-115"><a href="#cb82-115" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;link rel="stylesheet" href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css)"&gt;</span></span>
<span id="cb82-116"><a href="#cb82-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-117"><a href="#cb82-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-118"><a href="#cb82-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-121"><a href="#cb82-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-122"><a href="#cb82-122" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb82-123"><a href="#cb82-123" aria-hidden="true" tabindex="-1"></a><span class="co">#| context: setup</span></span>
<span id="cb82-124"><a href="#cb82-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-125"><a href="#cb82-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-126"><a href="#cb82-126" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. list your CRAN packages</span></span>
<span id="cb82-127"><a href="#cb82-127" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"hdm"</span>, <span class="st">"broom"</span>, <span class="st">"modelsummary"</span>, <span class="st">"gt"</span>, <span class="st">"remotes"</span>, <span class="st">"mlr3"</span>, <span class="st">"mlr3learners"</span>, <span class="st">"DoubleML"</span>, <span class="st">"glmnet"</span>, <span class="st">"ranger"</span>, <span class="st">"xgboost"</span>, <span class="st">"data.table"</span>)</span>
<span id="cb82-128"><a href="#cb82-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-129"><a href="#cb82-129" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. install any that are missing</span></span>
<span id="cb82-130"><a href="#cb82-130" aria-hidden="true" tabindex="-1"></a>new_packages <span class="ot">&lt;-</span> required_packages[<span class="sc">!</span>required_packages <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">"Package"</span>]]</span>
<span id="cb82-131"><a href="#cb82-131" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(new_packages)) {</span>
<span id="cb82-132"><a href="#cb82-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(new_packages)</span>
<span id="cb82-133"><a href="#cb82-133" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-134"><a href="#cb82-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-135"><a href="#cb82-135" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. load them</span></span>
<span id="cb82-136"><a href="#cb82-136" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(required_packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb82-137"><a href="#cb82-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-138"><a href="#cb82-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-139"><a href="#cb82-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-140"><a href="#cb82-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb82-141"><a href="#cb82-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-142"><a href="#cb82-142" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="hero-section"&gt;</span></span>
<span id="cb82-143"><a href="#cb82-143" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;h1 class="title"&gt;Causal inference using Machine Learning&lt;/h1&gt;</span></span>
<span id="cb82-144"><a href="#cb82-144" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;p class="description"&gt;Tutorial.&lt;/p&gt;</span></span>
<span id="cb82-145"><a href="#cb82-145" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;p class="author-date"&gt;Harsha Chamara Hewage | 2026-02-13&lt;/p&gt;</span></span>
<span id="cb82-146"><a href="#cb82-146" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb82-147"><a href="#cb82-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-148"><a href="#cb82-148" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="content-section"&gt;</span></span>
<span id="cb82-149"><a href="#cb82-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-150"><a href="#cb82-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-151"><a href="#cb82-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-152"><a href="#cb82-152" aria-hidden="true" tabindex="-1"></a><span class="fu"># PART 1: Double Lasso for Testing the Convergence Hypothesis</span></span>
<span id="cb82-153"><a href="#cb82-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-154"><a href="#cb82-154" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb82-155"><a href="#cb82-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-156"><a href="#cb82-156" aria-hidden="true" tabindex="-1"></a>We provide an empirical example of **partialling-out with Lasso** (often called **Double Lasso**) to estimate the regression coefficient $\beta_1$ in the high-dimensional linear regression model:</span>
<span id="cb82-157"><a href="#cb82-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-158"><a href="#cb82-158" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-159"><a href="#cb82-159" aria-hidden="true" tabindex="-1"></a>Y = \beta_1 D + \beta_2'W + \epsilon.</span>
<span id="cb82-160"><a href="#cb82-160" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-161"><a href="#cb82-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-162"><a href="#cb82-162" aria-hidden="true" tabindex="-1"></a>Specifically, we are interested in how the rates at which economies of different countries grow ($Y$) are related to the initial wealth levels in each country ($D$), while controlling for institutional, educational, and other country characteristics ($W$).</span>
<span id="cb82-163"><a href="#cb82-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-164"><a href="#cb82-164" aria-hidden="true" tabindex="-1"></a>The relationship is captured by $\beta_1$, the **speed of convergence/divergence**:</span>
<span id="cb82-165"><a href="#cb82-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-166"><a href="#cb82-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_1 &lt; 0$: poorer countries catch up (**convergence**)</span>
<span id="cb82-167"><a href="#cb82-167" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_1 &gt; 0$: poorer countries fall behind (**divergence**)</span>
<span id="cb82-168"><a href="#cb82-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-169"><a href="#cb82-169" aria-hidden="true" tabindex="-1"></a>Our inference question is:</span>
<span id="cb82-170"><a href="#cb82-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-171"><a href="#cb82-171" aria-hidden="true" tabindex="-1"></a>Our inference question here is: *do poor countries grow faster than rich countries, controlling for educational and other characteristics?* In other words, is the speed of convergence negative: $\beta_1 &lt;0?$</span>
<span id="cb82-172"><a href="#cb82-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-173"><a href="#cb82-173" aria-hidden="true" tabindex="-1"></a>This idea is closely related to the **Convergence Hypothesis** predicted by the Solow Growth Model. This is a structural economic model. Under some strong assumptions (not discussed here), this predictive exercise can be given a causal interpretation.</span>
<span id="cb82-174"><a href="#cb82-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-175"><a href="#cb82-175" aria-hidden="true" tabindex="-1"></a>**In this dataset:**</span>
<span id="cb82-176"><a href="#cb82-176" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Y$ is the realised annual growth rate of a country’s wealth (GDP per capita growth),</span>
<span id="cb82-177"><a href="#cb82-177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$D$ is the initial level of wealth (GDP per capita at baseline),</span>
<span id="cb82-178"><a href="#cb82-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$W$ includes education, institutions, openness, political stability, and similar controls.</span>
<span id="cb82-179"><a href="#cb82-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-180"><a href="#cb82-180" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup</span></span>
<span id="cb82-181"><a href="#cb82-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-182"><a href="#cb82-182" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb82-183"><a href="#cb82-183" aria-hidden="true" tabindex="-1"></a><span class="fu">## Install packages (run once)</span></span>
<span id="cb82-184"><a href="#cb82-184" aria-hidden="true" tabindex="-1"></a>If you are running this notebook for the first time, install these packages.  </span>
<span id="cb82-185"><a href="#cb82-185" aria-hidden="true" tabindex="-1"></a>This chunk is set to <span class="in">`eval: false`</span> so it will not run automatically when you render.</span>
<span id="cb82-186"><a href="#cb82-186" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb82-187"><a href="#cb82-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-188"><a href="#cb82-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb82-189"><a href="#cb82-189" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"hdm"</span>, <span class="st">"broom"</span>, <span class="st">"modelsummary"</span>, <span class="st">"gt"</span>))</span>
<span id="cb82-190"><a href="#cb82-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-191"><a href="#cb82-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-194"><a href="#cb82-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-195"><a href="#cb82-195" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb82-196"><a href="#cb82-196" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hdm)          <span class="co"># high-dimensional methods including rlasso and rlassoEffect</span></span>
<span id="cb82-197"><a href="#cb82-197" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)        <span class="co"># tidy model summaries</span></span>
<span id="cb82-198"><a href="#cb82-198" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary) <span class="co"># clean regression tables</span></span>
<span id="cb82-199"><a href="#cb82-199" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb82-200"><a href="#cb82-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-201"><a href="#cb82-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-202"><a href="#cb82-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data analysis</span></span>
<span id="cb82-203"><a href="#cb82-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-204"><a href="#cb82-204" aria-hidden="true" tabindex="-1"></a>We consider the dataset GrowthData, which is included in the package hdm.</span>
<span id="cb82-205"><a href="#cb82-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-208"><a href="#cb82-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-209"><a href="#cb82-209" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(GrowthData) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>intercept)</span>
<span id="cb82-210"><a href="#cb82-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-211"><a href="#cb82-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-214"><a href="#cb82-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-215"><a href="#cb82-215" aria-hidden="true" tabindex="-1"></a>growth <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb82-216"><a href="#cb82-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-217"><a href="#cb82-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-218"><a href="#cb82-218" aria-hidden="true" tabindex="-1"></a>**Exercise 1:** First, get familiar with the data. Determine the dimensions of our data set and calculate the $p/n$ ratio. Do we have a high-dimensional setting?</span>
<span id="cb82-219"><a href="#cb82-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-220"><a href="#cb82-220" aria-hidden="true" tabindex="-1"></a>First, check the number of observations and variables.</span>
<span id="cb82-221"><a href="#cb82-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-222"><a href="#cb82-222" aria-hidden="true" tabindex="-1"></a>A simple way to judge whether we are in a “high-dimensional” regime is to compare:</span>
<span id="cb82-223"><a href="#cb82-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-224"><a href="#cb82-224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$n$ = number of observations (countries)</span>
<span id="cb82-225"><a href="#cb82-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-226"><a href="#cb82-226" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$p$ = number of variables (columns)</span>
<span id="cb82-227"><a href="#cb82-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-228"><a href="#cb82-228" aria-hidden="true" tabindex="-1"></a>If $p/n$ is not small, OLS can become unstable (high variance, noisy estimates), especially when many controls are weakly related to the outcome.</span>
<span id="cb82-229"><a href="#cb82-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-230"><a href="#cb82-230" aria-hidden="true" tabindex="-1"></a>Compute $n$, $p$, and $p/n$:</span>
<span id="cb82-231"><a href="#cb82-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-234"><a href="#cb82-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-235"><a href="#cb82-235" aria-hidden="true" tabindex="-1"></a>growth <span class="sc">|&gt;</span></span>
<span id="cb82-236"><a href="#cb82-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb82-237"><a href="#cb82-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb82-238"><a href="#cb82-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">ncol</span>(growth),</span>
<span id="cb82-239"><a href="#cb82-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_over_n =</span> p <span class="sc">/</span> n</span>
<span id="cb82-240"><a href="#cb82-240" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-241"><a href="#cb82-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-242"><a href="#cb82-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-243"><a href="#cb82-243" aria-hidden="true" tabindex="-1"></a>We can also print the dimensions directly.</span>
<span id="cb82-244"><a href="#cb82-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-247"><a href="#cb82-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-248"><a href="#cb82-248" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(growth)</span>
<span id="cb82-249"><a href="#cb82-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-250"><a href="#cb82-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-251"><a href="#cb82-251" aria-hidden="true" tabindex="-1"></a>The sample contains about 90 countries and about 63 variables, so $p/n$ is not small. In this setting, the least squares method may provide a noisy estimate of $\beta_1$, especially when many controls are weakly informative.</span>
<span id="cb82-252"><a href="#cb82-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-253"><a href="#cb82-253" aria-hidden="true" tabindex="-1"></a>This is one reason methods based on regularisation (such as Lasso) become useful: they help us focus on the most relevant controls, rather than estimating everything with equal weight.</span>
<span id="cb82-254"><a href="#cb82-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-255"><a href="#cb82-255" aria-hidden="true" tabindex="-1"></a>**Exercise 2:** To check the convergence hypothesis, analyze the relationship between the country's growth rate $Y$ and the country's other characteristics by running a linear regression (ols) in the first step. Determine the regression coefficient $\beta_1$ of the target regressor *gdpsh465* (initial wealth level, $D$), its 95% confidence interval and the standard error.</span>
<span id="cb82-256"><a href="#cb82-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-257"><a href="#cb82-257" aria-hidden="true" tabindex="-1"></a>We begin by estimating a standard regression model using all available controls:</span>
<span id="cb82-258"><a href="#cb82-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-259"><a href="#cb82-259" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-260"><a href="#cb82-260" aria-hidden="true" tabindex="-1"></a>Outcome = \alpha + \beta_1 \, gdpsh465 + \text{(other controls)} + \epsilon.</span>
<span id="cb82-261"><a href="#cb82-261" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-262"><a href="#cb82-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-263"><a href="#cb82-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-264"><a href="#cb82-264" aria-hidden="true" tabindex="-1"></a>Our focus is the coefficient on **`gdpsh465`** (initial GDP per capita), because it corresponds to the target regressor $D$ and the parameter $\beta_1$.</span>
<span id="cb82-265"><a href="#cb82-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-266"><a href="#cb82-266" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fit the model</span></span>
<span id="cb82-267"><a href="#cb82-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-270"><a href="#cb82-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-271"><a href="#cb82-271" aria-hidden="true" tabindex="-1"></a>ols_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Outcome <span class="sc">~</span> ., <span class="at">data =</span> growth)</span>
<span id="cb82-272"><a href="#cb82-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-273"><a href="#cb82-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-274"><a href="#cb82-274" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extract the coefficient of interest (`gdpsh465`)</span></span>
<span id="cb82-275"><a href="#cb82-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-276"><a href="#cb82-276" aria-hidden="true" tabindex="-1"></a>Instead of printing the full table (which is long), we extract only the one coefficient we care about.</span>
<span id="cb82-277"><a href="#cb82-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-280"><a href="#cb82-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-281"><a href="#cb82-281" aria-hidden="true" tabindex="-1"></a>ols_key <span class="ot">&lt;-</span> <span class="fu">tidy</span>(ols_fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-282"><a href="#cb82-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"gdpsh465"</span>)</span>
<span id="cb82-283"><a href="#cb82-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-284"><a href="#cb82-284" aria-hidden="true" tabindex="-1"></a>ols_key</span>
<span id="cb82-285"><a href="#cb82-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-286"><a href="#cb82-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-287"><a href="#cb82-287" aria-hidden="true" tabindex="-1"></a>How to read this row:</span>
<span id="cb82-288"><a href="#cb82-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-289"><a href="#cb82-289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`estimate`</span>: our estimate of $\beta_1$</span>
<span id="cb82-290"><a href="#cb82-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-291"><a href="#cb82-291" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`std.error`</span>: the standard error of the estimate</span>
<span id="cb82-292"><a href="#cb82-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-293"><a href="#cb82-293" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`conf.low`</span> and <span class="in">`conf.high`</span>: the 95% confidence interval</span>
<span id="cb82-294"><a href="#cb82-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-295"><a href="#cb82-295" aria-hidden="true" tabindex="-1"></a>If the confidence interval includes 0, the evidence for convergence/divergence is weaker (based on this model). So, least squares provides a rather noisy estimate of the speed of convergence, and does not allow us to answer the question about the convergence hypothesis as the confidence interval includes zero.</span>
<span id="cb82-296"><a href="#cb82-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-297"><a href="#cb82-297" aria-hidden="true" tabindex="-1"></a>If you want a more “report-style” table:</span>
<span id="cb82-298"><a href="#cb82-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-301"><a href="#cb82-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-302"><a href="#cb82-302" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb82-303"><a href="#cb82-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"OLS (all controls)"</span> <span class="ot">=</span> ols_fit),</span>
<span id="cb82-304"><a href="#cb82-304" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> <span class="fu">c</span>(<span class="st">"gdpsh465"</span> <span class="ot">=</span> <span class="st">"Initial GDP per capita (gdpsh465)"</span>),</span>
<span id="cb82-305"><a href="#cb82-305" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="fu">c</span>(<span class="st">"std.error"</span>, <span class="st">"conf.int"</span>),</span>
<span id="cb82-306"><a href="#cb82-306" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"gt"</span></span>
<span id="cb82-307"><a href="#cb82-307" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-308"><a href="#cb82-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-309"><a href="#cb82-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-310"><a href="#cb82-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-311"><a href="#cb82-311" aria-hidden="true" tabindex="-1"></a>**Exercise 3:** In contrast, use the partialling-out approach based on lasso regression ("Double Lasso"). Again, determine the regression coefficient $\beta_1$ of the target regressor *gdpsh465* (initial wealth level, $D$), its 95% confidence interval and the standard error.</span>
<span id="cb82-312"><a href="#cb82-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-313"><a href="#cb82-313" aria-hidden="true" tabindex="-1"></a>When we have many controls (and especially when $p/n$ is not small), a full OLS regression can become noisy and unstable. Double Lasso (also called partialling-out with Lasso) is designed to estimate $\beta_1$ while handling high-dimensional controls.</span>
<span id="cb82-314"><a href="#cb82-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-315"><a href="#cb82-315" aria-hidden="true" tabindex="-1"></a>The key idea is:</span>
<span id="cb82-316"><a href="#cb82-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-317"><a href="#cb82-317" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use Lasso to partial out controls $W$ from the outcome $Y$</span>
<span id="cb82-318"><a href="#cb82-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-319"><a href="#cb82-319" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use Lasso to partial out controls $W$ from the regressor $D$</span>
<span id="cb82-320"><a href="#cb82-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-321"><a href="#cb82-321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Regress the residualised outcome on the residualised regressor</span>
<span id="cb82-322"><a href="#cb82-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-323"><a href="#cb82-323" aria-hidden="true" tabindex="-1"></a>This helps ensure the controls we include are the ones that matter for predicting either $Y$ or $D$.</span>
<span id="cb82-324"><a href="#cb82-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-325"><a href="#cb82-325" aria-hidden="true" tabindex="-1"></a>**Step 1:** Define $Y$, $D$, and $W$</span>
<span id="cb82-326"><a href="#cb82-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-327"><a href="#cb82-327" aria-hidden="true" tabindex="-1"></a>We define:</span>
<span id="cb82-328"><a href="#cb82-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-329"><a href="#cb82-329" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Y$: <span class="in">`Outcome`</span></span>
<span id="cb82-330"><a href="#cb82-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-331"><a href="#cb82-331" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$D$: <span class="in">`gdpsh465`</span></span>
<span id="cb82-332"><a href="#cb82-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-333"><a href="#cb82-333" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$W$: everything else (all other columns)</span>
<span id="cb82-334"><a href="#cb82-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-335"><a href="#cb82-335" aria-hidden="true" tabindex="-1"></a>We use name-based selection (more readable and safer than column positions).</span>
<span id="cb82-336"><a href="#cb82-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-339"><a href="#cb82-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-340"><a href="#cb82-340" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> growth <span class="sc">|&gt;</span> <span class="fu">pull</span>(Outcome)</span>
<span id="cb82-341"><a href="#cb82-341" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> growth <span class="sc">|&gt;</span> <span class="fu">pull</span>(gdpsh465)</span>
<span id="cb82-342"><a href="#cb82-342" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> growth <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Outcome, <span class="sc">-</span>gdpsh465) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb82-343"><a href="#cb82-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-344"><a href="#cb82-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-345"><a href="#cb82-345" aria-hidden="true" tabindex="-1"></a>**Step 2:** Partial out $W$ from $Y$ using Lasso</span>
<span id="cb82-346"><a href="#cb82-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-347"><a href="#cb82-347" aria-hidden="true" tabindex="-1"></a>Here we regress $Y$ on $W$ using Lasso, and keep the residuals:</span>
<span id="cb82-348"><a href="#cb82-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-351"><a href="#cb82-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-352"><a href="#cb82-352" aria-hidden="true" tabindex="-1"></a>rY <span class="ot">&lt;-</span> <span class="fu">rlasso</span>(<span class="at">x =</span> W, <span class="at">y =</span> Y)<span class="sc">$</span>res</span>
<span id="cb82-353"><a href="#cb82-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-354"><a href="#cb82-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-355"><a href="#cb82-355" aria-hidden="true" tabindex="-1"></a><span class="in">`rY`</span> is the part of the outcome not explained by controls.</span>
<span id="cb82-356"><a href="#cb82-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-357"><a href="#cb82-357" aria-hidden="true" tabindex="-1"></a>**Step 3:** Partial out $W$ from $D$ using Lasso</span>
<span id="cb82-358"><a href="#cb82-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-359"><a href="#cb82-359" aria-hidden="true" tabindex="-1"></a>Now we regress $D$ on $W$ using Lasso, and keep the residuals:</span>
<span id="cb82-360"><a href="#cb82-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-363"><a href="#cb82-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-364"><a href="#cb82-364" aria-hidden="true" tabindex="-1"></a>rD <span class="ot">&lt;-</span> <span class="fu">rlasso</span>(<span class="at">x =</span> W, <span class="at">y =</span> D)<span class="sc">$</span>res</span>
<span id="cb82-365"><a href="#cb82-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-366"><a href="#cb82-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-367"><a href="#cb82-367" aria-hidden="true" tabindex="-1"></a><span class="in">`rD`</span> is the part of the regressor not explained by controls.</span>
<span id="cb82-368"><a href="#cb82-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-369"><a href="#cb82-369" aria-hidden="true" tabindex="-1"></a>**Step 4:** Regress residualised $Y$ on residualised $D$</span>
<span id="cb82-370"><a href="#cb82-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-371"><a href="#cb82-371" aria-hidden="true" tabindex="-1"></a>Finally, regress <span class="in">`rY`</span> on <span class="in">`rD`</span>:</span>
<span id="cb82-372"><a href="#cb82-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-375"><a href="#cb82-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-376"><a href="#cb82-376" aria-hidden="true" tabindex="-1"></a>dl_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(rY <span class="sc">~</span> rD)</span>
<span id="cb82-377"><a href="#cb82-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-378"><a href="#cb82-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-379"><a href="#cb82-379" aria-hidden="true" tabindex="-1"></a>This last step estimates $\beta_1$ using the variation that remains after removing what controls explain.</span>
<span id="cb82-380"><a href="#cb82-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-381"><a href="#cb82-381" aria-hidden="true" tabindex="-1"></a>**Step 5:** Extract the Double Lasso estimate</span>
<span id="cb82-382"><a href="#cb82-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-385"><a href="#cb82-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-386"><a href="#cb82-386" aria-hidden="true" tabindex="-1"></a>dl_key <span class="ot">&lt;-</span> <span class="fu">tidy</span>(dl_fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-387"><a href="#cb82-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"rD"</span>)</span>
<span id="cb82-388"><a href="#cb82-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-389"><a href="#cb82-389" aria-hidden="true" tabindex="-1"></a>dl_key</span>
<span id="cb82-390"><a href="#cb82-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-391"><a href="#cb82-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-392"><a href="#cb82-392" aria-hidden="true" tabindex="-1"></a>Lasso provides a more precise estimate (lower standard error). The Lasso based point estimate is  about $-5\%$ and the $95\%$ confidence interval for the</span>
<span id="cb82-393"><a href="#cb82-393" aria-hidden="true" tabindex="-1"></a>(annual) rate of convergence is $7.8\%$ to $2.2\%$. This empirical evidence does support the convergence hypothesis.</span>
<span id="cb82-394"><a href="#cb82-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-395"><a href="#cb82-395" aria-hidden="true" tabindex="-1"></a>Note: Alternatively, one could also use the *rlassoEffect* funtion from the *hdm* package that directly applies the partialling-out approach.</span>
<span id="cb82-396"><a href="#cb82-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-399"><a href="#cb82-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-400"><a href="#cb82-400" aria-hidden="true" tabindex="-1"></a>dl_effect <span class="ot">&lt;-</span> <span class="fu">rlassoEffect</span>(<span class="at">x =</span> W, <span class="at">y =</span> Y, <span class="at">d =</span> D, <span class="at">method =</span> <span class="st">"partialling out"</span>)</span>
<span id="cb82-401"><a href="#cb82-401" aria-hidden="true" tabindex="-1"></a>dl_effect</span>
<span id="cb82-402"><a href="#cb82-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-403"><a href="#cb82-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-404"><a href="#cb82-404" aria-hidden="true" tabindex="-1"></a>**Exercise 4:** Finally, let us have a look at the results. Compare the results of Exercise 2 and Exercise 3 and interpret your findings.</span>
<span id="cb82-405"><a href="#cb82-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-406"><a href="#cb82-406" aria-hidden="true" tabindex="-1"></a>Now we compare the two estimates (OLS and Double Lasso) side-by-side.</span>
<span id="cb82-407"><a href="#cb82-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-410"><a href="#cb82-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-411"><a href="#cb82-411" aria-hidden="true" tabindex="-1"></a>compare_tbl <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb82-412"><a href="#cb82-412" aria-hidden="true" tabindex="-1"></a>  ols_key <span class="sc">|&gt;</span> <span class="fu">transmute</span>(<span class="at">model =</span> <span class="st">"OLS"</span>, estimate, std.error, conf.low, conf.high),</span>
<span id="cb82-413"><a href="#cb82-413" aria-hidden="true" tabindex="-1"></a>  dl_key  <span class="sc">|&gt;</span> <span class="fu">transmute</span>(<span class="at">model =</span> <span class="st">"Double Lasso"</span>, estimate, std.error, conf.low, conf.high)</span>
<span id="cb82-414"><a href="#cb82-414" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb82-415"><a href="#cb82-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">4</span>)))</span>
<span id="cb82-416"><a href="#cb82-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-417"><a href="#cb82-417" aria-hidden="true" tabindex="-1"></a>compare_tbl</span>
<span id="cb82-418"><a href="#cb82-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-419"><a href="#cb82-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-420"><a href="#cb82-420" aria-hidden="true" tabindex="-1"></a>The least square method provides a rather noisy estimate of the speed of convergence. We cannot answer the question of whether poor countries grow faster than rich countries. The least square method does not work when the ratio $p/n$ is large.</span>
<span id="cb82-421"><a href="#cb82-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-422"><a href="#cb82-422" aria-hidden="true" tabindex="-1"></a>In sharp contrast, partialling-out via Lasso provides a more precise estimate. The Lasso-based point estimate is $-5\%$ and the $95\%$ confidence interval for the (annual) rate of convergence $<span class="co">[</span><span class="ot">-7.8\%,-2.2\%</span><span class="co">]</span>$ only includes negative numbers. This empirical evidence does support the convergence hypothesis.</span>
<span id="cb82-423"><a href="#cb82-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-424"><a href="#cb82-424" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting the results</span></span>
<span id="cb82-425"><a href="#cb82-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-426"><a href="#cb82-426" aria-hidden="true" tabindex="-1"></a>For the OLS regression, the estimated coefficient on **`gdpsh465`** is:</span>
<span id="cb82-427"><a href="#cb82-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-428"><a href="#cb82-428" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>estimate = -0.0094  </span>
<span id="cb82-429"><a href="#cb82-429" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>95% CI = <span class="co">[</span><span class="ot">-0.0706, 0.0518</span><span class="co">]</span></span>
<span id="cb82-430"><a href="#cb82-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-431"><a href="#cb82-431" aria-hidden="true" tabindex="-1"></a>This interval includes zero, so **OLS does not provide strong evidence** for convergence or divergence in this specification. This does not mean OLS is “wrong”, but in settings with many controls relative to sample size, OLS estimates can be **imprecise** (large standard errors), making inference difficult.</span>
<span id="cb82-432"><a href="#cb82-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-433"><a href="#cb82-433" aria-hidden="true" tabindex="-1"></a>For Double Lasso (partialling-out), the estimated coefficient is:</span>
<span id="cb82-434"><a href="#cb82-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-435"><a href="#cb82-435" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>estimate = -0.0498  </span>
<span id="cb82-436"><a href="#cb82-436" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>95% CI = <span class="co">[</span><span class="ot">-0.0775, -0.0221</span><span class="co">]</span></span>
<span id="cb82-437"><a href="#cb82-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-438"><a href="#cb82-438" aria-hidden="true" tabindex="-1"></a>This interval is fully below zero. Since **$\beta_1 &lt; 0$ corresponds to convergence**, the Double Lasso results provide evidence consistent with the convergence hypothesis: **poorer countries tend to grow faster than richer countries, conditional on the selected controls**.</span>
<span id="cb82-439"><a href="#cb82-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-440"><a href="#cb82-440" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb82-441"><a href="#cb82-441" aria-hidden="true" tabindex="-1"></a>**Causal interpretation (important):**  </span>
<span id="cb82-442"><a href="#cb82-442" aria-hidden="true" tabindex="-1"></a>A causal interpretation requires additional assumptions (e.g., after controlling for $(W)$, there are no unobserved confounders affecting both initial wealth and subsequent growth). Double Lasso helps with **high-dimensional controls**, but it does not automatically guarantee causality.</span>
<span id="cb82-443"><a href="#cb82-443" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb82-444"><a href="#cb82-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-445"><a href="#cb82-445" aria-hidden="true" tabindex="-1"></a><span class="fu"># PART 2: Impact of 401(k) on Financial Wealth using Double Machine Learning</span></span>
<span id="cb82-446"><a href="#cb82-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-447"><a href="#cb82-447" aria-hidden="true" tabindex="-1"></a>In this real-data example, we illustrate how the <span class="co">[</span><span class="ot">DoubleML</span><span class="co">](https://docs.doubleml.org/stable/index.html)</span> package can be used to estimate the effect of 401(k) eligibility and participation on accumulated assets. The 401(k) data set has been analyzed in several studies, among others <span class="co">[</span><span class="ot">Chernozhukov et al. (2018)</span><span class="co">](https://arxiv.org/abs/1608.00060)</span>.</span>
<span id="cb82-448"><a href="#cb82-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-449"><a href="#cb82-449" aria-hidden="true" tabindex="-1"></a>401(k) plans are pension accounts sponsored by employers. The key problem in determining the effect of participation in 401(k) plans on accumulated assets is saver heterogeneity coupled with the fact that the decision to enroll in a 401(k) is non-random. It is generally recognized that some people have a higher preference for saving than others. It also seems likely that those individuals with high unobserved preference for saving would be most likely to choose to participate in tax-advantaged retirement savings plans and would tend to have otherwise high amounts of accumulated assets. The presence of unobserved savings preferences with these properties then implies that conventional estimates that do not account for saver heterogeneity and endogeneity of participation will be biased upward, tending to overstate the savings effects of 401(k) participation.</span>
<span id="cb82-450"><a href="#cb82-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-451"><a href="#cb82-451" aria-hidden="true" tabindex="-1"></a>One can argue that eligibility for enrolling in a 401(k) plan in this data can be taken as exogenous after conditioning on a few observables of which the most important for their argument is income. The basic idea is that, at least around the time 401(k)’s initially became available, people were unlikely to be basing their employment decisions on whether an employer offered a 401(k) but would instead focus on income and other aspects of the job.</span>
<span id="cb82-452"><a href="#cb82-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-453"><a href="#cb82-453" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup</span></span>
<span id="cb82-454"><a href="#cb82-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-455"><a href="#cb82-455" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb82-456"><a href="#cb82-456" aria-hidden="true" tabindex="-1"></a><span class="fu">## Install packages (run once)</span></span>
<span id="cb82-457"><a href="#cb82-457" aria-hidden="true" tabindex="-1"></a>If you are running this notebook for the first time, install these packages.  </span>
<span id="cb82-458"><a href="#cb82-458" aria-hidden="true" tabindex="-1"></a>This chunk is set to <span class="in">`eval: false`</span> so it will not run automatically when you render.</span>
<span id="cb82-459"><a href="#cb82-459" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb82-460"><a href="#cb82-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-461"><a href="#cb82-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb82-462"><a href="#cb82-462" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"remotes"</span>, <span class="st">"mlr3"</span>, <span class="st">"mlr3learners"</span>, <span class="st">"DoubleML"</span>, <span class="st">"glmnet"</span>, <span class="st">"ranger"</span>, <span class="st">"xgboost"</span>, <span class="st">"data.table"</span>))</span>
<span id="cb82-463"><a href="#cb82-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-464"><a href="#cb82-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-467"><a href="#cb82-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-468"><a href="#cb82-468" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(remotes)</span>
<span id="cb82-469"><a href="#cb82-469" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb82-470"><a href="#cb82-470" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb82-471"><a href="#cb82-471" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoubleML)</span>
<span id="cb82-472"><a href="#cb82-472" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb82-473"><a href="#cb82-473" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb82-474"><a href="#cb82-474" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb82-475"><a href="#cb82-475" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb82-476"><a href="#cb82-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-477"><a href="#cb82-477" aria-hidden="true" tabindex="-1"></a><span class="co"># suppress messages during fitting</span></span>
<span id="cb82-478"><a href="#cb82-478" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">"mlr3"</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">"warn"</span>)</span>
<span id="cb82-479"><a href="#cb82-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-480"><a href="#cb82-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-481"><a href="#cb82-481" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb82-482"><a href="#cb82-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-483"><a href="#cb82-483" aria-hidden="true" tabindex="-1"></a>The preprocessed data can be fetched by calling <span class="co">[</span><span class="ot">fetch_401k()</span><span class="co">](https://docs.doubleml.org/r/stable/reference/fetch_401k.html)</span>. The arguments <span class="in">`polynomial_features`</span> and <span class="in">`instrument`</span> can be used to replicate the models used in <span class="co">[</span><span class="ot">Chernozhukov et al. (2018)</span><span class="co">](https://arxiv.org/abs/1608.00060)</span>. Note that an internet connection is required for loading the data. We start with a baseline specification of the regression model and reload the data later in case we want to use another specification.</span>
<span id="cb82-484"><a href="#cb82-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-487"><a href="#cb82-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-488"><a href="#cb82-488" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data (instrument = TRUE is important for IIVM later)</span></span>
<span id="cb82-489"><a href="#cb82-489" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">fetch_401k</span>(<span class="at">return_type =</span> <span class="st">"data.table"</span>, <span class="at">instrument =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-490"><a href="#cb82-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-491"><a href="#cb82-491" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span>
<span id="cb82-492"><a href="#cb82-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-493"><a href="#cb82-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-494"><a href="#cb82-494" aria-hidden="true" tabindex="-1"></a>See the "Details" section on the description of the data set, which can be accessed by typing <span class="co">[</span><span class="ot">help(fetch_401k)</span><span class="co">](https://docs.doubleml.org/r/stable/reference/fetch_401k.html)</span>.</span>
<span id="cb82-495"><a href="#cb82-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-496"><a href="#cb82-496" aria-hidden="true" tabindex="-1"></a>We load the 401(k) dataset. We keep <span class="in">`instrument = TRUE`</span> because we will use **eligibility (`e401`)** as an instrument later in the IV model.</span>
<span id="cb82-497"><a href="#cb82-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-498"><a href="#cb82-498" aria-hidden="true" tabindex="-1"></a>The data consist of 9,915 observations at the household level drawn from the 1991 Survey of Income and Program Participation (SIPP).  All the variables are referred to 1990. We use net financial assets (*net_tfa*) as the outcome variable, $Y$,  in our analysis. The net financial assets are computed as the sum of IRA balances, 401(k) balances, checking accounts, saving bonds, other interest-earning accounts, other interest-earning assets, stocks, and mutual funds less non mortgage debts.</span>
<span id="cb82-499"><a href="#cb82-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-500"><a href="#cb82-500" aria-hidden="true" tabindex="-1"></a>Among the $9915$ individuals, $3682$ are eligible to participate in the program. The variable *e401* indicates eligibility and *p401* indicates participation, respectively.</span>
<span id="cb82-501"><a href="#cb82-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-502"><a href="#cb82-502" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quick EDA</span></span>
<span id="cb82-503"><a href="#cb82-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-504"><a href="#cb82-504" aria-hidden="true" tabindex="-1"></a>Eligibility and participation are binary variables.</span>
<span id="cb82-505"><a href="#cb82-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-506"><a href="#cb82-506" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`e401`</span>: eligible for 401(k)</span>
<span id="cb82-507"><a href="#cb82-507" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`p401`</span>: participates in 401(k)</span>
<span id="cb82-508"><a href="#cb82-508" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`net_tfa`</span>: net total financial assets (outcome)</span>
<span id="cb82-509"><a href="#cb82-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-510"><a href="#cb82-510" aria-hidden="true" tabindex="-1"></a><span class="fu">### Eligibility</span></span>
<span id="cb82-511"><a href="#cb82-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-514"><a href="#cb82-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-515"><a href="#cb82-515" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> e401, <span class="at">fill =</span> <span class="fu">factor</span>(e401))) <span class="sc">+</span></span>
<span id="cb82-516"><a href="#cb82-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb82-517"><a href="#cb82-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb82-518"><a href="#cb82-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Eligibility, 401(k)"</span>) <span class="sc">+</span></span>
<span id="cb82-519"><a href="#cb82-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb82-520"><a href="#cb82-520" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb82-521"><a href="#cb82-521" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb82-522"><a href="#cb82-522" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb82-523"><a href="#cb82-523" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-524"><a href="#cb82-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-525"><a href="#cb82-525" aria-hidden="true" tabindex="-1"></a><span class="fu">### Participation</span></span>
<span id="cb82-526"><a href="#cb82-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-527"><a href="#cb82-527" aria-hidden="true" tabindex="-1"></a>Participation is a choice, so this plot often reflects selection. People who participate may differ systematically (income, job type, financial literacy etc.). So, the raw difference between participants and non-participants is not causal.</span>
<span id="cb82-528"><a href="#cb82-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-531"><a href="#cb82-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-532"><a href="#cb82-532" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> p401, <span class="at">fill =</span> <span class="fu">factor</span>(p401))) <span class="sc">+</span></span>
<span id="cb82-533"><a href="#cb82-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb82-534"><a href="#cb82-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb82-535"><a href="#cb82-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Participation, 401(k)"</span>) <span class="sc">+</span></span>
<span id="cb82-536"><a href="#cb82-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb82-537"><a href="#cb82-537" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb82-538"><a href="#cb82-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb82-539"><a href="#cb82-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb82-540"><a href="#cb82-540" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-541"><a href="#cb82-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-542"><a href="#cb82-542" aria-hidden="true" tabindex="-1"></a><span class="fu">### Outcome distribution by eligibility</span></span>
<span id="cb82-543"><a href="#cb82-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-544"><a href="#cb82-544" aria-hidden="true" tabindex="-1"></a>Eligibility is highly associated with financial wealth: but eligibility is not randomly assigned in real life (it’s tied to employer/plan rules), so we still need to adjust for covariates. The density plot motivates the causal question, but doesn’t answer it.</span>
<span id="cb82-545"><a href="#cb82-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-548"><a href="#cb82-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-549"><a href="#cb82-549" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> net_tfa, <span class="at">color =</span> <span class="fu">factor</span>(e401), <span class="at">fill =</span> <span class="fu">factor</span>(e401))) <span class="sc">+</span></span>
<span id="cb82-550"><a href="#cb82-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb82-551"><a href="#cb82-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">20000</span>, <span class="dv">150000</span>)) <span class="sc">+</span></span>
<span id="cb82-552"><a href="#cb82-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> e401) <span class="sc">+</span></span>
<span id="cb82-553"><a href="#cb82-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb82-554"><a href="#cb82-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb82-555"><a href="#cb82-555" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb82-556"><a href="#cb82-556" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb82-557"><a href="#cb82-557" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-558"><a href="#cb82-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-559"><a href="#cb82-559" aria-hidden="true" tabindex="-1"></a><span class="fu">## A simple baseline: unconditional mean differences</span></span>
<span id="cb82-560"><a href="#cb82-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-561"><a href="#cb82-561" aria-hidden="true" tabindex="-1"></a>Before using DML, it is helpful to see the *raw difference* in average outcomes.</span>
<span id="cb82-562"><a href="#cb82-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-563"><a href="#cb82-563" aria-hidden="true" tabindex="-1"></a>As a first estimate, we calculate the unconditional average predictive effect (APE) of 401(k) eligibility on accumulated assets. This effect corresponds to the average treatment effect if 401(k) eligibility would be assigned to individuals in an entirely randomized way. </span>
<span id="cb82-564"><a href="#cb82-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-567"><a href="#cb82-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-568"><a href="#cb82-568" aria-hidden="true" tabindex="-1"></a>APE_e401_uncond <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb82-569"><a href="#cb82-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(e401) <span class="sc">|&gt;</span></span>
<span id="cb82-570"><a href="#cb82-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_net_tfa =</span> <span class="fu">mean</span>(net_tfa), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-571"><a href="#cb82-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(e401) <span class="sc">|&gt;</span></span>
<span id="cb82-572"><a href="#cb82-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff =</span> mean_net_tfa[e401 <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> mean_net_tfa[e401 <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">|&gt;</span></span>
<span id="cb82-573"><a href="#cb82-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(diff)</span>
<span id="cb82-574"><a href="#cb82-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-575"><a href="#cb82-575" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(APE_e401_uncond, <span class="dv">2</span>)</span>
<span id="cb82-576"><a href="#cb82-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-577"><a href="#cb82-577" aria-hidden="true" tabindex="-1"></a>The unconditional APE of e401 is about $19559$.</span>
<span id="cb82-578"><a href="#cb82-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-579"><a href="#cb82-579" aria-hidden="true" tabindex="-1"></a>Among the $3682$ individuals that  are eligible, $2594$ decided to participate in the program. The unconditional APE of p401 is about $27372$:</span>
<span id="cb82-580"><a href="#cb82-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-583"><a href="#cb82-583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-584"><a href="#cb82-584" aria-hidden="true" tabindex="-1"></a>APE_p401_uncond <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb82-585"><a href="#cb82-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(p401) <span class="sc">|&gt;</span></span>
<span id="cb82-586"><a href="#cb82-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_net_tfa =</span> <span class="fu">mean</span>(net_tfa), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-587"><a href="#cb82-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(p401) <span class="sc">|&gt;</span></span>
<span id="cb82-588"><a href="#cb82-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff =</span> mean_net_tfa[p401 <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> mean_net_tfa[p401 <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">|&gt;</span></span>
<span id="cb82-589"><a href="#cb82-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(diff)</span>
<span id="cb82-590"><a href="#cb82-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-591"><a href="#cb82-591" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(APE_p401_uncond, <span class="dv">2</span>)</span>
<span id="cb82-592"><a href="#cb82-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-593"><a href="#cb82-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-594"><a href="#cb82-594" aria-hidden="true" tabindex="-1"></a>These raw differences are not causal. They ignore differences in age, income, education, and other confounders. It mixes treatment effects with differences in who ends up eligible/participating</span>
<span id="cb82-595"><a href="#cb82-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-596"><a href="#cb82-596" aria-hidden="true" tabindex="-1"></a><span class="fu">## The `DoubleML` package: Estimating the Average Treatment Effect of 401(k) Eligibility on Net Financial Assets</span></span>
<span id="cb82-597"><a href="#cb82-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-598"><a href="#cb82-598" aria-hidden="true" tabindex="-1"></a>Let's use the package <span class="co">[</span><span class="ot">DoubleML</span><span class="co">](https://docs.doubleml.org/stable/index.html)</span> to estimate the average treatment effect of 401(k) eligibility, i.e. <span class="in">`e401`</span>, and participation, i.e. <span class="in">`p401`</span>, on net financial assets <span class="in">`net_tfa`</span>.</span>
<span id="cb82-599"><a href="#cb82-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-600"><a href="#cb82-600" aria-hidden="true" tabindex="-1"></a>We first look at the treatment effect of <span class="in">`e401`</span> on net total financial assets. We give estimates of the ATE in the linear model</span>
<span id="cb82-601"><a href="#cb82-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-602"><a href="#cb82-602" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-603"><a href="#cb82-603" aria-hidden="true" tabindex="-1"></a>\begin{equation*}</span>
<span id="cb82-604"><a href="#cb82-604" aria-hidden="true" tabindex="-1"></a>Y = D \alpha + f(X)'\beta+ \epsilon,</span>
<span id="cb82-605"><a href="#cb82-605" aria-hidden="true" tabindex="-1"></a>\end{equation*}</span>
<span id="cb82-606"><a href="#cb82-606" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-607"><a href="#cb82-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-608"><a href="#cb82-608" aria-hidden="true" tabindex="-1"></a>where $f(X)$ is a dictonary applied to the raw regressors. $X$ contains variables on marital status, two-earner status, defined benefit pension status, IRA participation, home ownership, family size, education, age, and income.</span>
<span id="cb82-609"><a href="#cb82-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-610"><a href="#cb82-610" aria-hidden="true" tabindex="-1"></a>In the following, we will consider two different models,</span>
<span id="cb82-611"><a href="#cb82-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-612"><a href="#cb82-612" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a basic model specification that includes the raw regressors, i.e., $f(X) = X$, and</span>
<span id="cb82-613"><a href="#cb82-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-614"><a href="#cb82-614" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a flexible model specification, where $f(X)$ includes the raw regressors $X$ and the orthogonal polynomials of degree 2 for the variables family size education, age, and income.</span>
<span id="cb82-615"><a href="#cb82-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-616"><a href="#cb82-616" aria-hidden="true" tabindex="-1"></a>We will use the basic model specification whenever we use nonlinear methods, for example regression trees or random forests, and use the flexible model for linear methods such as the lasso. There are, of course, multiple ways how the model can be specified even more flexibly, for example including interactions of variable and higher order interaction. However, for the sake of simplicity we stick to the specification above. Users who are interested in varying the model can manipulate the model formula below (<span class="in">`formula_flex`</span>), for example implementing the orignal specification in <span class="co">[</span><span class="ot">Chernozhukov et al. (2018)</span><span class="co">](https://arxiv.org/abs/1608.00060)</span>.</span>
<span id="cb82-617"><a href="#cb82-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-618"><a href="#cb82-618" aria-hidden="true" tabindex="-1"></a>In the first step, we report estimates of the average treatment effect (ATE) of 401(k) eligibility on net financial assets both in the partially linear regression (PLR) model and in the interactive regression model (IRM) allowing for heterogeneous treatment effects.</span>
<span id="cb82-619"><a href="#cb82-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-620"><a href="#cb82-620" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Data Backend: `DoubleMLData`</span></span>
<span id="cb82-621"><a href="#cb82-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-622"><a href="#cb82-622" aria-hidden="true" tabindex="-1"></a>To start our analysis, we initialize the data backend, i.e., a new instance of a <span class="co">[</span><span class="ot">DoubleMLData</span><span class="co">](https://docs.doubleml.org/r/stable/reference/DoubleMLData.html)</span> object. Here, we manually implement the regression model by using R's formula interface. A shortcut would be to directly specify the options <span class="in">`polynomial_features`</span> and <span class="in">`instrument`</span> when calling <span class="co">[</span><span class="ot">fetch_401k()</span><span class="co">](https://docs.doubleml.org/r/stable/reference/fetch_401k.html)</span>.$^{**}$</span>
<span id="cb82-623"><a href="#cb82-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-624"><a href="#cb82-624" aria-hidden="true" tabindex="-1"></a>To implement both models (basic and flexible), we generate two data backends: <span class="in">`data_dml_base`</span> and <span class="in">`data_dml_flex`</span>.</span>
<span id="cb82-625"><a href="#cb82-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-626"><a href="#cb82-626" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Base controls** (simple)</span>
<span id="cb82-627"><a href="#cb82-627" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Flexible controls** (polynomials + richer feature space)</span>
<span id="cb82-628"><a href="#cb82-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-629"><a href="#cb82-629" aria-hidden="true" tabindex="-1"></a>DoubleML uses a <span class="in">`DoubleMLData`</span> object to store:</span>
<span id="cb82-630"><a href="#cb82-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-631"><a href="#cb82-631" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>outcome column (<span class="in">`y_col`</span>)</span>
<span id="cb82-632"><a href="#cb82-632" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>treatment column (<span class="in">`d_cols`</span>)</span>
<span id="cb82-633"><a href="#cb82-633" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>control columns (<span class="in">`x_cols`</span>)</span>
<span id="cb82-634"><a href="#cb82-634" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>(optionally) instrument column (<span class="in">`z_cols`</span>)</span>
<span id="cb82-635"><a href="#cb82-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-636"><a href="#cb82-636" aria-hidden="true" tabindex="-1"></a><span class="fu">## Base controls</span></span>
<span id="cb82-637"><a href="#cb82-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-640"><a href="#cb82-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-641"><a href="#cb82-641" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up basic model: Specify variables for data-backend</span></span>
<span id="cb82-642"><a href="#cb82-642" aria-hidden="true" tabindex="-1"></a>features_base <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"inc"</span>, <span class="st">"educ"</span>, <span class="st">"fsize"</span>,</span>
<span id="cb82-643"><a href="#cb82-643" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"marr"</span>, <span class="st">"twoearn"</span>, <span class="st">"db"</span>, <span class="st">"pira"</span>, <span class="st">"hown"</span>)</span>
<span id="cb82-644"><a href="#cb82-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-645"><a href="#cb82-645" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLData (data-backend of DoubleML)</span></span>
<span id="cb82-646"><a href="#cb82-646" aria-hidden="true" tabindex="-1"></a>data_dml_base <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(data,</span>
<span id="cb82-647"><a href="#cb82-647" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y_col =</span> <span class="st">"net_tfa"</span>,</span>
<span id="cb82-648"><a href="#cb82-648" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">d_cols =</span> <span class="st">"e401"</span>,</span>
<span id="cb82-649"><a href="#cb82-649" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x_cols =</span> features_base)</span>
<span id="cb82-650"><a href="#cb82-650" aria-hidden="true" tabindex="-1"></a>data_dml_base</span>
<span id="cb82-651"><a href="#cb82-651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-652"><a href="#cb82-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-653"><a href="#cb82-653" aria-hidden="true" tabindex="-1"></a><span class="fu">## Flexible controls</span></span>
<span id="cb82-654"><a href="#cb82-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-655"><a href="#cb82-655" aria-hidden="true" tabindex="-1"></a>We build polynomial terms using <span class="in">`model.matrix()`</span> and convert them to a tibble.</span>
<span id="cb82-656"><a href="#cb82-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-659"><a href="#cb82-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-660"><a href="#cb82-660" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a model according to regression formula with polynomials</span></span>
<span id="cb82-661"><a href="#cb82-661" aria-hidden="true" tabindex="-1"></a>formula_flex <span class="ot">=</span> <span class="fu">formula</span>(<span class="st">" ~ -1 + poly(age, 2, raw=TRUE) +</span></span>
<span id="cb82-662"><a href="#cb82-662" aria-hidden="true" tabindex="-1"></a><span class="st">                        poly(inc, 2, raw=TRUE) + poly(educ, 2, raw=TRUE) +</span></span>
<span id="cb82-663"><a href="#cb82-663" aria-hidden="true" tabindex="-1"></a><span class="st">                        poly(fsize, 2, raw=TRUE) + marr + twoearn +</span></span>
<span id="cb82-664"><a href="#cb82-664" aria-hidden="true" tabindex="-1"></a><span class="st">                        db + pira + hown"</span>)</span>
<span id="cb82-665"><a href="#cb82-665" aria-hidden="true" tabindex="-1"></a>features_flex <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">model.matrix</span>(formula_flex, data))</span>
<span id="cb82-666"><a href="#cb82-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-667"><a href="#cb82-667" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">=</span> <span class="fu">data.table</span>(<span class="st">"net_tfa"</span> <span class="ot">=</span> data[, net_tfa],</span>
<span id="cb82-668"><a href="#cb82-668" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"e401"</span> <span class="ot">=</span> data[, e401],</span>
<span id="cb82-669"><a href="#cb82-669" aria-hidden="true" tabindex="-1"></a>                        features_flex)</span>
<span id="cb82-670"><a href="#cb82-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-671"><a href="#cb82-671" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLData (data-backend of DoubleML)</span></span>
<span id="cb82-672"><a href="#cb82-672" aria-hidden="true" tabindex="-1"></a>data_dml_flex <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(model_data,</span>
<span id="cb82-673"><a href="#cb82-673" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y_col =</span> <span class="st">"net_tfa"</span>,</span>
<span id="cb82-674"><a href="#cb82-674" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">d_cols =</span> <span class="st">"e401"</span>)</span>
<span id="cb82-675"><a href="#cb82-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-676"><a href="#cb82-676" aria-hidden="true" tabindex="-1"></a>data_dml_flex</span>
<span id="cb82-677"><a href="#cb82-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-678"><a href="#cb82-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-679"><a href="#cb82-679" aria-hidden="true" tabindex="-1"></a><span class="fu">## Partially Linear Regression Model (PLR)</span></span>
<span id="cb82-680"><a href="#cb82-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-681"><a href="#cb82-681" aria-hidden="true" tabindex="-1"></a>**Goal:** estimate the effect of **eligibility (`e401`)** on **net financial assets (`net_tfa`)**.</span>
<span id="cb82-682"><a href="#cb82-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-683"><a href="#cb82-683" aria-hidden="true" tabindex="-1"></a>We start using lasso to estimate the function $g_0$ and $m_0$ in the following PLR model: </span>
<span id="cb82-684"><a href="#cb82-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-685"><a href="#cb82-685" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-686"><a href="#cb82-686" aria-hidden="true" tabindex="-1"></a>\begin{eqnarray}</span>
<span id="cb82-687"><a href="#cb82-687" aria-hidden="true" tabindex="-1"></a>&amp; Y = D\theta_0 + g_0(X) + \zeta, &amp;\quad E<span class="co">[</span><span class="ot">\zeta \mid D,X</span><span class="co">]</span>= 0,<span class="sc">\\</span></span>
<span id="cb82-688"><a href="#cb82-688" aria-hidden="true" tabindex="-1"></a>&amp; D = m_0(X) +  V, &amp;\quad E<span class="co">[</span><span class="ot">V \mid X</span><span class="co">]</span> = 0.</span>
<span id="cb82-689"><a href="#cb82-689" aria-hidden="true" tabindex="-1"></a>\end{eqnarray}</span>
<span id="cb82-690"><a href="#cb82-690" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-691"><a href="#cb82-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-692"><a href="#cb82-692" aria-hidden="true" tabindex="-1"></a>To estimate the causal parameter $\theta_0$ here, we use double machine learning with 3-fold cross-fitting.</span>
<span id="cb82-693"><a href="#cb82-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-694"><a href="#cb82-694" aria-hidden="true" tabindex="-1"></a>Estimation of the nuisance components $g_0$ and $m_0$, is based on the lasso with cross-validated choice of the penalty term , $\lambda$, as provided by the <span class="co">[</span><span class="ot">glmnet package</span><span class="co">](https://glmnet.stanford.edu/reference/cv.glmnet.html)</span>. We load the learner by using the <span class="co">[</span><span class="ot">mlr3</span><span class="co">](https://mlr3.mlr-org.com/)</span> function <span class="co">[</span><span class="ot">lrn()</span><span class="co">](https://mlr3.mlr-org.com/reference/Learner.html)</span>. Hyperparameters and options can be set during instantiation of the learner. Here we specify that the lasso should use that value of $\lambda$ that minimizes the cross-validated mean squared error which is based on 5-fold cross validation.</span>
<span id="cb82-695"><a href="#cb82-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-696"><a href="#cb82-696" aria-hidden="true" tabindex="-1"></a>In order to use a learner, the underlying R packages have to be installed. In this case, the package <span class="co">[</span><span class="ot">glmnet package</span><span class="co">](https://glmnet.stanford.edu/reference/cv.glmnet.html)</span> needs to be installed. Moreover, installation of the package <span class="co">[</span><span class="ot">mlr3learners</span><span class="co">](https://mlr3learners.mlr-org.com/)</span> is required.</span>
<span id="cb82-697"><a href="#cb82-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-698"><a href="#cb82-698" aria-hidden="true" tabindex="-1"></a>We start by estimation the ATE in the basic model and then repeat the estimation in the flexible model.</span>
<span id="cb82-699"><a href="#cb82-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-700"><a href="#cb82-700" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learners</span></span>
<span id="cb82-701"><a href="#cb82-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-702"><a href="#cb82-702" aria-hidden="true" tabindex="-1"></a>We define the ML learners used for nuisance functions.</span>
<span id="cb82-703"><a href="#cb82-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-706"><a href="#cb82-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-707"><a href="#cb82-707" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-708"><a href="#cb82-708" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.cv_glmnet"</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb82-709"><a href="#cb82-709" aria-hidden="true" tabindex="-1"></a>lasso_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.cv_glmnet"</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb82-710"><a href="#cb82-710" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-711"><a href="#cb82-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-712"><a href="#cb82-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-713"><a href="#cb82-713" aria-hidden="true" tabindex="-1"></a><span class="fu">### PLR with Lasso (base)</span></span>
<span id="cb82-714"><a href="#cb82-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-717"><a href="#cb82-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-718"><a href="#cb82-718" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso_base <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb82-719"><a href="#cb82-719" aria-hidden="true" tabindex="-1"></a>  data_dml_base,</span>
<span id="cb82-720"><a href="#cb82-720" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> lasso,</span>
<span id="cb82-721"><a href="#cb82-721" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> lasso_class,</span>
<span id="cb82-722"><a href="#cb82-722" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb82-723"><a href="#cb82-723" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-724"><a href="#cb82-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-725"><a href="#cb82-725" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso_base<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-726"><a href="#cb82-726" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso_base<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-727"><a href="#cb82-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-728"><a href="#cb82-728" aria-hidden="true" tabindex="-1"></a><span class="fu">### PLR with Lasso (flex)</span></span>
<span id="cb82-729"><a href="#cb82-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-732"><a href="#cb82-732" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-733"><a href="#cb82-733" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-734"><a href="#cb82-734" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.cv_glmnet"</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb82-735"><a href="#cb82-735" aria-hidden="true" tabindex="-1"></a>lasso_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.cv_glmnet"</span>, <span class="at">nfolds =</span> <span class="dv">5</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb82-736"><a href="#cb82-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-737"><a href="#cb82-737" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb82-738"><a href="#cb82-738" aria-hidden="true" tabindex="-1"></a>  data_dml_flex,</span>
<span id="cb82-739"><a href="#cb82-739" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> lasso,</span>
<span id="cb82-740"><a href="#cb82-740" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> lasso_class,</span>
<span id="cb82-741"><a href="#cb82-741" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb82-742"><a href="#cb82-742" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-743"><a href="#cb82-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-744"><a href="#cb82-744" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-745"><a href="#cb82-745" aria-hidden="true" tabindex="-1"></a>dml_plr_lasso<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-746"><a href="#cb82-746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-747"><a href="#cb82-747" aria-hidden="true" tabindex="-1"></a>Alternatively, we can repeat this procedure with other machine learning methods, for example a random forest learner as provided by the <span class="co">[</span><span class="ot">ranger</span><span class="co">](https://github.com/imbs-hl/ranger)</span> package for R. The website of the <span class="co">[</span><span class="ot">mlr3extralearners</span><span class="co">](https://mlr3extralearners.mlr-org.com/articles/learners/list_learners.html)</span> package has a searchable list of all learners that are available in the <span class="co">[</span><span class="ot">mlr3verse</span><span class="co">](https://mlr3verse.mlr-org.com/)</span>.</span>
<span id="cb82-748"><a href="#cb82-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-749"><a href="#cb82-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-750"><a href="#cb82-750" aria-hidden="true" tabindex="-1"></a><span class="fu">### PLR with Random Forest</span></span>
<span id="cb82-751"><a href="#cb82-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-754"><a href="#cb82-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-755"><a href="#cb82-755" aria-hidden="true" tabindex="-1"></a>randomForest <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">max.depth =</span> <span class="dv">7</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">3</span>)</span>
<span id="cb82-756"><a href="#cb82-756" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">max.depth =</span> <span class="dv">5</span>, <span class="at">mtry =</span> <span class="dv">4</span>, <span class="at">min.node.size =</span> <span class="dv">7</span>)</span>
<span id="cb82-757"><a href="#cb82-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-758"><a href="#cb82-758" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-759"><a href="#cb82-759" aria-hidden="true" tabindex="-1"></a>dml_plr_forest <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb82-760"><a href="#cb82-760" aria-hidden="true" tabindex="-1"></a>  data_dml_base,</span>
<span id="cb82-761"><a href="#cb82-761" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> randomForest,</span>
<span id="cb82-762"><a href="#cb82-762" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> randomForest_class,</span>
<span id="cb82-763"><a href="#cb82-763" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb82-764"><a href="#cb82-764" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-765"><a href="#cb82-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-766"><a href="#cb82-766" aria-hidden="true" tabindex="-1"></a>dml_plr_forest<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-767"><a href="#cb82-767" aria-hidden="true" tabindex="-1"></a>dml_plr_forest<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-768"><a href="#cb82-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-769"><a href="#cb82-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-770"><a href="#cb82-770" aria-hidden="true" tabindex="-1"></a><span class="fu">### PLR with Trees</span></span>
<span id="cb82-771"><a href="#cb82-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-772"><a href="#cb82-772" aria-hidden="true" tabindex="-1"></a>Now, let's use a regression tree as provided by the R package <span class="co">[</span><span class="ot">rpart</span><span class="co">](https://github.com/bethatkinson/rpart)</span>.</span>
<span id="cb82-773"><a href="#cb82-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-776"><a href="#cb82-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-777"><a href="#cb82-777" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">cp =</span> <span class="fl">0.0047</span>, <span class="at">minsplit =</span> <span class="dv">203</span>)</span>
<span id="cb82-778"><a href="#cb82-778" aria-hidden="true" tabindex="-1"></a>trees_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">cp =</span> <span class="fl">0.0042</span>, <span class="at">minsplit =</span> <span class="dv">104</span>)</span>
<span id="cb82-779"><a href="#cb82-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-780"><a href="#cb82-780" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-781"><a href="#cb82-781" aria-hidden="true" tabindex="-1"></a>dml_plr_tree <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb82-782"><a href="#cb82-782" aria-hidden="true" tabindex="-1"></a>  data_dml_base,</span>
<span id="cb82-783"><a href="#cb82-783" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> trees,</span>
<span id="cb82-784"><a href="#cb82-784" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> trees_class,</span>
<span id="cb82-785"><a href="#cb82-785" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb82-786"><a href="#cb82-786" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-787"><a href="#cb82-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-788"><a href="#cb82-788" aria-hidden="true" tabindex="-1"></a>dml_plr_tree<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-789"><a href="#cb82-789" aria-hidden="true" tabindex="-1"></a>dml_plr_tree<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-790"><a href="#cb82-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-791"><a href="#cb82-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-792"><a href="#cb82-792" aria-hidden="true" tabindex="-1"></a><span class="fu">### PLR with Boosted Trees</span></span>
<span id="cb82-793"><a href="#cb82-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-794"><a href="#cb82-794" aria-hidden="true" tabindex="-1"></a>We can also experiment with extreme gradient boosting as provided by <span class="co">[</span><span class="ot">xgboost</span><span class="co">](https://xgboost.readthedocs.io/en/latest/)</span>.</span>
<span id="cb82-795"><a href="#cb82-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-798"><a href="#cb82-798" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-799"><a href="#cb82-799" aria-hidden="true" tabindex="-1"></a>boost <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.xgboost"</span>,</span>
<span id="cb82-800"><a href="#cb82-800" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>,</span>
<span id="cb82-801"><a href="#cb82-801" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">nrounds =</span> <span class="dv">35</span></span>
<span id="cb82-802"><a href="#cb82-802" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-803"><a href="#cb82-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-804"><a href="#cb82-804" aria-hidden="true" tabindex="-1"></a>boost_class <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>,</span>
<span id="cb82-805"><a href="#cb82-805" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb82-806"><a href="#cb82-806" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"logloss"</span>,</span>
<span id="cb82-807"><a href="#cb82-807" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">nrounds =</span> <span class="dv">34</span></span>
<span id="cb82-808"><a href="#cb82-808" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-809"><a href="#cb82-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-810"><a href="#cb82-810" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-811"><a href="#cb82-811" aria-hidden="true" tabindex="-1"></a>dml_plr_boost <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb82-812"><a href="#cb82-812" aria-hidden="true" tabindex="-1"></a>  data_dml_base,</span>
<span id="cb82-813"><a href="#cb82-813" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> boost,</span>
<span id="cb82-814"><a href="#cb82-814" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> boost_class,</span>
<span id="cb82-815"><a href="#cb82-815" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb82-816"><a href="#cb82-816" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-817"><a href="#cb82-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-818"><a href="#cb82-818" aria-hidden="true" tabindex="-1"></a>dml_plr_boost<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-819"><a href="#cb82-819" aria-hidden="true" tabindex="-1"></a>dml_plr_boost<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-820"><a href="#cb82-820" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-821"><a href="#cb82-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-822"><a href="#cb82-822" aria-hidden="true" tabindex="-1"></a><span class="fu">## PLR results summary</span></span>
<span id="cb82-823"><a href="#cb82-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-824"><a href="#cb82-824" aria-hidden="true" tabindex="-1"></a>Let's sum up the results:</span>
<span id="cb82-825"><a href="#cb82-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-828"><a href="#cb82-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-829"><a href="#cb82-829" aria-hidden="true" tabindex="-1"></a>confints_plr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb82-830"><a href="#cb82-830" aria-hidden="true" tabindex="-1"></a>  dml_plr_lasso<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-831"><a href="#cb82-831" aria-hidden="true" tabindex="-1"></a>  dml_plr_forest<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-832"><a href="#cb82-832" aria-hidden="true" tabindex="-1"></a>  dml_plr_tree<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-833"><a href="#cb82-833" aria-hidden="true" tabindex="-1"></a>  dml_plr_boost<span class="sc">$</span><span class="fu">confint</span>()</span>
<span id="cb82-834"><a href="#cb82-834" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-835"><a href="#cb82-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-836"><a href="#cb82-836" aria-hidden="true" tabindex="-1"></a>estimates_plr <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb82-837"><a href="#cb82-837" aria-hidden="true" tabindex="-1"></a>  dml_plr_lasso<span class="sc">$</span>coef,</span>
<span id="cb82-838"><a href="#cb82-838" aria-hidden="true" tabindex="-1"></a>  dml_plr_forest<span class="sc">$</span>coef,</span>
<span id="cb82-839"><a href="#cb82-839" aria-hidden="true" tabindex="-1"></a>  dml_plr_tree<span class="sc">$</span>coef,</span>
<span id="cb82-840"><a href="#cb82-840" aria-hidden="true" tabindex="-1"></a>  dml_plr_boost<span class="sc">$</span>coef</span>
<span id="cb82-841"><a href="#cb82-841" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-842"><a href="#cb82-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-843"><a href="#cb82-843" aria-hidden="true" tabindex="-1"></a>result_plr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-844"><a href="#cb82-844" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"PLR"</span>,</span>
<span id="cb82-845"><a href="#cb82-845" aria-hidden="true" tabindex="-1"></a>  <span class="at">ML =</span> <span class="fu">c</span>(<span class="st">"lasso"</span>, <span class="st">"random forest"</span>, <span class="st">"decision tree"</span>, <span class="st">"xgboost"</span>),</span>
<span id="cb82-846"><a href="#cb82-846" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> estimates_plr,</span>
<span id="cb82-847"><a href="#cb82-847" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> confints_plr[, <span class="dv">1</span>],</span>
<span id="cb82-848"><a href="#cb82-848" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> confints_plr[, <span class="dv">2</span>]</span>
<span id="cb82-849"><a href="#cb82-849" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-850"><a href="#cb82-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-851"><a href="#cb82-851" aria-hidden="true" tabindex="-1"></a>result_plr</span>
<span id="cb82-852"><a href="#cb82-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-853"><a href="#cb82-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-856"><a href="#cb82-856" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-857"><a href="#cb82-857" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(result_plr, <span class="fu">aes</span>(<span class="at">x =</span> ML, <span class="at">y =</span> Estimate, <span class="at">color =</span> ML)) <span class="sc">+</span></span>
<span id="cb82-858"><a href="#cb82-858" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-859"><a href="#cb82-859" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> ML))  <span class="sc">+</span></span>
<span id="cb82-860"><a href="#cb82-860" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb82-861"><a href="#cb82-861" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Coefficients and 0.95- confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb82-862"><a href="#cb82-862" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb82-863"><a href="#cb82-863" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb82-864"><a href="#cb82-864" aria-hidden="true" tabindex="-1"></a>              <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb82-865"><a href="#cb82-865" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-866"><a href="#cb82-866" aria-hidden="true" tabindex="-1"></a>*Note: Why use flex for Lasso but often base for trees/boosting?* </span>
<span id="cb82-867"><a href="#cb82-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-868"><a href="#cb82-868" aria-hidden="true" tabindex="-1"></a>Lasso / linear models</span>
<span id="cb82-869"><a href="#cb82-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-870"><a href="#cb82-870" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lasso is still a linear model in the features.</span>
<span id="cb82-871"><a href="#cb82-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-872"><a href="#cb82-872" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If the real relationship is nonlinear, you need to create nonlinear features (like squared terms) so the linear model can represent curvature.</span>
<span id="cb82-873"><a href="#cb82-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-874"><a href="#cb82-874" aria-hidden="true" tabindex="-1"></a>Random forests / trees / boosting</span>
<span id="cb82-875"><a href="#cb82-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-876"><a href="#cb82-876" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These learners are already nonlinear and naturally capture interactions.</span>
<span id="cb82-877"><a href="#cb82-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-878"><a href="#cb82-878" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Feeding them lots of hand-made polynomial terms often:</span>
<span id="cb82-879"><a href="#cb82-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-880"><a href="#cb82-880" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>adds redundancy</span>
<span id="cb82-881"><a href="#cb82-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-882"><a href="#cb82-882" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>increases noise/complexity</span>
<span id="cb82-883"><a href="#cb82-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-884"><a href="#cb82-884" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>doesn’t help much (and can hurt)</span>
<span id="cb82-885"><a href="#cb82-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-886"><a href="#cb82-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-887"><a href="#cb82-887" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactive Regression Model (IRM)</span></span>
<span id="cb82-888"><a href="#cb82-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-889"><a href="#cb82-889" aria-hidden="true" tabindex="-1"></a>**Goal:** estimate the effect of eligibility (<span class="in">`e401`</span>) allowing for more flexible outcome models across treated/untreated groups.</span>
<span id="cb82-890"><a href="#cb82-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-891"><a href="#cb82-891" aria-hidden="true" tabindex="-1"></a>Next, we consider estimation of average treatment effects when treatment effects are fully heterogeneous:</span>
<span id="cb82-892"><a href="#cb82-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-893"><a href="#cb82-893" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-894"><a href="#cb82-894" aria-hidden="true" tabindex="-1"></a>\begin{eqnarray}</span>
<span id="cb82-895"><a href="#cb82-895" aria-hidden="true" tabindex="-1"></a>&amp; Y = g_0(D,X) + U, &amp;\quad E<span class="co">[</span><span class="ot">U\mid X,D</span><span class="co">]</span> = 0,<span class="sc">\\</span></span>
<span id="cb82-896"><a href="#cb82-896" aria-hidden="true" tabindex="-1"></a>&amp; D = m_0(X) + V, &amp;\quad E<span class="co">[</span><span class="ot">V\mid X</span><span class="co">]</span> = 0.</span>
<span id="cb82-897"><a href="#cb82-897" aria-hidden="true" tabindex="-1"></a>\end{eqnarray}</span>
<span id="cb82-898"><a href="#cb82-898" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-899"><a href="#cb82-899" aria-hidden="true" tabindex="-1"></a>To reduce the disproportionate impact of extreme propensity score weights in the interactive model, we trim the propensity scores which are close to the bounds.</span>
<span id="cb82-900"><a href="#cb82-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-901"><a href="#cb82-901" aria-hidden="true" tabindex="-1"></a><span class="fu">### IRM with Lasso (flex)</span></span>
<span id="cb82-902"><a href="#cb82-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-905"><a href="#cb82-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-906"><a href="#cb82-906" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-907"><a href="#cb82-907" aria-hidden="true" tabindex="-1"></a>dml_irm_lasso <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb82-908"><a href="#cb82-908" aria-hidden="true" tabindex="-1"></a>  data_dml_flex,</span>
<span id="cb82-909"><a href="#cb82-909" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_g =</span> lasso,</span>
<span id="cb82-910"><a href="#cb82-910" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> lasso_class,</span>
<span id="cb82-911"><a href="#cb82-911" aria-hidden="true" tabindex="-1"></a>  <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb82-912"><a href="#cb82-912" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb82-913"><a href="#cb82-913" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-914"><a href="#cb82-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-915"><a href="#cb82-915" aria-hidden="true" tabindex="-1"></a>dml_irm_lasso<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-916"><a href="#cb82-916" aria-hidden="true" tabindex="-1"></a>dml_irm_lasso<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-917"><a href="#cb82-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-918"><a href="#cb82-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-919"><a href="#cb82-919" aria-hidden="true" tabindex="-1"></a><span class="fu">### IRM with Random Forest</span></span>
<span id="cb82-920"><a href="#cb82-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-923"><a href="#cb82-923" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-924"><a href="#cb82-924" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb82-925"><a href="#cb82-925" aria-hidden="true" tabindex="-1"></a>randomForest <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>)</span>
<span id="cb82-926"><a href="#cb82-926" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>)</span>
<span id="cb82-927"><a href="#cb82-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-928"><a href="#cb82-928" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb82-929"><a href="#cb82-929" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-930"><a href="#cb82-930" aria-hidden="true" tabindex="-1"></a>dml_irm_forest <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_dml_base,</span>
<span id="cb82-931"><a href="#cb82-931" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_g =</span> randomForest,</span>
<span id="cb82-932"><a href="#cb82-932" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_m =</span> randomForest_class,</span>
<span id="cb82-933"><a href="#cb82-933" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb82-934"><a href="#cb82-934" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">n_folds =</span> <span class="dv">3</span>)</span>
<span id="cb82-935"><a href="#cb82-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-936"><a href="#cb82-936" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb82-937"><a href="#cb82-937" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-938"><a href="#cb82-938" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g0"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">4</span>, <span class="at">min.node.size =</span> <span class="dv">7</span>))</span>
<span id="cb82-939"><a href="#cb82-939" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-940"><a href="#cb82-940" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g1"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">5</span>))</span>
<span id="cb82-941"><a href="#cb82-941" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-942"><a href="#cb82-942" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_m"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">6</span>))</span>
<span id="cb82-943"><a href="#cb82-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-944"><a href="#cb82-944" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-945"><a href="#cb82-945" aria-hidden="true" tabindex="-1"></a>dml_irm_forest<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-946"><a href="#cb82-946" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-947"><a href="#cb82-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-948"><a href="#cb82-948" aria-hidden="true" tabindex="-1"></a><span class="fu">## IRM with Trees</span></span>
<span id="cb82-949"><a href="#cb82-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-952"><a href="#cb82-952" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-953"><a href="#cb82-953" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb82-954"><a href="#cb82-954" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span>
<span id="cb82-955"><a href="#cb82-955" aria-hidden="true" tabindex="-1"></a>trees_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>)</span>
<span id="cb82-956"><a href="#cb82-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-957"><a href="#cb82-957" aria-hidden="true" tabindex="-1"></a><span class="co"># Trees</span></span>
<span id="cb82-958"><a href="#cb82-958" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-959"><a href="#cb82-959" aria-hidden="true" tabindex="-1"></a>dml_irm_tree <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_dml_base,</span>
<span id="cb82-960"><a href="#cb82-960" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_g =</span> trees,</span>
<span id="cb82-961"><a href="#cb82-961" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ml_m =</span> trees_class,</span>
<span id="cb82-962"><a href="#cb82-962" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb82-963"><a href="#cb82-963" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_folds =</span> <span class="dv">3</span>)</span>
<span id="cb82-964"><a href="#cb82-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-965"><a href="#cb82-965" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb82-966"><a href="#cb82-966" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-967"><a href="#cb82-967" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g0"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0016</span>, <span class="at">minsplit =</span> <span class="dv">74</span>))</span>
<span id="cb82-968"><a href="#cb82-968" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-969"><a href="#cb82-969" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g1"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0018</span>, <span class="at">minsplit =</span> <span class="dv">70</span>))</span>
<span id="cb82-970"><a href="#cb82-970" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-971"><a href="#cb82-971" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_m"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0028</span>, <span class="at">minsplit =</span> <span class="dv">167</span>))</span>
<span id="cb82-972"><a href="#cb82-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-973"><a href="#cb82-973" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-974"><a href="#cb82-974" aria-hidden="true" tabindex="-1"></a>dml_irm_tree<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-975"><a href="#cb82-975" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-976"><a href="#cb82-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-977"><a href="#cb82-977" aria-hidden="true" tabindex="-1"></a><span class="fu">## IRM with Boosted Trees</span></span>
<span id="cb82-978"><a href="#cb82-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-981"><a href="#cb82-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-982"><a href="#cb82-982" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learners</span></span>
<span id="cb82-983"><a href="#cb82-983" aria-hidden="true" tabindex="-1"></a>boost <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.xgboost"</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>)</span>
<span id="cb82-984"><a href="#cb82-984" aria-hidden="true" tabindex="-1"></a>boost_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>)</span>
<span id="cb82-985"><a href="#cb82-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-986"><a href="#cb82-986" aria-hidden="true" tabindex="-1"></a><span class="co"># Boosted Trees</span></span>
<span id="cb82-987"><a href="#cb82-987" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-988"><a href="#cb82-988" aria-hidden="true" tabindex="-1"></a>dml_irm_boost <span class="ot">=</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(data_dml_base,</span>
<span id="cb82-989"><a href="#cb82-989" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ml_g =</span> boost,</span>
<span id="cb82-990"><a href="#cb82-990" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ml_m =</span> boost_class,</span>
<span id="cb82-991"><a href="#cb82-991" aria-hidden="true" tabindex="-1"></a>                                <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb82-992"><a href="#cb82-992" aria-hidden="true" tabindex="-1"></a>                                <span class="at">n_folds =</span> <span class="dv">3</span>)</span>
<span id="cb82-993"><a href="#cb82-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-994"><a href="#cb82-994" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb82-995"><a href="#cb82-995" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">compareVersion</span>(<span class="fu">as.character</span>(<span class="fu">packageVersion</span>(<span class="st">"DoubleML"</span>)), <span class="st">"0.2.1"</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb82-996"><a href="#cb82-996" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-997"><a href="#cb82-997" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g0"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">8</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb82-998"><a href="#cb82-998" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-999"><a href="#cb82-999" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g1"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">29</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb82-1000"><a href="#cb82-1000" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1001"><a href="#cb82-1001" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_m"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">23</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb82-1002"><a href="#cb82-1002" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb82-1003"><a href="#cb82-1003" aria-hidden="true" tabindex="-1"></a>    <span class="co"># behavior of set_ml_nuisance_params() changed in https://github.com/DoubleML/doubleml-for-r/pull/89</span></span>
<span id="cb82-1004"><a href="#cb82-1004" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1005"><a href="#cb82-1005" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g0"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">8</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb82-1006"><a href="#cb82-1006" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1007"><a href="#cb82-1007" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g1"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">29</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb82-1008"><a href="#cb82-1008" aria-hidden="true" tabindex="-1"></a>    dml_irm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1009"><a href="#cb82-1009" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_m"</span>, <span class="st">"e401"</span>, <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">23</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb82-1010"><a href="#cb82-1010" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1011"><a href="#cb82-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1012"><a href="#cb82-1012" aria-hidden="true" tabindex="-1"></a>dml_irm_boost<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-1013"><a href="#cb82-1013" aria-hidden="true" tabindex="-1"></a>dml_irm_boost<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-1014"><a href="#cb82-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1015"><a href="#cb82-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">## IRM results summary </span></span>
<span id="cb82-1016"><a href="#cb82-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1019"><a href="#cb82-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1020"><a href="#cb82-1020" aria-hidden="true" tabindex="-1"></a>confints_irm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb82-1021"><a href="#cb82-1021" aria-hidden="true" tabindex="-1"></a>  dml_irm_lasso<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-1022"><a href="#cb82-1022" aria-hidden="true" tabindex="-1"></a>  dml_irm_forest<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-1023"><a href="#cb82-1023" aria-hidden="true" tabindex="-1"></a>  dml_irm_tree<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-1024"><a href="#cb82-1024" aria-hidden="true" tabindex="-1"></a>  dml_irm_boost<span class="sc">$</span><span class="fu">confint</span>()</span>
<span id="cb82-1025"><a href="#cb82-1025" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-1026"><a href="#cb82-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1027"><a href="#cb82-1027" aria-hidden="true" tabindex="-1"></a>estimates_irm <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb82-1028"><a href="#cb82-1028" aria-hidden="true" tabindex="-1"></a>  dml_irm_lasso<span class="sc">$</span>coef,</span>
<span id="cb82-1029"><a href="#cb82-1029" aria-hidden="true" tabindex="-1"></a>  dml_irm_forest<span class="sc">$</span>coef,</span>
<span id="cb82-1030"><a href="#cb82-1030" aria-hidden="true" tabindex="-1"></a>  dml_irm_tree<span class="sc">$</span>coef,</span>
<span id="cb82-1031"><a href="#cb82-1031" aria-hidden="true" tabindex="-1"></a>  dml_irm_boost<span class="sc">$</span>coef</span>
<span id="cb82-1032"><a href="#cb82-1032" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-1033"><a href="#cb82-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1034"><a href="#cb82-1034" aria-hidden="true" tabindex="-1"></a>result_irm <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-1035"><a href="#cb82-1035" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"IRM"</span>,</span>
<span id="cb82-1036"><a href="#cb82-1036" aria-hidden="true" tabindex="-1"></a>  <span class="at">ML =</span> <span class="fu">c</span>(<span class="st">"lasso"</span>, <span class="st">"random forest"</span>, <span class="st">"decision tree"</span>, <span class="st">"xgboost"</span>),</span>
<span id="cb82-1037"><a href="#cb82-1037" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> estimates_irm,</span>
<span id="cb82-1038"><a href="#cb82-1038" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> confints_irm[, <span class="dv">1</span>],</span>
<span id="cb82-1039"><a href="#cb82-1039" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> confints_irm[, <span class="dv">2</span>]</span>
<span id="cb82-1040"><a href="#cb82-1040" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-1041"><a href="#cb82-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1042"><a href="#cb82-1042" aria-hidden="true" tabindex="-1"></a>result_irm</span>
<span id="cb82-1043"><a href="#cb82-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1044"><a href="#cb82-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1047"><a href="#cb82-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1048"><a href="#cb82-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(result_irm, <span class="fu">aes</span>(<span class="at">x =</span> ML, <span class="at">y =</span> Estimate, <span class="at">color =</span> ML)) <span class="sc">+</span></span>
<span id="cb82-1049"><a href="#cb82-1049" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-1050"><a href="#cb82-1050" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> ML))  <span class="sc">+</span></span>
<span id="cb82-1051"><a href="#cb82-1051" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb82-1052"><a href="#cb82-1052" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Coefficients and 0.95- confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb82-1053"><a href="#cb82-1053" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb82-1054"><a href="#cb82-1054" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb82-1055"><a href="#cb82-1055" aria-hidden="true" tabindex="-1"></a>              <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb82-1056"><a href="#cb82-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1057"><a href="#cb82-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1058"><a href="#cb82-1058" aria-hidden="true" tabindex="-1"></a>These estimates that flexibly account for confounding are substantially reduced relative to the baseline estimate (*19559*) that does not account for confounding. They suggest much smaller causal effects of 401(k) eligiblity on financial asset holdings. </span>
<span id="cb82-1059"><a href="#cb82-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1060"><a href="#cb82-1060" aria-hidden="true" tabindex="-1"></a><span class="fu">## IIVM: Interactive IV Model</span></span>
<span id="cb82-1061"><a href="#cb82-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1062"><a href="#cb82-1062" aria-hidden="true" tabindex="-1"></a>**Goal:** estimate the effect of **participation (`p401`)** on **net financial assets (`net_tfa`)**, using **eligibility (`e401`)** as an instrument.</span>
<span id="cb82-1063"><a href="#cb82-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1064"><a href="#cb82-1064" aria-hidden="true" tabindex="-1"></a>In the examples above, we estimated the average treatment effect of *eligibility* on financial asset holdings. Now, we consider estimation of local average treatment effects (LATE) of *participation* using eligibility as an instrument for the participation decision. Under appropriate assumptions, the LATE identifies the treatment effect for so-called compliers, i.e., individuals who would only participate if eligible and otherwise not participate in the program.</span>
<span id="cb82-1065"><a href="#cb82-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1066"><a href="#cb82-1066" aria-hidden="true" tabindex="-1"></a>As before, $Y$ denotes the outcome <span class="in">`net_tfa`</span>, and $X$ is the vector of covariates. We use <span class="in">`e401`</span> as a binary instrument for the treatment variable <span class="in">`p401`</span>. Here the structural equation model is:</span>
<span id="cb82-1067"><a href="#cb82-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1068"><a href="#cb82-1068" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-1069"><a href="#cb82-1069" aria-hidden="true" tabindex="-1"></a>\begin{eqnarray}</span>
<span id="cb82-1070"><a href="#cb82-1070" aria-hidden="true" tabindex="-1"></a>&amp; Y = g_0(D,X) + U, &amp;\quad E<span class="co">[</span><span class="ot">U\mid D,X</span><span class="co">]</span> = 0,<span class="sc">\\</span></span>
<span id="cb82-1071"><a href="#cb82-1071" aria-hidden="true" tabindex="-1"></a>&amp; D = r_0(Z,X) + V, &amp;\quad E<span class="co">[</span><span class="ot">V\mid Z, X</span><span class="co">]</span> = 0,<span class="sc">\\</span></span>
<span id="cb82-1072"><a href="#cb82-1072" aria-hidden="true" tabindex="-1"></a>&amp; Z = m_0(X) + \zeta, &amp;\quad E<span class="co">[</span><span class="ot">\zeta \mid X</span><span class="co">]</span> = 0.</span>
<span id="cb82-1073"><a href="#cb82-1073" aria-hidden="true" tabindex="-1"></a>\end{eqnarray}</span>
<span id="cb82-1074"><a href="#cb82-1074" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb82-1075"><a href="#cb82-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1076"><a href="#cb82-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">### IIVM data (base)</span></span>
<span id="cb82-1077"><a href="#cb82-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1080"><a href="#cb82-1080" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1081"><a href="#cb82-1081" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize DoubleMLData with an instrument</span></span>
<span id="cb82-1082"><a href="#cb82-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1083"><a href="#cb82-1083" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic model</span></span>
<span id="cb82-1084"><a href="#cb82-1084" aria-hidden="true" tabindex="-1"></a>data_dml_base_iv <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(data,</span>
<span id="cb82-1085"><a href="#cb82-1085" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y_col =</span> <span class="st">"net_tfa"</span>,</span>
<span id="cb82-1086"><a href="#cb82-1086" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">d_cols =</span> <span class="st">"p401"</span>,</span>
<span id="cb82-1087"><a href="#cb82-1087" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">x_cols =</span> features_base,</span>
<span id="cb82-1088"><a href="#cb82-1088" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">z_cols =</span> <span class="st">"e401"</span>)</span>
<span id="cb82-1089"><a href="#cb82-1089" aria-hidden="true" tabindex="-1"></a>data_dml_base_iv</span>
<span id="cb82-1090"><a href="#cb82-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1091"><a href="#cb82-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1092"><a href="#cb82-1092" aria-hidden="true" tabindex="-1"></a><span class="fu">### IIVM data (flex)</span></span>
<span id="cb82-1093"><a href="#cb82-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1096"><a href="#cb82-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1097"><a href="#cb82-1097" aria-hidden="true" tabindex="-1"></a><span class="co"># Flexible model</span></span>
<span id="cb82-1098"><a href="#cb82-1098" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">=</span> <span class="fu">data.table</span>(<span class="st">"net_tfa"</span> <span class="ot">=</span> data[, net_tfa],</span>
<span id="cb82-1099"><a href="#cb82-1099" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"e401"</span> <span class="ot">=</span> data[, e401],</span>
<span id="cb82-1100"><a href="#cb82-1100" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"p401"</span> <span class="ot">=</span> data[, p401],</span>
<span id="cb82-1101"><a href="#cb82-1101" aria-hidden="true" tabindex="-1"></a>                        features_flex)</span>
<span id="cb82-1102"><a href="#cb82-1102" aria-hidden="true" tabindex="-1"></a>data_dml_flex_iv <span class="ot">=</span> DoubleMLData<span class="sc">$</span><span class="fu">new</span>(model_data,</span>
<span id="cb82-1103"><a href="#cb82-1103" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y_col =</span> <span class="st">"net_tfa"</span>,</span>
<span id="cb82-1104"><a href="#cb82-1104" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">d_cols =</span> <span class="st">"p401"</span>,</span>
<span id="cb82-1105"><a href="#cb82-1105" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">z_cols =</span> <span class="st">"e401"</span>)</span>
<span id="cb82-1106"><a href="#cb82-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1107"><a href="#cb82-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1108"><a href="#cb82-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1109"><a href="#cb82-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">### IIVM with Lasso (flex)</span></span>
<span id="cb82-1110"><a href="#cb82-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1113"><a href="#cb82-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1114"><a href="#cb82-1114" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-1115"><a href="#cb82-1115" aria-hidden="true" tabindex="-1"></a>dml_iivm_lasso <span class="ot">&lt;-</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb82-1116"><a href="#cb82-1116" aria-hidden="true" tabindex="-1"></a>  data_dml_flex_iv,</span>
<span id="cb82-1117"><a href="#cb82-1117" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_g =</span> lasso,</span>
<span id="cb82-1118"><a href="#cb82-1118" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> lasso_class,</span>
<span id="cb82-1119"><a href="#cb82-1119" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_r =</span> lasso_class,</span>
<span id="cb82-1120"><a href="#cb82-1120" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb82-1121"><a href="#cb82-1121" aria-hidden="true" tabindex="-1"></a>  <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb82-1122"><a href="#cb82-1122" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>, <span class="at">never_takers =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-1123"><a href="#cb82-1123" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-1124"><a href="#cb82-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1125"><a href="#cb82-1125" aria-hidden="true" tabindex="-1"></a>dml_iivm_lasso<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-1126"><a href="#cb82-1126" aria-hidden="true" tabindex="-1"></a>dml_iivm_lasso<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-1127"><a href="#cb82-1127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1128"><a href="#cb82-1128" aria-hidden="true" tabindex="-1"></a>Again, we repeat the procedure for the other machine learning methods:</span>
<span id="cb82-1129"><a href="#cb82-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1130"><a href="#cb82-1130" aria-hidden="true" tabindex="-1"></a><span class="fu">### IIVM with Random Forest</span></span>
<span id="cb82-1131"><a href="#cb82-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1134"><a href="#cb82-1134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1135"><a href="#cb82-1135" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb82-1136"><a href="#cb82-1136" aria-hidden="true" tabindex="-1"></a>randomForest <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>)</span>
<span id="cb82-1137"><a href="#cb82-1137" aria-hidden="true" tabindex="-1"></a>randomForest_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>)</span>
<span id="cb82-1138"><a href="#cb82-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1139"><a href="#cb82-1139" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb82-1140"><a href="#cb82-1140" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-1141"><a href="#cb82-1141" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_dml_base_iv,</span>
<span id="cb82-1142"><a href="#cb82-1142" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> randomForest,</span>
<span id="cb82-1143"><a href="#cb82-1143" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> randomForest_class,</span>
<span id="cb82-1144"><a href="#cb82-1144" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> randomForest_class,</span>
<span id="cb82-1145"><a href="#cb82-1145" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb82-1146"><a href="#cb82-1146" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb82-1147"><a href="#cb82-1147" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb82-1148"><a href="#cb82-1148" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb82-1149"><a href="#cb82-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1150"><a href="#cb82-1150" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb82-1151"><a href="#cb82-1151" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1152"><a href="#cb82-1152" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g0"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1153"><a href="#cb82-1153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">4</span>, <span class="at">min.node.size =</span> <span class="dv">7</span>))</span>
<span id="cb82-1154"><a href="#cb82-1154" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1155"><a href="#cb82-1155" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1156"><a href="#cb82-1156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">5</span>))</span>
<span id="cb82-1157"><a href="#cb82-1157" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1158"><a href="#cb82-1158" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_m"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1159"><a href="#cb82-1159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">6</span>, <span class="at">mtry =</span> <span class="dv">3</span>, <span class="at">min.node.size =</span> <span class="dv">6</span>))</span>
<span id="cb82-1160"><a href="#cb82-1160" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1161"><a href="#cb82-1161" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_r1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1162"><a href="#cb82-1162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">max.depth =</span> <span class="dv">4</span>, <span class="at">mtry =</span> <span class="dv">7</span>, <span class="at">min.node.size =</span> <span class="dv">6</span>))</span>
<span id="cb82-1163"><a href="#cb82-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1164"><a href="#cb82-1164" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-1165"><a href="#cb82-1165" aria-hidden="true" tabindex="-1"></a>dml_iivm_forest<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-1166"><a href="#cb82-1166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1167"><a href="#cb82-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1168"><a href="#cb82-1168" aria-hidden="true" tabindex="-1"></a><span class="fu">### IIVM with Trees</span></span>
<span id="cb82-1169"><a href="#cb82-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1172"><a href="#cb82-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1173"><a href="#cb82-1173" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb82-1174"><a href="#cb82-1174" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span>
<span id="cb82-1175"><a href="#cb82-1175" aria-hidden="true" tabindex="-1"></a>trees_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>)</span>
<span id="cb82-1176"><a href="#cb82-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1177"><a href="#cb82-1177" aria-hidden="true" tabindex="-1"></a><span class="co"># Trees</span></span>
<span id="cb82-1178"><a href="#cb82-1178" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-1179"><a href="#cb82-1179" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_dml_base_iv,</span>
<span id="cb82-1180"><a href="#cb82-1180" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_g =</span> trees,</span>
<span id="cb82-1181"><a href="#cb82-1181" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_m =</span> trees_class,</span>
<span id="cb82-1182"><a href="#cb82-1182" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ml_r =</span> trees_class,</span>
<span id="cb82-1183"><a href="#cb82-1183" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb82-1184"><a href="#cb82-1184" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb82-1185"><a href="#cb82-1185" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb82-1186"><a href="#cb82-1186" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb82-1187"><a href="#cb82-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1188"><a href="#cb82-1188" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb82-1189"><a href="#cb82-1189" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1190"><a href="#cb82-1190" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g0"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1191"><a href="#cb82-1191" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0016</span>, <span class="at">minsplit =</span> <span class="dv">74</span>))</span>
<span id="cb82-1192"><a href="#cb82-1192" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1193"><a href="#cb82-1193" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_g1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1194"><a href="#cb82-1194" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0018</span>, <span class="at">minsplit =</span> <span class="dv">70</span>))</span>
<span id="cb82-1195"><a href="#cb82-1195" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1196"><a href="#cb82-1196" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_m"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1197"><a href="#cb82-1197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0028</span>, <span class="at">minsplit =</span> <span class="dv">167</span>))</span>
<span id="cb82-1198"><a href="#cb82-1198" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1199"><a href="#cb82-1199" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ml_r1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1200"><a href="#cb82-1200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">cp =</span> <span class="fl">0.0576</span>, <span class="at">minsplit =</span> <span class="dv">55</span>))</span>
<span id="cb82-1201"><a href="#cb82-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1202"><a href="#cb82-1202" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-1203"><a href="#cb82-1203" aria-hidden="true" tabindex="-1"></a>dml_iivm_tree<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-1204"><a href="#cb82-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1205"><a href="#cb82-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1206"><a href="#cb82-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">### IIVM with Boosted Trees</span></span>
<span id="cb82-1207"><a href="#cb82-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1210"><a href="#cb82-1210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1211"><a href="#cb82-1211" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Learner</span></span>
<span id="cb82-1212"><a href="#cb82-1212" aria-hidden="true" tabindex="-1"></a>boost <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.xgboost"</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>)</span>
<span id="cb82-1213"><a href="#cb82-1213" aria-hidden="true" tabindex="-1"></a>boost_class <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>)</span>
<span id="cb82-1214"><a href="#cb82-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1215"><a href="#cb82-1215" aria-hidden="true" tabindex="-1"></a><span class="co"># Boosted Trees</span></span>
<span id="cb82-1216"><a href="#cb82-1216" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-1217"><a href="#cb82-1217" aria-hidden="true" tabindex="-1"></a>dml_iivm_boost <span class="ot">=</span> DoubleMLIIVM<span class="sc">$</span><span class="fu">new</span>(data_dml_base_iv,</span>
<span id="cb82-1218"><a href="#cb82-1218" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_g =</span> boost,</span>
<span id="cb82-1219"><a href="#cb82-1219" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_m =</span> boost_class,</span>
<span id="cb82-1220"><a href="#cb82-1220" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ml_r =</span> boost_class,</span>
<span id="cb82-1221"><a href="#cb82-1221" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb82-1222"><a href="#cb82-1222" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trimming_threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb82-1223"><a href="#cb82-1223" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subgroups =</span> <span class="fu">list</span>(<span class="at">always_takers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb82-1224"><a href="#cb82-1224" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">never_takers =</span> <span class="cn">TRUE</span>))</span>
<span id="cb82-1225"><a href="#cb82-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1226"><a href="#cb82-1226" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nuisance-part specific parameters</span></span>
<span id="cb82-1227"><a href="#cb82-1227" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">compareVersion</span>(<span class="fu">as.character</span>(<span class="fu">packageVersion</span>(<span class="st">"DoubleML"</span>)), <span class="st">"0.2.1"</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb82-1228"><a href="#cb82-1228" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1229"><a href="#cb82-1229" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g0"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1230"><a href="#cb82-1230" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">9</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb82-1231"><a href="#cb82-1231" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1232"><a href="#cb82-1232" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1233"><a href="#cb82-1233" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">33</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb82-1234"><a href="#cb82-1234" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1235"><a href="#cb82-1235" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_m"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1236"><a href="#cb82-1236" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">12</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb82-1237"><a href="#cb82-1237" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1238"><a href="#cb82-1238" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_r1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1239"><a href="#cb82-1239" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">25</span>, <span class="at">eta =</span> <span class="fl">0.1</span>))</span>
<span id="cb82-1240"><a href="#cb82-1240" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb82-1241"><a href="#cb82-1241" aria-hidden="true" tabindex="-1"></a>    <span class="co"># behavior of set_ml_nuisance_params() changed in https://github.com/DoubleML/doubleml-for-r/pull/89</span></span>
<span id="cb82-1242"><a href="#cb82-1242" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1243"><a href="#cb82-1243" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g0"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1244"><a href="#cb82-1244" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">9</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb82-1245"><a href="#cb82-1245" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1246"><a href="#cb82-1246" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_g1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1247"><a href="#cb82-1247" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">33</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb82-1248"><a href="#cb82-1248" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1249"><a href="#cb82-1249" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_m"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1250"><a href="#cb82-1250" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">12</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb82-1251"><a href="#cb82-1251" aria-hidden="true" tabindex="-1"></a>    dml_iivm_boost<span class="sc">$</span><span class="fu">set_ml_nuisance_params</span>(</span>
<span id="cb82-1252"><a href="#cb82-1252" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ml_r1"</span>, <span class="st">"p401"</span>,</span>
<span id="cb82-1253"><a href="#cb82-1253" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">nrounds =</span> <span class="dv">25</span>, <span class="at">eta =</span> <span class="fl">0.1</span>, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">eval_metric =</span> <span class="st">"logloss"</span>, <span class="at">verbose=</span><span class="dv">0</span>))</span>
<span id="cb82-1254"><a href="#cb82-1254" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1255"><a href="#cb82-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1256"><a href="#cb82-1256" aria-hidden="true" tabindex="-1"></a>dml_iivm_boost<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb82-1257"><a href="#cb82-1257" aria-hidden="true" tabindex="-1"></a>dml_iivm_boost<span class="sc">$</span><span class="fu">summary</span>()</span>
<span id="cb82-1258"><a href="#cb82-1258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1259"><a href="#cb82-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1260"><a href="#cb82-1260" aria-hidden="true" tabindex="-1"></a><span class="fu">## IIVM results summary </span></span>
<span id="cb82-1261"><a href="#cb82-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1262"><a href="#cb82-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1265"><a href="#cb82-1265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1266"><a href="#cb82-1266" aria-hidden="true" tabindex="-1"></a>confints_iivm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb82-1267"><a href="#cb82-1267" aria-hidden="true" tabindex="-1"></a>  dml_iivm_lasso<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-1268"><a href="#cb82-1268" aria-hidden="true" tabindex="-1"></a>  dml_iivm_forest<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-1269"><a href="#cb82-1269" aria-hidden="true" tabindex="-1"></a>  dml_iivm_tree<span class="sc">$</span><span class="fu">confint</span>(),</span>
<span id="cb82-1270"><a href="#cb82-1270" aria-hidden="true" tabindex="-1"></a>  dml_iivm_boost<span class="sc">$</span><span class="fu">confint</span>()</span>
<span id="cb82-1271"><a href="#cb82-1271" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-1272"><a href="#cb82-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1273"><a href="#cb82-1273" aria-hidden="true" tabindex="-1"></a>estimates_iivm <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb82-1274"><a href="#cb82-1274" aria-hidden="true" tabindex="-1"></a>  dml_iivm_lasso<span class="sc">$</span>coef,</span>
<span id="cb82-1275"><a href="#cb82-1275" aria-hidden="true" tabindex="-1"></a>  dml_iivm_forest<span class="sc">$</span>coef,</span>
<span id="cb82-1276"><a href="#cb82-1276" aria-hidden="true" tabindex="-1"></a>  dml_iivm_tree<span class="sc">$</span>coef,</span>
<span id="cb82-1277"><a href="#cb82-1277" aria-hidden="true" tabindex="-1"></a>  dml_iivm_boost<span class="sc">$</span>coef</span>
<span id="cb82-1278"><a href="#cb82-1278" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-1279"><a href="#cb82-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1280"><a href="#cb82-1280" aria-hidden="true" tabindex="-1"></a>result_iivm <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-1281"><a href="#cb82-1281" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"IIVM"</span>,</span>
<span id="cb82-1282"><a href="#cb82-1282" aria-hidden="true" tabindex="-1"></a>  <span class="at">ML =</span> <span class="fu">c</span>(<span class="st">"lasso"</span>, <span class="st">"random forest"</span>, <span class="st">"decision tree"</span>, <span class="st">"xgboost"</span>),</span>
<span id="cb82-1283"><a href="#cb82-1283" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> estimates_iivm,</span>
<span id="cb82-1284"><a href="#cb82-1284" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> confints_iivm[, <span class="dv">1</span>],</span>
<span id="cb82-1285"><a href="#cb82-1285" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> confints_iivm[, <span class="dv">2</span>]</span>
<span id="cb82-1286"><a href="#cb82-1286" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-1287"><a href="#cb82-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1288"><a href="#cb82-1288" aria-hidden="true" tabindex="-1"></a>result_iivm</span>
<span id="cb82-1289"><a href="#cb82-1289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1290"><a href="#cb82-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1293"><a href="#cb82-1293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1294"><a href="#cb82-1294" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(result_iivm, <span class="fu">aes</span>(<span class="at">x =</span> ML, <span class="at">y =</span> Estimate, <span class="at">color =</span> ML)) <span class="sc">+</span></span>
<span id="cb82-1295"><a href="#cb82-1295" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-1296"><a href="#cb82-1296" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> ML))  <span class="sc">+</span></span>
<span id="cb82-1297"><a href="#cb82-1297" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb82-1298"><a href="#cb82-1298" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Coefficients and 0.95- confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb82-1299"><a href="#cb82-1299" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb82-1300"><a href="#cb82-1300" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb82-1301"><a href="#cb82-1301" aria-hidden="true" tabindex="-1"></a>              <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb82-1302"><a href="#cb82-1302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1303"><a href="#cb82-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1304"><a href="#cb82-1304" aria-hidden="true" tabindex="-1"></a><span class="fu">## All results together</span></span>
<span id="cb82-1305"><a href="#cb82-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1306"><a href="#cb82-1306" aria-hidden="true" tabindex="-1"></a>Finally, we combine results across PLR, IRM, and IIVM into one table and plot.</span>
<span id="cb82-1307"><a href="#cb82-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1310"><a href="#cb82-1310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1311"><a href="#cb82-1311" aria-hidden="true" tabindex="-1"></a>summary_result <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_plr, result_irm, result_iivm) <span class="sc">|&gt;</span></span>
<span id="cb82-1312"><a href="#cb82-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PLR"</span>, <span class="st">"IRM"</span>, <span class="st">"IIVM"</span>)))</span>
<span id="cb82-1313"><a href="#cb82-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1314"><a href="#cb82-1314" aria-hidden="true" tabindex="-1"></a>summary_result</span>
<span id="cb82-1315"><a href="#cb82-1315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1316"><a href="#cb82-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1319"><a href="#cb82-1319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-1320"><a href="#cb82-1320" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summary_result, <span class="fu">aes</span>(<span class="at">x =</span> ML, <span class="at">y =</span> Estimate, <span class="at">color =</span> ML)) <span class="sc">+</span></span>
<span id="cb82-1321"><a href="#cb82-1321" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-1322"><a href="#cb82-1322" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">color =</span> ML))  <span class="sc">+</span></span>
<span id="cb82-1323"><a href="#cb82-1323" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb82-1324"><a href="#cb82-1324" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Coefficients and 0.95- confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb82-1325"><a href="#cb82-1325" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb82-1326"><a href="#cb82-1326" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb82-1327"><a href="#cb82-1327" aria-hidden="true" tabindex="-1"></a>              <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb82-1328"><a href="#cb82-1328" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(model <span class="sc">~</span>., <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb82-1329"><a href="#cb82-1329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-1330"><a href="#cb82-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1331"><a href="#cb82-1331" aria-hidden="true" tabindex="-1"></a>We report results based on four ML methods for estimating the nuisance functions used in forming the orthogonal estimating equations. We find again that the estimates of the treatment effect are stable across ML methods. The estimates are highly significant, hence we would reject the hypothesis</span>
<span id="cb82-1332"><a href="#cb82-1332" aria-hidden="true" tabindex="-1"></a>that 401(k) participation has no effect on financial wealth.</span>
<span id="cb82-1333"><a href="#cb82-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1334"><a href="#cb82-1334" aria-hidden="true" tabindex="-1"></a>Across PLR and IRM, the estimated effect of eligibility (e401) on net financial assets (net_tfa) is consistently positive across all learners. The estimates fall roughly in the range of $8k–$9.6k, and the 95% confidence intervals remain above zero, suggesting a robust positive association after adjusting for observed covariates.</span>
<span id="cb82-1335"><a href="#cb82-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1336"><a href="#cb82-1336" aria-hidden="true" tabindex="-1"></a>In the IIVM results, the target changes: we estimate the effect of participation (p401) using eligibility (e401) as an instrument. These estimates are larger (around $11.8k–$12.8k), which is common in IV settings because the effect is identified for compliers and depends on how strongly the instrument shifts participation. Therefore, IIVM should be read as a LATE (complier effect), not directly comparable to PLR/IRM as a population average.</span>
<span id="cb82-1337"><a href="#cb82-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1338"><a href="#cb82-1338" aria-hidden="true" tabindex="-1"></a><span class="fu">## Read more</span></span>
<span id="cb82-1339"><a href="#cb82-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1340"><a href="#cb82-1340" aria-hidden="true" tabindex="-1"></a>Double Machine Learning Approach</span>
<span id="cb82-1341"><a href="#cb82-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1342"><a href="#cb82-1342" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chernozhukov, V., Chetverikov, D., Demirer, M., Duflo, E., Hansen, C., Newey, W. and Robins, J. (2018), Double/debiased machine learning for treatment and structural parameters. The Econometrics Journal, 21: C1-C68, doi:10.1111/ectj.12097.</span>
<span id="cb82-1343"><a href="#cb82-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1344"><a href="#cb82-1344" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chernozhukov, V., Hansen, C., Kallus, N., Spindler, M., and Syrgkanis, V. (forthcoming), Applied Causal Inference Powered by ML and AI.</span>
<span id="cb82-1345"><a href="#cb82-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1346"><a href="#cb82-1346" aria-hidden="true" tabindex="-1"></a>DoubleML Package for Python and R</span>
<span id="cb82-1347"><a href="#cb82-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1348"><a href="#cb82-1348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Bach, P., Chernozhukov, V., Kurz, M. S., and Spindler, M. (2021), DoubleML - An Object-Oriented Implementation of Double Machine Learning in R, arXiv:2103.09603.</span>
<span id="cb82-1349"><a href="#cb82-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1350"><a href="#cb82-1350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Bach, P., Chernozhukov, V., Kurz, M. S., and Spindler, M. (2022), DoubleML - An Object-Oriented Implementation of Double Machine Learning in Python, Journal of Machine Learning Research, 23(53): 1-6, https://www.jmlr.org/papers/v23/21-0862.html.</span>
<span id="cb82-1351"><a href="#cb82-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1352"><a href="#cb82-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1353"><a href="#cb82-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1354"><a href="#cb82-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1355"><a href="#cb82-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1356"><a href="#cb82-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1357"><a href="#cb82-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1358"><a href="#cb82-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1359"><a href="#cb82-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1360"><a href="#cb82-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1361"><a href="#cb82-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1362"><a href="#cb82-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1363"><a href="#cb82-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1364"><a href="#cb82-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1365"><a href="#cb82-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1366"><a href="#cb82-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1367"><a href="#cb82-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-1368"><a href="#cb82-1368" aria-hidden="true" tabindex="-1"></a></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Made with ❤️ and Quarto</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>